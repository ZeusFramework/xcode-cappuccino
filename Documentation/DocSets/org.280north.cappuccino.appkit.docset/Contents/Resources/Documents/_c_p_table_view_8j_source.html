<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>CPAppKit: /Users/raphael/Development/public/ForkedProjects/cappuccino/source/AppKit/CPTableView.j Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.2 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>/Users/raphael/Development/public/ForkedProjects/cappuccino/source/AppKit/CPTableView.j</h1><a href="_c_p_table_view_8j.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * CPTableView.j</span>
<a name="l00003"></a>00003 <span class="comment"> * AppKit</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> * Created by Francisco Tolmasky.</span>
<a name="l00006"></a>00006 <span class="comment"> * Copyright 2009, 280 North, Inc.</span>
<a name="l00007"></a>00007 <span class="comment"> *</span>
<a name="l00008"></a>00008 <span class="comment"> * This library is free software; you can redistribute it and/or</span>
<a name="l00009"></a>00009 <span class="comment"> * modify it under the terms of the GNU Lesser General Public</span>
<a name="l00010"></a>00010 <span class="comment"> * License as published by the Free Software Foundation; either</span>
<a name="l00011"></a>00011 <span class="comment"> * version 2.1 of the License, or (at your option) any later version.</span>
<a name="l00012"></a>00012 <span class="comment"> *</span>
<a name="l00013"></a>00013 <span class="comment"> * This library is distributed in the hope that it will be useful,</span>
<a name="l00014"></a>00014 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00015"></a>00015 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU</span>
<a name="l00016"></a>00016 <span class="comment"> * Lesser General Public License for more details.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * You should have received a copy of the GNU Lesser General Public</span>
<a name="l00019"></a>00019 <span class="comment"> * License along with this library; if not, write to the Free Software</span>
<a name="l00020"></a>00020 <span class="comment"> * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA</span>
<a name="l00021"></a>00021 <span class="comment"> */</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 @<span class="keyword">import</span> &lt;Foundation/CPArray.j&gt;
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 @<span class="keyword">import</span> <span class="stringliteral">&quot;CPControl.j&quot;</span>
<a name="l00026"></a>00026 @<span class="keyword">import</span> <span class="stringliteral">&quot;CPTableColumn.j&quot;</span>
<a name="l00027"></a>00027 @<span class="keyword">import</span> <span class="stringliteral">&quot;_CPCornerView.j&quot;</span>
<a name="l00028"></a>00028 @<span class="keyword">import</span> <span class="stringliteral">&quot;CPScroller.j&quot;</span>
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 
<a name="l00031"></a><a class="code" href="_c_p_table_view_8j.html#a8a2e56c7204649b8999509082418ddcb">00031</a> <a class="code" href="_c_p_table_view_8j.html#a8a2e56c7204649b8999509082418ddcb">CPTableViewColumnDidMoveNotification</a>        = <span class="stringliteral">@&quot;CPTableViewColumnDidMoveNotification&quot;</span>;
<a name="l00032"></a><a class="code" href="_c_p_table_view_8j.html#ad35f7c5fbd420b1766b470df7df236ed">00032</a> <a class="code" href="_c_p_table_view_8j.html#ad35f7c5fbd420b1766b470df7df236ed">CPTableViewColumnDidResizeNotification</a>      = <span class="stringliteral">@&quot;CPTableViewColumnDidResizeNotification&quot;</span>;
<a name="l00033"></a><a class="code" href="_c_p_table_view_8j.html#a51f328a6630fa3c37dd97e3ebcd47bad">00033</a> <a class="code" href="_c_p_table_view_8j.html#a51f328a6630fa3c37dd97e3ebcd47bad">CPTableViewSelectionDidChangeNotification</a>   = <span class="stringliteral">@&quot;CPTableViewSelectionDidChangeNotification&quot;</span>;
<a name="l00034"></a><a class="code" href="_c_p_table_view_8j.html#a05ad281074c809f38e75ada2b2ac510f">00034</a> <a class="code" href="_c_p_table_view_8j.html#a05ad281074c809f38e75ada2b2ac510f">CPTableViewSelectionIsChangingNotification</a>  = <span class="stringliteral">@&quot;CPTableViewSelectionIsChangingNotification&quot;</span>;
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="_c_g_geometry_8h.html">CoreGraphics/CGGeometry.h</a>&quot;</span>
<a name="l00037"></a>00037 
<a name="l00038"></a><a class="code" href="_c_p_table_view_8j.html#a9f25c28df39dca590ad108beb6b4b48b">00038</a> var <a class="code" href="_c_p_table_view_8j.html#a9f25c28df39dca590ad108beb6b4b48b">CPTableViewDataSource_tableView_setObjectValue_forTableColumn_row_</a>                                  = 1 &lt;&lt; 2,
<a name="l00039"></a>00039 
<a name="l00040"></a><a class="code" href="_c_p_table_view_8j.html#a71f4aae1a37e8503f63542e1d977edce">00040</a>     <a class="code" href="_c_p_table_view_8j.html#a71f4aae1a37e8503f63542e1d977edce">CPTableViewDataSource_tableView_acceptDrop_row_dropOperation_</a>                                       = 1 &lt;&lt; 3,
<a name="l00041"></a><a class="code" href="_c_p_table_view_8j.html#a70eaee52bd8ae42e829dc246bfffa90f">00041</a>     <a class="code" href="_c_p_table_view_8j.html#a70eaee52bd8ae42e829dc246bfffa90f">CPTableViewDataSource_tableView_namesOfPromisedFilesDroppedAtDestination_forDraggedRowsWithIndexes_</a> = 1 &lt;&lt; 4,
<a name="l00042"></a><a class="code" href="_c_p_table_view_8j.html#a4f6917aa9754d8c13c933ae043ca4963">00042</a>     <a class="code" href="_c_p_table_view_8j.html#a4f6917aa9754d8c13c933ae043ca4963">CPTableViewDataSource_tableView_validateDrop_proposedRow_proposedDropOperation_</a>                     = 1 &lt;&lt; 5,
<a name="l00043"></a><a class="code" href="_c_p_table_view_8j.html#a3fb0a731ef8cca0484830f426bcbe81f">00043</a>     <a class="code" href="_c_p_table_view_8j.html#a3fb0a731ef8cca0484830f426bcbe81f">CPTableViewDataSource_tableView_writeRowsWithIndexes_toPasteboard_</a>                                  = 1 &lt;&lt; 6,
<a name="l00044"></a>00044 
<a name="l00045"></a><a class="code" href="_c_p_table_view_8j.html#a3270c812883a130ed7efbc0f119a8ec7">00045</a>     <a class="code" href="_c_p_table_view_8j.html#a3270c812883a130ed7efbc0f119a8ec7">CPTableViewDataSource_tableView_sortDescriptorsDidChange_</a>                                           = 1 &lt;&lt; 7;
<a name="l00046"></a>00046 
<a name="l00047"></a><a class="code" href="_c_p_table_view_8j.html#a17dd3c2f77d47e02db83a2643962e03f">00047</a> var <a class="code" href="_c_p_table_view_8j.html#a17dd3c2f77d47e02db83a2643962e03f">CPTableViewDelegate_selectionShouldChangeInTableView_</a>                                               = 1 &lt;&lt; 0,
<a name="l00048"></a><a class="code" href="_c_p_table_view_8j.html#a50ccc5dbd574a129aca4b61924308813">00048</a>     <a class="code" href="_c_p_table_view_8j.html#a50ccc5dbd574a129aca4b61924308813">CPTableViewDelegate_tableView_dataViewForTableColumn_row_</a>                                           = 1 &lt;&lt; 1,
<a name="l00049"></a><a class="code" href="_c_p_table_view_8j.html#a11302327c1511f3a71d93e494794c655">00049</a>     <a class="code" href="_c_p_table_view_8j.html#a11302327c1511f3a71d93e494794c655">CPTableViewDelegate_tableView_didClickTableColumn_</a>                                                  = 1 &lt;&lt; 2,
<a name="l00050"></a><a class="code" href="_c_p_table_view_8j.html#ac6764797b21b0862c8ea1223c05626c2">00050</a>     <a class="code" href="_c_p_table_view_8j.html#ac6764797b21b0862c8ea1223c05626c2">CPTableViewDelegate_tableView_didDragTableColumn_</a>                                                   = 1 &lt;&lt; 3,
<a name="l00051"></a><a class="code" href="_c_p_table_view_8j.html#afd61c24dda7ceebc29da34fa3b5f4a3a">00051</a>     <a class="code" href="_c_p_table_view_8j.html#afd61c24dda7ceebc29da34fa3b5f4a3a">CPTableViewDelegate_tableView_heightOfRow_</a>                                                          = 1 &lt;&lt; 4,
<a name="l00052"></a><a class="code" href="_c_p_table_view_8j.html#a1b2d38c75129c936b93b4163a5a32889">00052</a>     <a class="code" href="_c_p_table_view_8j.html#a1b2d38c75129c936b93b4163a5a32889">CPTableViewDelegate_tableView_isGroupRow_</a>                                                           = 1 &lt;&lt; 5,
<a name="l00053"></a><a class="code" href="_c_p_table_view_8j.html#a53db520f3c6c396184ef32c5a586b027">00053</a>     <a class="code" href="_c_p_table_view_8j.html#a53db520f3c6c396184ef32c5a586b027">CPTableViewDelegate_tableView_mouseDownInHeaderOfTableColumn_</a>                                       = 1 &lt;&lt; 6,
<a name="l00054"></a><a class="code" href="_c_p_table_view_8j.html#abf8671c1652c48238dc5c04fc9550a62">00054</a>     <a class="code" href="_c_p_table_view_8j.html#abf8671c1652c48238dc5c04fc9550a62">CPTableViewDelegate_tableView_nextTypeSelectMatchFromRow_toRow_forString_</a>                           = 1 &lt;&lt; 7,
<a name="l00055"></a><a class="code" href="_c_p_table_view_8j.html#a87a639d266ecdd1db204b2b3e3d0e97d">00055</a>     <a class="code" href="_c_p_table_view_8j.html#a87a639d266ecdd1db204b2b3e3d0e97d">CPTableViewDelegate_tableView_selectionIndexesForProposedSelection_</a>                                 = 1 &lt;&lt; 8,
<a name="l00056"></a><a class="code" href="_c_p_table_view_8j.html#a13a5d77ea463b7ee16d106bdf440baef">00056</a>     <a class="code" href="_c_p_table_view_8j.html#a13a5d77ea463b7ee16d106bdf440baef">CPTableViewDelegate_tableView_shouldEditTableColumn_row_</a>                                            = 1 &lt;&lt; 9,
<a name="l00057"></a><a class="code" href="_c_p_table_view_8j.html#aaea951ab19dc11a096a69b28cc216e38">00057</a>     <a class="code" href="_c_p_table_view_8j.html#aaea951ab19dc11a096a69b28cc216e38">CPTableViewDelegate_tableView_shouldSelectRow_</a>                                                      = 1 &lt;&lt; 10,
<a name="l00058"></a><a class="code" href="_c_p_table_view_8j.html#a40e46e56c68f00ce2e3fe0c2dce75577">00058</a>     <a class="code" href="_c_p_table_view_8j.html#a40e46e56c68f00ce2e3fe0c2dce75577">CPTableViewDelegate_tableView_shouldSelectTableColumn_</a>                                              = 1 &lt;&lt; 11,
<a name="l00059"></a><a class="code" href="_c_p_table_view_8j.html#a47c3d5fa0d018996943ef98b80ffd3ed">00059</a>     <a class="code" href="_c_p_table_view_8j.html#a47c3d5fa0d018996943ef98b80ffd3ed">CPTableViewDelegate_tableView_shouldShowViewExpansionForTableColumn_row_</a>                            = 1 &lt;&lt; 12,
<a name="l00060"></a><a class="code" href="_c_p_table_view_8j.html#a84373538a8878335c8efedfc6a73dfda">00060</a>     <a class="code" href="_c_p_table_view_8j.html#a84373538a8878335c8efedfc6a73dfda">CPTableViewDelegate_tableView_shouldTrackView_forTableColumn_row_</a>                                   = 1 &lt;&lt; 13,
<a name="l00061"></a><a class="code" href="_c_p_table_view_8j.html#a90bdeeee16a3591df2596384e4f627e3">00061</a>     <a class="code" href="_c_p_table_view_8j.html#a90bdeeee16a3591df2596384e4f627e3">CPTableViewDelegate_tableView_shouldTypeSelectForEvent_withCurrentSearchString_</a>                     = 1 &lt;&lt; 14,
<a name="l00062"></a><a class="code" href="_c_p_table_view_8j.html#a106983f227bb2afdff8e05449a4ea33a">00062</a>     <a class="code" href="_c_p_table_view_8j.html#a106983f227bb2afdff8e05449a4ea33a">CPTableViewDelegate_tableView_toolTipForView_rect_tableColumn_row_mouseLocation_</a>                    = 1 &lt;&lt; 15,
<a name="l00063"></a><a class="code" href="_c_p_table_view_8j.html#a8a84faf4826019c8a187588890360704">00063</a>     <a class="code" href="_c_p_table_view_8j.html#a8a84faf4826019c8a187588890360704">CPTableViewDelegate_tableView_typeSelectStringForTableColumn_row_</a>                                   = 1 &lt;&lt; 16,
<a name="l00064"></a><a class="code" href="_c_p_table_view_8j.html#ad543a1b68132942313c20a9414cb508c">00064</a>     <a class="code" href="_c_p_table_view_8j.html#ad543a1b68132942313c20a9414cb508c">CPTableViewDelegate_tableView_willDisplayView_forTableColumn_row_</a>                                   = 1 &lt;&lt; 17,
<a name="l00065"></a><a class="code" href="_c_p_table_view_8j.html#a0e92f5ab48715248e82afe1bd74528b7">00065</a>     <a class="code" href="_c_p_table_view_8j.html#a0e92f5ab48715248e82afe1bd74528b7">CPTableViewDelegate_tableViewSelectionDidChange_</a>                                                    = 1 &lt;&lt; 18,
<a name="l00066"></a><a class="code" href="_c_p_table_view_8j.html#ac80a4fc92d5dd3f875a79b2c44b55ed3">00066</a>     <a class="code" href="_c_p_table_view_8j.html#ac80a4fc92d5dd3f875a79b2c44b55ed3">CPTableViewDelegate_tableViewSelectionIsChanging_</a>                                                   = 1 &lt;&lt; 19;
<a name="l00067"></a>00067 
<a name="l00068"></a>00068 <span class="comment">//CPTableViewDraggingDestinationFeedbackStyles</span>
<a name="l00069"></a><a class="code" href="_c_p_table_view_8j.html#a7d721e523dd8ab8740aff52cb54efa91">00069</a> <a class="code" href="_c_p_table_view_8j.html#a7d721e523dd8ab8740aff52cb54efa91">CPTableViewDraggingDestinationFeedbackStyleNone</a> = -1,
<a name="l00070"></a><a class="code" href="_c_p_table_view_8j.html#a4b9131f16846d5b2e77fbb2d855f48c1">00070</a> <a class="code" href="_c_p_table_view_8j.html#a4b9131f16846d5b2e77fbb2d855f48c1">CPTableViewDraggingDestinationFeedbackStyleRegular</a> = 0,
<a name="l00071"></a><a class="code" href="_c_p_table_view_8j.html#a5c1e1977569dc9ea54f519916529114b">00071</a> <a class="code" href="_c_p_table_view_8j.html#a5c1e1977569dc9ea54f519916529114b">CPTableViewDraggingDestinationFeedbackStyleSourceList</a> = 1;
<a name="l00072"></a>00072 
<a name="l00073"></a>00073 <span class="comment">//CPTableViewDropOperations</span>
<a name="l00074"></a><a class="code" href="_c_p_table_view_8j.html#a279093eafa50075a94c202e0dd51861a">00074</a> <a class="code" href="_c_p_table_view_8j.html#a279093eafa50075a94c202e0dd51861a">CPTableViewDropOn</a> = 0,
<a name="l00075"></a><a class="code" href="_c_p_table_view_8j.html#a4c2d1434c8bc5b937eeb47b55f5c74d0">00075</a> <a class="code" href="_c_p_table_view_8j.html#a4c2d1434c8bc5b937eeb47b55f5c74d0">CPTableViewDropAbove</a> = 1;
<a name="l00076"></a>00076 
<a name="l00077"></a>00077 <span class="comment">// TODO: add docs</span>
<a name="l00078"></a>00078 
<a name="l00079"></a><a class="code" href="_c_p_table_view_8j.html#a01cb9ff2b6562f83a7f4073abf81f7ce">00079</a> <a class="code" href="_c_p_table_view_8j.html#a01cb9ff2b6562f83a7f4073abf81f7ce">CPTableViewSelectionHighlightStyleNone</a> = -1,
<a name="l00080"></a><a class="code" href="_c_p_table_view_8j.html#aca8acc7a64967150badd9c4b7c6eedf9">00080</a> <a class="code" href="_c_p_table_view_8j.html#aca8acc7a64967150badd9c4b7c6eedf9">CPTableViewSelectionHighlightStyleRegular</a> = 0,
<a name="l00081"></a><a class="code" href="_c_p_table_view_8j.html#a9b1494c16eb023b6a546dc0fb584fce7">00081</a> <a class="code" href="_c_p_table_view_8j.html#a9b1494c16eb023b6a546dc0fb584fce7">CPTableViewSelectionHighlightStyleSourceList</a> = 1;
<a name="l00082"></a>00082 
<a name="l00083"></a><a class="code" href="_c_p_table_view_8j.html#aa39cb0e13ea617a0962d2b72bbbedd81">00083</a> <a class="code" href="_c_p_table_view_8j.html#aa39cb0e13ea617a0962d2b72bbbedd81">CPTableViewGridNone</a>                    = 0;
<a name="l00084"></a><a class="code" href="_c_p_table_view_8j.html#af147002e8b12fcaf12a2df975edb95b5">00084</a> <a class="code" href="_c_p_table_view_8j.html#af147002e8b12fcaf12a2df975edb95b5">CPTableViewSolidVerticalGridLineMask</a>   = 1 &lt;&lt; 0;
<a name="l00085"></a><a class="code" href="_c_p_table_view_8j.html#acc262027919f5d8fa9961299c57e4887">00085</a> <a class="code" href="_c_p_table_view_8j.html#acc262027919f5d8fa9961299c57e4887">CPTableViewSolidHorizontalGridLineMask</a> = 1 &lt;&lt; 1;
<a name="l00086"></a>00086 
<a name="l00087"></a><a class="code" href="_c_p_table_view_8j.html#ad0b8e7aa32705666ec47cfdb3fdbdeef">00087</a> <a class="code" href="_c_p_table_view_8j.html#ad0b8e7aa32705666ec47cfdb3fdbdeef">CPTableViewNoColumnAutoresizing</a> = 0,
<a name="l00088"></a><a class="code" href="_c_p_table_view_8j.html#a8f4ff5bd6c8f021a249d46098015f486">00088</a> <a class="code" href="_c_p_table_view_8j.html#a8f4ff5bd6c8f021a249d46098015f486">CPTableViewUniformColumnAutoresizingStyle</a> = 1,
<a name="l00089"></a><a class="code" href="_c_p_table_view_8j.html#a14105ece8d41c22e1552964bc8c97224">00089</a> <a class="code" href="_c_p_table_view_8j.html#a14105ece8d41c22e1552964bc8c97224">CPTableViewSequentialColumnAutoresizingStyle</a> = 2,
<a name="l00090"></a><a class="code" href="_c_p_table_view_8j.html#a48dbe0f6475c9d66899227d2bbaad37a">00090</a> <a class="code" href="_c_p_table_view_8j.html#a48dbe0f6475c9d66899227d2bbaad37a">CPTableViewReverseSequentialColumnAutoresizingStyle</a> = 3,
<a name="l00091"></a><a class="code" href="_c_p_table_view_8j.html#a0f472ac2d7a9f96e5ad5ec35e8d4af3f">00091</a> <a class="code" href="_c_p_table_view_8j.html#a0f472ac2d7a9f96e5ad5ec35e8d4af3f">CPTableViewLastColumnOnlyAutoresizingStyle</a> = 4,
<a name="l00092"></a><a class="code" href="_c_p_table_view_8j.html#a2817258659933aa465a18e1798822134">00092</a> <a class="code" href="_c_p_table_view_8j.html#a2817258659933aa465a18e1798822134">CPTableViewFirstColumnOnlyAutoresizingStyle</a> = 5;
<a name="l00093"></a>00093 
<a name="l00094"></a>00094 
<a name="l00095"></a><a class="code" href="_c_p_table_view_8j.html#aa0c3e20940452d04b6708ec8b82b482b">00095</a> <span class="preprocessor">#define NUMBER_OF_COLUMNS() (_tableColumns.length)</span>
<a name="l00096"></a><a class="code" href="_c_p_table_view_8j.html#a8d863ee1b9f1e447c7ee408af11b8f22">00096</a> <span class="preprocessor"></span><span class="preprocessor">#define UPDATE_COLUMN_RANGES_IF_NECESSARY() if (_dirtyTableColumnRangeIndex !== CPNotFound) [self _recalculateTableColumnRanges];</span>
<a name="l00097"></a>00097 <span class="preprocessor"></span>
<a name="l00098"></a>00098 <span class="keyword">@implementation </span>_CPTableDrawView : <a class="code" href="class_c_p_view.html">CPView</a>
<a name="l00099"></a>00099 {
<a name="l00100"></a>00100     <a class="code" href="class_c_p_table_view.html">CPTableView</a> _tableView;
<a name="l00101"></a>00101 }
<a name="l00102"></a>00102 
<a name="l00103"></a>00103 - (id)initWithTableView:(<a class="code" href="class_c_p_table_view.html">CPTableView</a>)aTableView
<a name="l00104"></a>00104 {
<a name="l00105"></a>00105     <span class="keyword">self</span> = [<span class="keyword">super</span> init];
<a name="l00106"></a>00106 
<a name="l00107"></a>00107     <span class="keywordflow">if</span> (<span class="keyword">self</span>)
<a name="l00108"></a>00108         _tableView = aTableView;
<a name="l00109"></a>00109 
<a name="l00110"></a>00110     <span class="keywordflow">return</span> <span class="keyword">self</span>;
<a name="l00111"></a>00111 }
<a name="l00112"></a>00112 
<a name="l00113"></a>00113 - (void)drawRect:(CGRect)aRect
<a name="l00114"></a>00114 {
<a name="l00115"></a>00115     var <a class="code" href="_c_p_segmented_control_8j.html#a63fcc9e0dd97e8502cce685e88234e16">frame</a> = [<span class="keyword">self</span> frame],
<a name="l00116"></a>00116         context = [[<a class="code" href="class_c_p_graphics_context.html">CPGraphicsContext</a> <a class="code" href="class_c_p_graphics_context.html#a378dafc8fb951053dd6877fb45e87f61">currentContext</a>] <a class="code" href="class_c_p_graphics_context.html#a92895bd939c04da463d02425bec83f0b">graphicsPort</a>];
<a name="l00117"></a>00117 
<a name="l00118"></a>00118     <a class="code" href="group__coregraphics.html#ga2351bbe153eb35f881d0de33de240e02">CGContextTranslateCTM</a>(context, -_CGRectGetMinX(<a class="code" href="_c_p_segmented_control_8j.html#a63fcc9e0dd97e8502cce685e88234e16">frame</a>), -_CGRectGetMinY(<a class="code" href="_c_p_segmented_control_8j.html#a63fcc9e0dd97e8502cce685e88234e16">frame</a>));
<a name="l00119"></a>00119 
<a name="l00120"></a>00120     [_tableView _drawRect:aRect];
<a name="l00121"></a>00121 }
<a name="l00122"></a>00122 
<a name="l00123"></a>00123 <span class="keyword">@end</span>
<a name="l00124"></a>00124 
<a name="l00132"></a><a class="code" href="class_c_p_table_view.html">00132</a> <span class="keyword">@implementation </span><a class="code" href="class_c_p_table_view.html">CPTableView</a> : <a class="code" href="class_c_p_control.html">CPControl</a>
<a name="l00133"></a>00133 {
<a name="l00134"></a>00134     <span class="keywordtype">id</span>          _dataSource;
<a name="l00135"></a>00135     CPInteger   _implementedDataSourceMethods;
<a name="l00136"></a>00136 
<a name="l00137"></a>00137     <span class="keywordtype">id</span>          _delegate;
<a name="l00138"></a>00138     CPInteger   _implementedDelegateMethods;
<a name="l00139"></a>00139 
<a name="l00140"></a>00140     CPArray     _tableColumns;
<a name="l00141"></a>00141     CPArray     _tableColumnRanges;
<a name="l00142"></a>00142     CPInteger   _dirtyTableColumnRangeIndex;
<a name="l00143"></a>00143     CPInteger   _numberOfHiddenColumns;
<a name="l00144"></a>00144 
<a name="l00145"></a>00145     BOOL        _reloadAllRows;
<a name="l00146"></a>00146     Object      _objectValues;
<a name="l00147"></a>00147     <a class="code" href="class_c_p_index_set.html">CPIndexSet</a>  _exposedRows;
<a name="l00148"></a>00148     <a class="code" href="class_c_p_index_set.html">CPIndexSet</a>  _exposedColumns;
<a name="l00149"></a>00149 
<a name="l00150"></a>00150     Object      _dataViewsForTableColumns;
<a name="l00151"></a>00151     Object      _cachedDataViews;
<a name="l00152"></a>00152 
<a name="l00153"></a>00153     <span class="comment">//Configuring Behavior</span>
<a name="l00154"></a>00154     BOOL        _allowsColumnReordering;
<a name="l00155"></a>00155     BOOL        _allowsColumnResizing;
<a name="l00156"></a>00156     BOOL        _allowsColumnSelection;
<a name="l00157"></a>00157     BOOL        _allowsMultipleSelection;
<a name="l00158"></a>00158     BOOL        _allowsEmptySelection;
<a name="l00159"></a>00159 
<a name="l00160"></a>00160     <span class="comment">//Setting Display Attributes</span>
<a name="l00161"></a>00161     CGSize      _intercellSpacing;
<a name="l00162"></a>00162     <span class="keywordtype">float</span>       _rowHeight;
<a name="l00163"></a>00163 
<a name="l00164"></a>00164     BOOL        _usesAlternatingRowBackgroundColors;
<a name="l00165"></a>00165     CPArray     _alternatingRowBackgroundColors;
<a name="l00166"></a>00166 
<a name="l00167"></a>00167     <span class="keywordtype">unsigned</span>    _selectionHighlightMask;
<a name="l00168"></a>00168     <a class="code" href="class_c_p_color.html">CPColor</a>     _selectionHightlightColor;
<a name="l00169"></a>00169     <span class="keywordtype">unsigned</span>    _currentHighlightedTableColumn;
<a name="l00170"></a>00170     <span class="keywordtype">unsigned</span>    _gridStyleMask;
<a name="l00171"></a>00171     <a class="code" href="class_c_p_color.html">CPColor</a>     _gridColor;
<a name="l00172"></a>00172 
<a name="l00173"></a>00173     <span class="keywordtype">unsigned</span>    _numberOfRows;
<a name="l00174"></a>00174 
<a name="l00175"></a>00175 
<a name="l00176"></a>00176     <a class="code" href="class_c_p_table_header_view.html">CPTableHeaderView</a> _headerView;
<a name="l00177"></a>00177     _CPCornerView     _cornerView;
<a name="l00178"></a>00178 
<a name="l00179"></a>00179     <a class="code" href="class_c_p_index_set.html">CPIndexSet</a>  _selectedColumnIndexes;
<a name="l00180"></a>00180     <a class="code" href="class_c_p_index_set.html">CPIndexSet</a>  _selectedRowIndexes;
<a name="l00181"></a>00181     CPInteger   _selectionAnchorRow;
<a name="l00182"></a>00182     <a class="code" href="class_c_p_index_set.html">CPIndexSet</a>  _previouslySelectedRowIndexes;
<a name="l00183"></a>00183     CGPoint     _startTrackingPoint;
<a name="l00184"></a>00184     CPDate      _startTrackingTimestamp;
<a name="l00185"></a>00185     BOOL        _trackingPointMovedOutOfClickSlop;
<a name="l00186"></a>00186     CGPoint     _editingCellIndex;
<a name="l00187"></a>00187 
<a name="l00188"></a>00188     _CPTableDrawView _tableDrawView;
<a name="l00189"></a>00189 
<a name="l00190"></a>00190     <span class="keywordtype">SEL</span>         _doubleAction;
<a name="l00191"></a>00191     <span class="keywordtype">unsigned</span>    _columnAutoResizingStyle;
<a name="l00192"></a>00192 
<a name="l00193"></a>00193     CGPoint     _originalMouseDownPoint;
<a name="l00194"></a>00194     BOOL        _verticalMotionCanDrag;
<a name="l00195"></a>00195     <span class="keywordtype">unsigned</span>    _destinationDragStyle;
<a name="l00196"></a>00196     BOOL        _isSelectingSession;
<a name="l00197"></a>00197     <a class="code" href="class_c_p_index_set.html">CPIndexSet</a>  _draggedRowIndexes;
<a name="l00198"></a>00198     _dropOperationDrawingView _dropOperationFeedbackView;
<a name="l00199"></a>00199     CPDragOperation _dragOperationDefaultMask;
<a name="l00200"></a>00200     <span class="keywordtype">int</span>         _retargetedDropRow;
<a name="l00201"></a>00201     CPDragOperation _retargetedDropOperation;
<a name="l00202"></a>00202 }
<a name="l00203"></a>00203 
<a name="l00204"></a><a class="code" href="class_c_p_table_view.html#a989e49a95e3816cc201830e49965304a">00204</a> - (id)initWithFrame:(CGRect)aFrame
<a name="l00205"></a>00205 {
<a name="l00206"></a>00206     <span class="keyword">self</span> = [<span class="keyword">super</span> initWithFrame:aFrame];
<a name="l00207"></a>00207 
<a name="l00208"></a>00208     <span class="keywordflow">if</span> (<span class="keyword">self</span>)
<a name="l00209"></a>00209     {
<a name="l00210"></a>00210         <span class="comment">//Configuring Behavior</span>
<a name="l00211"></a>00211         _allowsColumnReordering = YES;
<a name="l00212"></a>00212         _allowsColumnResizing = YES;
<a name="l00213"></a>00213         _allowsMultipleSelection = NO;
<a name="l00214"></a>00214         _allowsEmptySelection = YES;
<a name="l00215"></a>00215         _allowsColumnSelection = NO;
<a name="l00216"></a>00216 
<a name="l00217"></a>00217         _tableViewFlags = 0;
<a name="l00218"></a>00218 
<a name="l00219"></a>00219         <span class="comment">//Setting Display Attributes</span>
<a name="l00220"></a>00220         _selectionHighlightMask = <a class="code" href="_c_p_table_view_8j.html#aca8acc7a64967150badd9c4b7c6eedf9">CPTableViewSelectionHighlightStyleRegular</a>;
<a name="l00221"></a>00221 
<a name="l00222"></a>00222         [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#a6265d6d38253d8e95a112e226cdefe4d">setUsesAlternatingRowBackgroundColors</a>:NO];
<a name="l00223"></a>00223         <span class="comment">/*[CPColor colorWithHexString:@&quot;e4e7ff&quot;]*/</span>[<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#aa50e7802368fe0b0be6756beaa70fd71">setAlternatingRowBackgroundColors</a>:[[<a class="code" href="class_c_p_color.html">CPColor</a> whiteColor],  [<a class="code" href="class_c_p_color.html">CPColor</a> colorWithHexString:@&quot;f5f9fc&quot;]]];
<a name="l00224"></a>00224 
<a name="l00225"></a>00225         _tableColumns = [];
<a name="l00226"></a>00226         _tableColumnRanges = [];
<a name="l00227"></a>00227         _dirtyTableColumnRangeIndex = CPNotFound;
<a name="l00228"></a>00228         _numberOfHiddenColumns = 0;
<a name="l00229"></a>00229 
<a name="l00230"></a>00230         _objectValues = { };
<a name="l00231"></a>00231         _dataViewsForTableColumns = { };
<a name="l00232"></a>00232         _dataViews=  [];
<a name="l00233"></a>00233         _numberOfRows = 0;
<a name="l00234"></a>00234         _exposedRows = [<a class="code" href="class_c_p_index_set.html">CPIndexSet</a> indexSet];
<a name="l00235"></a>00235         _exposedColumns = [<a class="code" href="class_c_p_index_set.html">CPIndexSet</a> indexSet];
<a name="l00236"></a>00236         _cachedDataViews = { };
<a name="l00237"></a>00237         _intercellSpacing = _CGSizeMake(0.0, 0.0);
<a name="l00238"></a>00238         _rowHeight = 23.0;
<a name="l00239"></a>00239 
<a name="l00240"></a>00240         [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#a797463d40ea92e38253ffab2986cc36d">setSelectionHightlightColor</a>:[<a class="code" href="class_c_p_color.html">CPColor</a> <a class="code" href="class_c_p_color.html#a3c17f4544abd947afd5d30d7c240c378">selectionColor</a>]];
<a name="l00241"></a>00241         [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#a87d09099f126a8e7e741a192e05e10f7">setGridColor</a>:[<a class="code" href="class_c_p_color.html">CPColor</a> colorWithHexString:@&quot;dce0e2&quot;]];
<a name="l00242"></a>00242         [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#a10dc95485219186d423799fedac67efd">setGridStyleMask</a>:CPTableViewGridNone];
<a name="l00243"></a>00243 
<a name="l00244"></a>00244         _headerView = [[<a class="code" href="class_c_p_table_header_view.html">CPTableHeaderView</a> alloc] initWithFrame:CGRectMake(0, 0, [<span class="keyword">self</span> bounds].size.width, _rowHeight)];
<a name="l00245"></a>00245 
<a name="l00246"></a>00246         [_headerView setTableView:self];
<a name="l00247"></a>00247 
<a name="l00248"></a>00248         _cornerView = [[_CPCornerView alloc] initWithFrame:CGRectMake(0, 0, [<a class="code" href="class_c_p_scroller.html">CPScroller</a> <a class="code" href="class_c_p_scroller.html#aa561236fe659f6ccd8f06f7c6755476e">scrollerWidth</a>], CGRectGetHeight([_headerView frame]))];
<a name="l00249"></a>00249 
<a name="l00250"></a>00250         _selectedColumnIndexes = [<a class="code" href="class_c_p_index_set.html">CPIndexSet</a> indexSet];
<a name="l00251"></a>00251         _selectedRowIndexes = [<a class="code" href="class_c_p_index_set.html">CPIndexSet</a> indexSet];
<a name="l00252"></a>00252 
<a name="l00253"></a>00253         _draggedRowIndexes = [<a class="code" href="class_c_p_index_set.html">CPIndexSet</a> indexSet];
<a name="l00254"></a>00254         _verticalMotionCanDrag = YES;
<a name="l00255"></a>00255         _isSelectingSession = NO;
<a name="l00256"></a>00256         _retargetedDropRow = nil;
<a name="l00257"></a>00257         _retargetedDropOperation = nil;
<a name="l00258"></a>00258         _dragOperationDefaultMask = nil;
<a name="l00259"></a>00259         _destinationDragStyle = <a class="code" href="_c_p_table_view_8j.html#a4b9131f16846d5b2e77fbb2d855f48c1">CPTableViewDraggingDestinationFeedbackStyleRegular</a>;
<a name="l00260"></a>00260         _dropOperationFeedbackView = [[_dropOperationDrawingView alloc] initWithFrame:_CGRectMakeZero()];
<a name="l00261"></a>00261         [<span class="keyword">self</span> addSubview:_dropOperationFeedbackView];
<a name="l00262"></a>00262         [_dropOperationFeedbackView setHidden:YES];
<a name="l00263"></a>00263         [_dropOperationFeedbackView setTableView:self];
<a name="l00264"></a>00264 
<a name="l00265"></a>00265         _tableDrawView = [[_CPTableDrawView alloc] initWithTableView:self];
<a name="l00266"></a>00266         [_tableDrawView setBackgroundColor:[<a class="code" href="class_c_p_color.html">CPColor</a> clearColor]];
<a name="l00267"></a>00267         [<span class="keyword">self</span> addSubview:_tableDrawView];
<a name="l00268"></a>00268 
<a name="l00269"></a>00269     }
<a name="l00270"></a>00270 
<a name="l00271"></a>00271     <span class="keywordflow">return</span> <span class="keyword">self</span>;
<a name="l00272"></a>00272 }
<a name="l00273"></a>00273 
<a name="l00274"></a>00274 
<a name="l00279"></a><a class="code" href="class_c_p_table_view.html#a13b891524111eeb3c8873a789df3cb6a">00279</a> - (void)setDataSource:(<span class="keywordtype">id</span>)aDataSource
<a name="l00280"></a>00280 {
<a name="l00281"></a>00281     <span class="keywordflow">if</span> (_dataSource === aDataSource)
<a name="l00282"></a>00282         <span class="keywordflow">return</span>;
<a name="l00283"></a>00283 
<a name="l00284"></a>00284     _dataSource = aDataSource;
<a name="l00285"></a>00285     _implementedDataSourceMethods = 0;
<a name="l00286"></a>00286 
<a name="l00287"></a>00287     <span class="keywordflow">if</span> (!_dataSource)
<a name="l00288"></a>00288         <span class="keywordflow">return</span>;
<a name="l00289"></a>00289 
<a name="l00290"></a>00290     <span class="keywordflow">if</span> (![_dataSource respondsToSelector:<span class="keyword">@selector</span>(numberOfRowsInTableView:)])
<a name="l00291"></a>00291         [CPException raise:CPInternalInconsistencyException
<a name="l00292"></a>00292                 reason:[aDataSource description] + &quot; does not implement numberOfRowsInTableView:.&quot;];
<a name="l00293"></a>00293 
<a name="l00294"></a>00294     <span class="keywordflow">if</span> (![_dataSource respondsToSelector:<span class="keyword">@selector</span>(tableView:objectValueForTableColumn:row:)])
<a name="l00295"></a>00295         [CPException raise:CPInternalInconsistencyException
<a name="l00296"></a>00296                 reason:[aDataSource description] + &quot; does not implement tableView:objectValueForTableColumn:row:&quot;];
<a name="l00297"></a>00297 
<a name="l00298"></a>00298     <span class="keywordflow">if</span> ([_dataSource respondsToSelector:<span class="keyword">@selector</span>(tableView:setObjectValue:forTableColumn:row:)])
<a name="l00299"></a>00299         _implementedDataSourceMethods |= <a class="code" href="_c_p_table_view_8j.html#a9f25c28df39dca590ad108beb6b4b48b">CPTableViewDataSource_tableView_setObjectValue_forTableColumn_row_</a>;
<a name="l00300"></a>00300 
<a name="l00301"></a>00301     <span class="keywordflow">if</span> ([_dataSource respondsToSelector:<span class="keyword">@selector</span>(tableView:acceptDrop:row:dropOperation:)])
<a name="l00302"></a>00302         _implementedDataSourceMethods |= <a class="code" href="_c_p_table_view_8j.html#a71f4aae1a37e8503f63542e1d977edce">CPTableViewDataSource_tableView_acceptDrop_row_dropOperation_</a>;
<a name="l00303"></a>00303 
<a name="l00304"></a>00304     <span class="keywordflow">if</span> ([_dataSource respondsToSelector:<span class="keyword">@selector</span>(tableView:namesOfPromisedFilesDroppedAtDestination:forDraggedRowsWithIndexes:)])
<a name="l00305"></a>00305         _implementedDataSourceMethods |= <a class="code" href="_c_p_table_view_8j.html#a70eaee52bd8ae42e829dc246bfffa90f">CPTableViewDataSource_tableView_namesOfPromisedFilesDroppedAtDestination_forDraggedRowsWithIndexes_</a>;
<a name="l00306"></a>00306 
<a name="l00307"></a>00307     <span class="keywordflow">if</span> ([_dataSource respondsToSelector:<span class="keyword">@selector</span>(tableView:validateDrop:proposedRow:proposedDropOperation:)])
<a name="l00308"></a>00308         _implementedDataSourceMethods |= <a class="code" href="_c_p_table_view_8j.html#a4f6917aa9754d8c13c933ae043ca4963">CPTableViewDataSource_tableView_validateDrop_proposedRow_proposedDropOperation_</a>;
<a name="l00309"></a>00309 
<a name="l00310"></a>00310     <span class="keywordflow">if</span> ([_dataSource respondsToSelector:<span class="keyword">@selector</span>(tableView:writeRowsWithIndexes:toPasteboard:)])
<a name="l00311"></a>00311         _implementedDataSourceMethods |= <a class="code" href="_c_p_table_view_8j.html#a3fb0a731ef8cca0484830f426bcbe81f">CPTableViewDataSource_tableView_writeRowsWithIndexes_toPasteboard_</a>;
<a name="l00312"></a>00312 
<a name="l00313"></a>00313     [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#a25ec67f805f6a97b91879cb04933310e">reloadData</a>];
<a name="l00314"></a>00314 }
<a name="l00315"></a>00315 
<a name="l00319"></a><a class="code" href="class_c_p_table_view.html#a95b4de8f3494b67946e65f9cc914bd63">00319</a> - (id)dataSource
<a name="l00320"></a>00320 {
<a name="l00321"></a>00321     <span class="keywordflow">return</span> _dataSource;
<a name="l00322"></a>00322 }
<a name="l00323"></a>00323 
<a name="l00324"></a>00324 <span class="comment">//Loading Data</span>
<a name="l00325"></a>00325 
<a name="l00331"></a><a class="code" href="class_c_p_table_view.html#a69ae01655437f565b3f51bd2805fe68a">00331</a> - (void)reloadDataForRowIndexes:(<a class="code" href="class_c_p_index_set.html">CPIndexSet</a>)rowIndexes columnIndexes:(<a class="code" href="class_c_p_index_set.html">CPIndexSet</a>)columnIndexes
<a name="l00332"></a>00332 {
<a name="l00333"></a>00333     [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#a25ec67f805f6a97b91879cb04933310e">reloadData</a>];
<a name="l00334"></a>00334 <span class="comment">//    [_previouslyExposedRows removeIndexes:rowIndexes];</span>
<a name="l00335"></a>00335 <span class="comment">//    [_previouslyExposedColumns removeIndexes:columnIndexes];</span>
<a name="l00336"></a>00336 }
<a name="l00337"></a>00337 
<a name="l00342"></a><a class="code" href="class_c_p_table_view.html#a25ec67f805f6a97b91879cb04933310e">00342</a> - (void)reloadData
<a name="l00343"></a>00343 {
<a name="l00344"></a>00344     <span class="keywordflow">if</span> (!_dataSource)
<a name="l00345"></a>00345         <span class="keywordflow">return</span>;
<a name="l00346"></a>00346 
<a name="l00347"></a>00347     _reloadAllRows = YES;
<a name="l00348"></a>00348     _objectValues = { };
<a name="l00349"></a>00349 
<a name="l00350"></a>00350     <span class="comment">// This updates the size too.</span>
<a name="l00351"></a>00351     [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#aa1b1194b660a264c3c330892e4f4ffe4">noteNumberOfRowsChanged</a>];
<a name="l00352"></a>00352 
<a name="l00353"></a>00353     [<span class="keyword">self</span> setNeedsLayout];
<a name="l00354"></a>00354     [<span class="keyword">self</span> setNeedsDisplay:YES];
<a name="l00355"></a>00355 }
<a name="l00356"></a>00356 
<a name="l00357"></a>00357 <span class="comment">//Target-action Behavior</span>
<a name="l00362"></a><a class="code" href="class_c_p_table_view.html#a0b5806376d8b3bd70908606b9f033967">00362</a> <span class="comment"></span>- (void)setDoubleAction:(<span class="keywordtype">SEL</span>)anAction
<a name="l00363"></a>00363 {
<a name="l00364"></a>00364     _doubleAction = anAction;
<a name="l00365"></a>00365 }
<a name="l00366"></a>00366 
<a name="l00367"></a><a class="code" href="class_c_p_table_view.html#a88e1bd1cff9f5263bbf63e70fe072590">00367</a> - (SEL)doubleAction
<a name="l00368"></a>00368 {
<a name="l00369"></a>00369     <span class="keywordflow">return</span> _doubleAction;
<a name="l00370"></a>00370 }
<a name="l00371"></a>00371 
<a name="l00372"></a>00372 <span class="comment">/*</span>
<a name="l00373"></a>00373 <span class="comment">    * - clickedColumn</span>
<a name="l00374"></a>00374 <span class="comment">    * - clickedRow</span>
<a name="l00375"></a>00375 <span class="comment">*/</span>
<a name="l00376"></a>00376 <span class="comment">//Configuring Behavior</span>
<a name="l00377"></a>00377 
<a name="l00378"></a><a class="code" href="class_c_p_table_view.html#ac51162f8f381b09f8d5675f93f20dc3e">00378</a> - (void)setAllowsColumnReordering:(BOOL)shouldAllowColumnReordering
<a name="l00379"></a>00379 {
<a name="l00380"></a>00380     _allowsColumnReordering = !!shouldAllowColumnReordering;
<a name="l00381"></a>00381 }
<a name="l00382"></a>00382 
<a name="l00383"></a><a class="code" href="class_c_p_table_view.html#aafea3a20010fe56053976716aefd3e23">00383</a> - (BOOL)allowsColumnReordering
<a name="l00384"></a>00384 {
<a name="l00385"></a>00385     <span class="keywordflow">return</span> _allowsColumnReordering;
<a name="l00386"></a>00386 }
<a name="l00387"></a>00387 
<a name="l00388"></a><a class="code" href="class_c_p_table_view.html#a2d6fa30d3c1e3ca05fb35c0a3399936b">00388</a> - (void)setAllowsColumnResizing:(BOOL)shouldAllowColumnResizing
<a name="l00389"></a>00389 {
<a name="l00390"></a>00390     _allowsColumnResizing = !!shouldAllowColumnResizing;
<a name="l00391"></a>00391 }
<a name="l00392"></a>00392 
<a name="l00393"></a><a class="code" href="class_c_p_table_view.html#aff343b53a8899d41f057c9cc83623246">00393</a> - (BOOL)allowsColumnResizing
<a name="l00394"></a>00394 {
<a name="l00395"></a>00395     <span class="keywordflow">return</span> _allowsColumnResizing;
<a name="l00396"></a>00396 }
<a name="l00397"></a>00397 
<a name="l00402"></a><a class="code" href="class_c_p_table_view.html#a686ac257cf5af1e68814683a8221bc73">00402</a> - (void)setAllowsMultipleSelection:(BOOL)shouldAllowMultipleSelection
<a name="l00403"></a>00403 {
<a name="l00404"></a>00404     _allowsMultipleSelection = !!shouldAllowMultipleSelection;
<a name="l00405"></a>00405 }
<a name="l00406"></a>00406 
<a name="l00407"></a><a class="code" href="class_c_p_table_view.html#aabfd101c3912b0326c6c3771f6b7563f">00407</a> - (BOOL)allowsMultipleSelection
<a name="l00408"></a>00408 {
<a name="l00409"></a>00409     <span class="keywordflow">return</span> _allowsMultipleSelection;
<a name="l00410"></a>00410 }
<a name="l00411"></a>00411 
<a name="l00416"></a><a class="code" href="class_c_p_table_view.html#af021ea8b8110ac3546501724d00e5310">00416</a> - (void)setAllowsEmptySelection:(BOOL)shouldAllowEmptySelection
<a name="l00417"></a>00417 {
<a name="l00418"></a>00418     _allowsEmptySelection = !!shouldAllowEmptySelection;
<a name="l00419"></a>00419 }
<a name="l00420"></a>00420 
<a name="l00421"></a><a class="code" href="class_c_p_table_view.html#a2564b452a1cc98317407513f15853a0b">00421</a> - (BOOL)allowsEmptySelection
<a name="l00422"></a>00422 {
<a name="l00423"></a>00423     <span class="keywordflow">return</span> _allowsEmptySelection;
<a name="l00424"></a>00424 }
<a name="l00425"></a>00425 
<a name="l00431"></a><a class="code" href="class_c_p_table_view.html#aabe3fb9faaa638fdc941544fca72c7f3">00431</a> - (void)setAllowsColumnSelection:(BOOL)shouldAllowColumnSelection
<a name="l00432"></a>00432 {
<a name="l00433"></a>00433     _allowsColumnSelection = !!shouldAllowColumnSelection;
<a name="l00434"></a>00434 }
<a name="l00435"></a>00435 
<a name="l00436"></a><a class="code" href="class_c_p_table_view.html#ac26501a6db564b0ff7c3574f6fa675ae">00436</a> - (BOOL)allowsColumnSelection
<a name="l00437"></a>00437 {
<a name="l00438"></a>00438     <span class="keywordflow">return</span> _allowsColumnSelection;
<a name="l00439"></a>00439 }
<a name="l00440"></a>00440 
<a name="l00441"></a>00441 <span class="comment">//Setting Display Attributes</span>
<a name="l00442"></a>00442 
<a name="l00443"></a><a class="code" href="class_c_p_table_view.html#ae865cae60edeccb26435c710eb6198b9">00443</a> - (void)setIntercellSpacing:(CGSize)aSize
<a name="l00444"></a>00444 {
<a name="l00445"></a>00445     <span class="keywordflow">if</span> (_CGSizeEqualToSize(_intercellSpacing, aSize))
<a name="l00446"></a>00446         <span class="keywordflow">return</span>;
<a name="l00447"></a>00447 
<a name="l00448"></a>00448     _intercellSpacing = _CGSizeMakeCopy(aSize);
<a name="l00449"></a>00449 
<a name="l00450"></a>00450     [<span class="keyword">self</span> setNeedsLayout];
<a name="l00451"></a>00451 }
<a name="l00452"></a>00452 
<a name="l00453"></a><a class="code" href="class_c_p_table_view.html#aa85238a0533b228fb9ba23faf4c2e273">00453</a> - (void)setThemeState:(<span class="keywordtype">int</span>)astae
<a name="l00454"></a>00454 {
<a name="l00455"></a>00455 }
<a name="l00456"></a>00456 
<a name="l00457"></a><a class="code" href="class_c_p_table_view.html#afc5c31281c6039f4f36f5b156152f98b">00457</a> - (CGSize)intercellSpacing
<a name="l00458"></a>00458 {
<a name="l00459"></a>00459     <span class="keywordflow">return</span> _CGSizeMakeCopy(_intercellSpacing);
<a name="l00460"></a>00460 }
<a name="l00461"></a>00461 
<a name="l00462"></a><a class="code" href="class_c_p_table_view.html#a81cdb48fa8ad23cbab2f9ed44f6ff172">00462</a> - (void)setRowHeight:(<span class="keywordtype">unsigned</span>)aRowHeight
<a name="l00463"></a>00463 {
<a name="l00464"></a>00464     aRowHeight = +aRowHeight;
<a name="l00465"></a>00465 
<a name="l00466"></a>00466     <span class="keywordflow">if</span> (_rowHeight === aRowHeight)
<a name="l00467"></a>00467         <span class="keywordflow">return</span>;
<a name="l00468"></a>00468 
<a name="l00469"></a>00469     _rowHeight = MAX(0.0, aRowHeight);
<a name="l00470"></a>00470 
<a name="l00471"></a>00471     [<span class="keyword">self</span> setNeedsLayout];
<a name="l00472"></a>00472 }
<a name="l00473"></a>00473 
<a name="l00474"></a><a class="code" href="class_c_p_table_view.html#a37b1a549fa54390fd5c824fc2a405122">00474</a> - (unsigned)rowHeight
<a name="l00475"></a>00475 {
<a name="l00476"></a>00476     <span class="keywordflow">return</span> _rowHeight;
<a name="l00477"></a>00477 }
<a name="l00478"></a>00478 
<a name="l00483"></a><a class="code" href="class_c_p_table_view.html#a6265d6d38253d8e95a112e226cdefe4d">00483</a> - (void)setUsesAlternatingRowBackgroundColors:(BOOL)shouldUseAlternatingRowBackgroundColors
<a name="l00484"></a>00484 {
<a name="l00485"></a>00485     _usesAlternatingRowBackgroundColors = shouldUseAlternatingRowBackgroundColors;
<a name="l00486"></a>00486 }
<a name="l00487"></a>00487 
<a name="l00488"></a><a class="code" href="class_c_p_table_view.html#a10754c93019a092e554c07ac969adf59">00488</a> - (BOOL)usesAlternatingRowBackgroundColors
<a name="l00489"></a>00489 {
<a name="l00490"></a>00490     <span class="keywordflow">return</span> _usesAlternatingRowBackgroundColors;
<a name="l00491"></a>00491 }
<a name="l00492"></a>00492 
<a name="l00498"></a><a class="code" href="class_c_p_table_view.html#aa50e7802368fe0b0be6756beaa70fd71">00498</a> - (void)setAlternatingRowBackgroundColors:(CPArray)alternatingRowBackgroundColors
<a name="l00499"></a>00499 {
<a name="l00500"></a>00500     <span class="keywordflow">if</span> ([_alternatingRowBackgroundColors isEqual:alternatingRowBackgroundColors])
<a name="l00501"></a>00501         <span class="keywordflow">return</span>;
<a name="l00502"></a>00502 
<a name="l00503"></a>00503     _alternatingRowBackgroundColors = alternatingRowBackgroundColors;
<a name="l00504"></a>00504 
<a name="l00505"></a>00505     [<span class="keyword">self</span> setNeedsDisplay:YES];
<a name="l00506"></a>00506 }
<a name="l00507"></a>00507 
<a name="l00508"></a><a class="code" href="class_c_p_table_view.html#aa31301940f52f185b7905f89a17e9bc1">00508</a> - (CPArray)alternatingRowBackgroundColors
<a name="l00509"></a>00509 {
<a name="l00510"></a>00510     <span class="keywordflow">return</span> _alternatingRowBackgroundColors;
<a name="l00511"></a>00511 }
<a name="l00512"></a>00512 
<a name="l00513"></a><a class="code" href="class_c_p_table_view.html#afb36a911c32b6b31152cbb458feebc3b">00513</a> - (unsigned)selectionHighlightStyle
<a name="l00514"></a>00514 {
<a name="l00515"></a>00515     <span class="keywordflow">return</span> _selectionHighlightMask;
<a name="l00516"></a>00516 }
<a name="l00517"></a>00517 
<a name="l00518"></a><a class="code" href="class_c_p_table_view.html#af68f68ebb5944d09c7b999d124aebd97">00518</a> - (void)setSelectionHighlightStyle:(<span class="keywordtype">unsigned</span>)aSelectionHighlightStyle
<a name="l00519"></a>00519 {
<a name="l00520"></a>00520     _selectionHighlightMask = aSelectionHighlightStyle;
<a name="l00521"></a>00521 
<a name="l00522"></a>00522     <span class="keywordflow">if</span> ([<span class="keyword">self</span> selectionHighlightStyle] === <a class="code" href="_c_p_table_view_8j.html#a9b1494c16eb023b6a546dc0fb584fce7">CPTableViewSelectionHighlightStyleSourceList</a>)
<a name="l00523"></a>00523     {
<a name="l00524"></a>00524         [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#a797463d40ea92e38253ffab2986cc36d">setSelectionHightlightColor</a>:[<a class="code" href="class_c_p_color.html">CPColor</a> <a class="code" href="class_c_p_color.html#a1226e56d2ace061bd057253bcb8a26f6">selectionColorSourceView</a>]];
<a name="l00525"></a>00525         _destinationDragStyle = <a class="code" href="_c_p_table_view_8j.html#a5c1e1977569dc9ea54f519916529114b">CPTableViewDraggingDestinationFeedbackStyleSourceList</a>;
<a name="l00526"></a>00526     }
<a name="l00527"></a>00527     <span class="keywordflow">else</span>
<a name="l00528"></a>00528     {
<a name="l00529"></a>00529         [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#a797463d40ea92e38253ffab2986cc36d">setSelectionHightlightColor</a>:[<a class="code" href="class_c_p_color.html">CPColor</a> <a class="code" href="class_c_p_color.html#a3c17f4544abd947afd5d30d7c240c378">selectionColor</a>]];
<a name="l00530"></a>00530         _destinationDragStyle = <a class="code" href="_c_p_table_view_8j.html#a4b9131f16846d5b2e77fbb2d855f48c1">CPTableViewDraggingDestinationFeedbackStyleRegular</a>;
<a name="l00531"></a>00531     }
<a name="l00532"></a>00532 }
<a name="l00533"></a>00533 
<a name="l00539"></a><a class="code" href="class_c_p_table_view.html#a797463d40ea92e38253ffab2986cc36d">00539</a> - (void)setSelectionHightlightColor:(<a class="code" href="class_c_p_color.html">CPColor</a>)aColor
<a name="l00540"></a>00540 {
<a name="l00541"></a>00541     _selectionHightlightColor = aColor;
<a name="l00542"></a>00542 }
<a name="l00543"></a>00543 
<a name="l00544"></a><a class="code" href="class_c_p_table_view.html#a9f3a9fbc1b2a9b0a3cff28b330feef3b">00544</a> - (<a class="code" href="class_c_p_color.html">CPColor</a>)selectionHightlightColor
<a name="l00545"></a>00545 {
<a name="l00546"></a>00546     <span class="keywordflow">return</span> _selectionHightlightColor;
<a name="l00547"></a>00547 }
<a name="l00548"></a>00548 
<a name="l00549"></a>00549 <span class="comment">/*</span>
<a name="l00550"></a>00550 <span class="comment">    * - indicatorImageInTableColumn:</span>
<a name="l00551"></a>00551 <span class="comment">    * - setIndicatorImage:inTableColumn:</span>
<a name="l00552"></a>00552 <span class="comment">*/</span>
<a name="l00553"></a>00553 
<a name="l00558"></a><a class="code" href="class_c_p_table_view.html#a87d09099f126a8e7e741a192e05e10f7">00558</a> - (void)setGridColor:(<a class="code" href="class_c_p_color.html">CPColor</a>)aColor
<a name="l00559"></a>00559 {
<a name="l00560"></a>00560     <span class="keywordflow">if</span> (_gridColor === aColor)
<a name="l00561"></a>00561         <span class="keywordflow">return</span>;
<a name="l00562"></a>00562 
<a name="l00563"></a>00563     _gridColor = aColor;
<a name="l00564"></a>00564 
<a name="l00565"></a>00565     [<span class="keyword">self</span> setNeedsDisplay:YES];
<a name="l00566"></a>00566 }
<a name="l00567"></a>00567 
<a name="l00568"></a><a class="code" href="class_c_p_table_view.html#a23c390780203dd17c0593b269b705814">00568</a> - (<a class="code" href="class_c_p_color.html">CPColor</a>)gridColor
<a name="l00569"></a>00569 {
<a name="l00570"></a>00570     <span class="keywordflow">return</span> _gridColor;
<a name="l00571"></a>00571 }
<a name="l00572"></a>00572 
<a name="l00578"></a><a class="code" href="class_c_p_table_view.html#a10dc95485219186d423799fedac67efd">00578</a> - (void)setGridStyleMask:(<span class="keywordtype">unsigned</span>)aGrideStyleMask
<a name="l00579"></a>00579 {
<a name="l00580"></a>00580     <span class="keywordflow">if</span> (_gridStyleMask === aGrideStyleMask)
<a name="l00581"></a>00581         <span class="keywordflow">return</span>;
<a name="l00582"></a>00582 
<a name="l00583"></a>00583     _gridStyleMask = aGrideStyleMask;
<a name="l00584"></a>00584 
<a name="l00585"></a>00585     [<span class="keyword">self</span> setNeedsDisplay:YES];
<a name="l00586"></a>00586 }
<a name="l00587"></a>00587 
<a name="l00588"></a><a class="code" href="class_c_p_table_view.html#a9b133d62d7aba9a887f38e686627e160">00588</a> - (unsigned)gridStyleMask
<a name="l00589"></a>00589 {
<a name="l00590"></a>00590     <span class="keywordflow">return</span> _gridStyleMask;
<a name="l00591"></a>00591 }
<a name="l00592"></a>00592 
<a name="l00593"></a>00593 <span class="comment">//Column Management</span>
<a name="l00594"></a>00594 
<a name="l00599"></a><a class="code" href="class_c_p_table_view.html#a3ab58abeecd8620354e7686b04869331">00599</a> - (void)addTableColumn:(<a class="code" href="class_c_p_table_column.html">CPTableColumn</a>)aTableColumn
<a name="l00600"></a>00600 {
<a name="l00601"></a>00601     [_tableColumns addObject:aTableColumn];
<a name="l00602"></a>00602     [aTableColumn <a class="code" href="class_c_p_table_column.html#ad5566ac159b6de84c6672343cbffae17">setTableView</a>:self];
<a name="l00603"></a>00603 
<a name="l00604"></a>00604     <span class="keywordflow">if</span> (_dirtyTableColumnRangeIndex &lt; 0)
<a name="l00605"></a>00605         _dirtyTableColumnRangeIndex = <a class="code" href="_c_p_table_view_8j.html#aa0c3e20940452d04b6708ec8b82b482b">NUMBER_OF_COLUMNS</a>() - 1;
<a name="l00606"></a>00606     <span class="keywordflow">else</span>
<a name="l00607"></a>00607         _dirtyTableColumnRangeIndex = MIN(<a class="code" href="_c_p_table_view_8j.html#aa0c3e20940452d04b6708ec8b82b482b">NUMBER_OF_COLUMNS</a>() - 1, _dirtyTableColumnRangeIndex);
<a name="l00608"></a>00608 
<a name="l00609"></a>00609     [<span class="keyword">self</span> setNeedsLayout];
<a name="l00610"></a>00610 }
<a name="l00611"></a>00611 
<a name="l00616"></a><a class="code" href="class_c_p_table_view.html#a198e564259771a27d4ab7664c591cde2">00616</a> - (void)removeTableColumn:(<a class="code" href="class_c_p_table_column.html">CPTableColumn</a>)aTableColumn
<a name="l00617"></a>00617 {
<a name="l00618"></a>00618     <span class="keywordflow">if</span> ([aTableColumn tableView] !== <span class="keyword">self</span>)
<a name="l00619"></a>00619         <span class="keywordflow">return</span>;
<a name="l00620"></a>00620 
<a name="l00621"></a>00621     var index = [_tableColumns indexOfObjectIdenticalTo:aTableColumn];
<a name="l00622"></a>00622 
<a name="l00623"></a>00623     <span class="keywordflow">if</span> (index === CPNotFound)
<a name="l00624"></a>00624         <span class="keywordflow">return</span>;
<a name="l00625"></a>00625 
<a name="l00626"></a>00626     [aTableColumn <a class="code" href="class_c_p_table_column.html#ad5566ac159b6de84c6672343cbffae17">setTableView</a>:nil];
<a name="l00627"></a>00627     [_tableColumns removeObjectAtIndex:index];
<a name="l00628"></a>00628 
<a name="l00629"></a>00629     var tableColumnUID = [aTableColumn UID];
<a name="l00630"></a>00630 
<a name="l00631"></a>00631     <span class="keywordflow">if</span> (_objectValues[tableColumnUID])
<a name="l00632"></a>00632         _objectValues[tableColumnUID] = nil;
<a name="l00633"></a>00633 
<a name="l00634"></a>00634     <span class="keywordflow">if</span> (_dirtyTableColumnRangeIndex &lt; 0)
<a name="l00635"></a>00635         _dirtyTableColumnRangeIndex = index;
<a name="l00636"></a>00636     <span class="keywordflow">else</span>
<a name="l00637"></a>00637         _dirtyTableColumnRangeIndex = MIN(index, _dirtyTableColumnRangeIndex);
<a name="l00638"></a>00638 
<a name="l00639"></a>00639     [<span class="keyword">self</span> setNeedsLayout];
<a name="l00640"></a>00640 }
<a name="l00641"></a>00641 
<a name="l00642"></a>00642 
<a name="l00648"></a><a class="code" href="class_c_p_table_view.html#aec7fc701c1e11b098e12af155daa14b0">00648</a> - (void)moveColumn:(<span class="keywordtype">unsigned</span>)fromIndex toColumn:(<span class="keywordtype">unsigned</span>)toIndex
<a name="l00649"></a>00649 {
<a name="l00650"></a>00650     fromIndex = +fromIndex;
<a name="l00651"></a>00651     toIndex = +toIndex;
<a name="l00652"></a>00652 
<a name="l00653"></a>00653     <span class="keywordflow">if</span> (fromIndex === toIndex)
<a name="l00654"></a>00654         <span class="keywordflow">return</span>;
<a name="l00655"></a>00655 
<a name="l00656"></a>00656     <span class="keywordflow">if</span> (_dirtyTableColumnRangeIndex &lt; 0)
<a name="l00657"></a>00657         _dirtyTableColumnRangeIndex = MIN(fromIndex, toIndex);
<a name="l00658"></a>00658     <span class="keywordflow">else</span>
<a name="l00659"></a>00659         _dirtyTableColumnRangeIndex = MIN(fromIndex, toIndex, _dirtyTableColumnRangeIndex);
<a name="l00660"></a>00660 
<a name="l00661"></a>00661     <span class="keywordflow">if</span> (toIndex &gt; fromIndex)
<a name="l00662"></a>00662         --toIndex;
<a name="l00663"></a>00663 
<a name="l00664"></a>00664     var tableColumn = _tableColumns[fromIndex];
<a name="l00665"></a>00665 
<a name="l00666"></a>00666     [_tableColumns removeObjectAtIndex:fromIndex];
<a name="l00667"></a>00667     [_tableColumns insertObject:tableColumn atIndex:toIndex];
<a name="l00668"></a>00668 
<a name="l00669"></a>00669     [<span class="keyword">self</span> setNeedsLayout];
<a name="l00670"></a>00670 }
<a name="l00671"></a>00671 
<a name="l00672"></a><a class="code" href="class_c_p_table_view.html#addef4fffbf36e02b399b1fad4425b71e">00672</a> - (CPArray)tableColumns
<a name="l00673"></a>00673 {
<a name="l00674"></a>00674     <span class="keywordflow">return</span> _tableColumns;
<a name="l00675"></a>00675 }
<a name="l00676"></a>00676 
<a name="l00677"></a><a class="code" href="class_c_p_table_view.html#a0e0170cf4b064a18328eaf849f164151">00677</a> - (CPInteger)columnWithIdentifier:(<a class="code" href="class_c_p_string.html">CPString</a>)anIdentifier
<a name="l00678"></a>00678 {
<a name="l00679"></a>00679     var index = 0,
<a name="l00680"></a>00680         count = <a class="code" href="_c_p_table_view_8j.html#aa0c3e20940452d04b6708ec8b82b482b">NUMBER_OF_COLUMNS</a>();
<a name="l00681"></a>00681 
<a name="l00682"></a>00682     <span class="keywordflow">for</span> (; index &lt; count; ++index)
<a name="l00683"></a>00683         <span class="keywordflow">if</span> ([_tableColumns[index] identifier] === anIdentifier)
<a name="l00684"></a>00684             <span class="keywordflow">return</span> index;
<a name="l00685"></a>00685 
<a name="l00686"></a>00686     <span class="keywordflow">return</span> CPNotFound;
<a name="l00687"></a>00687 }
<a name="l00688"></a>00688 
<a name="l00689"></a><a class="code" href="class_c_p_table_view.html#ac38f1645e78de903c53e3d51ea2c34ac">00689</a> - (<a class="code" href="class_c_p_table_column.html">CPTableColumn</a>)tableColumnWithIdentifier:(<a class="code" href="class_c_p_string.html">CPString</a>)anIdentifier
<a name="l00690"></a>00690 {
<a name="l00691"></a>00691     var index = [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#a0e0170cf4b064a18328eaf849f164151">columnWithIdentifier</a>:anIdentifier];
<a name="l00692"></a>00692 
<a name="l00693"></a>00693     <span class="keywordflow">if</span> (index === CPNotFound)
<a name="l00694"></a>00694         <span class="keywordflow">return</span> nil;
<a name="l00695"></a>00695 
<a name="l00696"></a>00696     <span class="keywordflow">return</span> _tableColumns[index];
<a name="l00697"></a>00697 }
<a name="l00698"></a>00698 
<a name="l00699"></a>00699 <span class="comment">//Selecting Columns and Rows</span>
<a name="l00700"></a>00700 
<a name="l00706"></a><a class="code" href="class_c_p_table_view.html#aea838609fe453ae9ed670d98c3c4ff04">00706</a> - (void)selectColumnIndexes:(<a class="code" href="class_c_p_index_set.html">CPIndexSet</a>)columns byExtendingSelection:(BOOL)shouldExtendSelection
<a name="l00707"></a>00707 {
<a name="l00708"></a>00708     <span class="comment">// If we&#39;re out of range, just return</span>
<a name="l00709"></a>00709     <span class="keywordflow">if</span> (([columns firstIndex] != CPNotFound &amp;&amp; [columns firstIndex] &lt; 0) || [columns lastIndex] &gt;= [<span class="keyword">self</span> numberOfColumns])
<a name="l00710"></a>00710         <span class="keywordflow">return</span>;
<a name="l00711"></a>00711 
<a name="l00712"></a>00712     <span class="comment">// We deselect all rows when selecting columns.</span>
<a name="l00713"></a>00713     <span class="keywordflow">if</span> ([_selectedRowIndexes count] &gt; 0)
<a name="l00714"></a>00714     {
<a name="l00715"></a>00715         [<span class="keyword">self</span> _updateHighlightWithOldRows:_selectedRowIndexes newRows:[<a class="code" href="class_c_p_index_set.html">CPIndexSet</a> indexSet]];
<a name="l00716"></a>00716         _selectedRowIndexes = [<a class="code" href="class_c_p_index_set.html">CPIndexSet</a> indexSet];
<a name="l00717"></a>00717     }
<a name="l00718"></a>00718 
<a name="l00719"></a>00719     var previousSelectedIndexes = [_selectedColumnIndexes copy];
<a name="l00720"></a>00720 
<a name="l00721"></a>00721     <span class="keywordflow">if</span> (shouldExtendSelection)
<a name="l00722"></a>00722         [_selectedColumnIndexes addIndexes:columns];
<a name="l00723"></a>00723     <span class="keywordflow">else</span>
<a name="l00724"></a>00724         _selectedColumnIndexes = [columns copy];
<a name="l00725"></a>00725 
<a name="l00726"></a>00726     [<span class="keyword">self</span> _updateHighlightWithOldColumns:previousSelectedIndexes newColumns:_selectedColumnIndexes];
<a name="l00727"></a>00727     [_tableDrawView display]; <span class="comment">// FIXME: should be setNeedsDisplayInRect:enclosing rect of new (de)selected columns</span>
<a name="l00728"></a>00728                               <span class="comment">// but currently -drawRect: is not implemented here</span>
<a name="l00729"></a>00729     [_headerView setNeedsDisplay:YES];
<a name="l00730"></a>00730 
<a name="l00731"></a>00731     [<span class="keyword">self</span> _noteSelectionDidChange];
<a name="l00732"></a>00732 }
<a name="l00733"></a>00733 
<a name="l00739"></a><a class="code" href="class_c_p_table_view.html#a9b6204a962c90a046897dce505fec408">00739</a> - (void)selectRowIndexes:(<a class="code" href="class_c_p_index_set.html">CPIndexSet</a>)rows byExtendingSelection:(BOOL)shouldExtendSelection
<a name="l00740"></a>00740 {
<a name="l00741"></a>00741     <span class="keywordflow">if</span> ([rows isEqualToIndexSet:_selectedRowIndexes] || (([rows firstIndex] != CPNotFound &amp;&amp; [rows firstIndex] &lt; 0) || [rows lastIndex] &gt;= [<span class="keyword">self</span> numberOfRows]))
<a name="l00742"></a>00742         <span class="keywordflow">return</span>;
<a name="l00743"></a>00743 
<a name="l00744"></a>00744     <span class="comment">// We deselect all columns when selecting rows.</span>
<a name="l00745"></a>00745     <span class="keywordflow">if</span> ([_selectedColumnIndexes count] &gt; 0)
<a name="l00746"></a>00746     {
<a name="l00747"></a>00747         [<span class="keyword">self</span> _updateHighlightWithOldColumns:_selectedColumnIndexes newColumns:[<a class="code" href="class_c_p_index_set.html">CPIndexSet</a> indexSet]];
<a name="l00748"></a>00748         _selectedColumnIndexes = [<a class="code" href="class_c_p_index_set.html">CPIndexSet</a> indexSet];
<a name="l00749"></a>00749         [_headerView setNeedsDisplay:YES];
<a name="l00750"></a>00750     }
<a name="l00751"></a>00751 
<a name="l00752"></a>00752     var previousSelectedIndexes = [_selectedRowIndexes copy];
<a name="l00753"></a>00753 
<a name="l00754"></a>00754     <span class="keywordflow">if</span> (shouldExtendSelection)
<a name="l00755"></a>00755         [_selectedRowIndexes addIndexes:rows];
<a name="l00756"></a>00756     <span class="keywordflow">else</span>
<a name="l00757"></a>00757         _selectedRowIndexes = [rows copy];
<a name="l00758"></a>00758 
<a name="l00759"></a>00759     [<span class="keyword">self</span> _updateHighlightWithOldRows:previousSelectedIndexes newRows:_selectedRowIndexes];
<a name="l00760"></a>00760     [_tableDrawView display]; <span class="comment">// FIXME: should be setNeedsDisplayInRect:enclosing rect of new (de)selected rows</span>
<a name="l00761"></a>00761                               <span class="comment">// but currently -drawRect: is not implemented here</span>
<a name="l00762"></a>00762     [<span class="keyword">self</span> _noteSelectionDidChange];
<a name="l00763"></a>00763 }
<a name="l00764"></a>00764 
<a name="l00765"></a>00765 - (void)_updateHighlightWithOldRows:(<a class="code" href="class_c_p_index_set.html">CPIndexSet</a>)oldRows newRows:(<a class="code" href="class_c_p_index_set.html">CPIndexSet</a>)newRows
<a name="l00766"></a>00766 {
<a name="l00767"></a>00767     var firstExposedRow = [_exposedRows firstIndex],
<a name="l00768"></a>00768         exposedLength = [_exposedRows lastIndex] - firstExposedRow + 1,
<a name="l00769"></a>00769         deselectRows = [],
<a name="l00770"></a>00770         selectRows = [],
<a name="l00771"></a>00771         deselectRowIndexes = [oldRows copy],
<a name="l00772"></a>00772         selectRowIndexes = [newRows copy];
<a name="l00773"></a>00773 
<a name="l00774"></a>00774     [deselectRowIndexes removeMatches:selectRowIndexes];
<a name="l00775"></a>00775     [deselectRowIndexes getIndexes:deselectRows maxCount:-1 inIndexRange:CPMakeRange(firstExposedRow, exposedLength)];
<a name="l00776"></a>00776     [selectRowIndexes getIndexes:selectRows maxCount:-1 inIndexRange:CPMakeRange(firstExposedRow, exposedLength)];
<a name="l00777"></a>00777 
<a name="l00778"></a>00778     <span class="keywordflow">for</span> (var identifier in _dataViewsForTableColumns)
<a name="l00779"></a>00779     {
<a name="l00780"></a>00780         var dataViewsInTableColumn = _dataViewsForTableColumns[identifier];
<a name="l00781"></a>00781 
<a name="l00782"></a>00782         var count = deselectRows.length;
<a name="l00783"></a>00783         <span class="keywordflow">while</span> (count--)
<a name="l00784"></a>00784         {
<a name="l00785"></a>00785             var rowIndex = deselectRows[count];
<a name="l00786"></a>00786             var view = dataViewsInTableColumn[rowIndex];
<a name="l00787"></a>00787             [view unsetThemeState:CPThemeStateHighlighted];
<a name="l00788"></a>00788         }
<a name="l00789"></a>00789 
<a name="l00790"></a>00790         count = selectRows.length;
<a name="l00791"></a>00791         <span class="keywordflow">while</span> (count--)
<a name="l00792"></a>00792         {
<a name="l00793"></a>00793             var rowIndex = selectRows[count];
<a name="l00794"></a>00794             var view = dataViewsInTableColumn[rowIndex];
<a name="l00795"></a>00795             [view setThemeState:CPThemeStateHighlighted];
<a name="l00796"></a>00796         }
<a name="l00797"></a>00797     }
<a name="l00798"></a>00798 }
<a name="l00799"></a>00799 
<a name="l00800"></a>00800 - (void)_updateHighlightWithOldColumns:(<a class="code" href="class_c_p_index_set.html">CPIndexSet</a>)oldColumns newColumns:(<a class="code" href="class_c_p_index_set.html">CPIndexSet</a>)newColumns
<a name="l00801"></a>00801 {
<a name="l00802"></a>00802     var firstExposedColumn = [_exposedColumns firstIndex],
<a name="l00803"></a>00803         exposedLength = [_exposedColumns lastIndex] - firstExposedColumn  +1,
<a name="l00804"></a>00804         deselectColumns  = [],
<a name="l00805"></a>00805         selectColumns  = [],
<a name="l00806"></a>00806         deselectColumnIndexes = [oldColumns copy],
<a name="l00807"></a>00807         selectColumnIndexes = [newColumns copy];
<a name="l00808"></a>00808 
<a name="l00809"></a>00809 
<a name="l00810"></a>00810     [deselectColumnIndexes removeMatches:selectColumnIndexes];
<a name="l00811"></a>00811     [deselectColumnIndexes getIndexes:deselectColumns maxCount:-1 inIndexRange:CPMakeRange(firstExposedColumn, exposedLength)];
<a name="l00812"></a>00812     [selectColumnIndexes getIndexes:selectColumns maxCount:-1 inIndexRange:CPMakeRange(firstExposedColumn, exposedLength)];
<a name="l00813"></a>00813 
<a name="l00814"></a>00814     var count = deselectColumns.length;
<a name="l00815"></a>00815     <span class="keywordflow">while</span> (count--)
<a name="l00816"></a>00816     {
<a name="l00817"></a>00817         var columnIndex = deselectColumns[count],
<a name="l00818"></a>00818             identifier = [_tableColumns[columnIndex] UID],
<a name="l00819"></a>00819             dataViewsInTableColumn = _dataViewsForTableColumns[identifier];
<a name="l00820"></a>00820 
<a name="l00821"></a>00821         [dataViewsInTableColumn makeObjectsPerformSelector:@selector(unsetThemeState:) withObject:CPThemeStateHighlighted];
<a name="l00822"></a>00822         var headerView = [_tableColumns[columnIndex] headerView];
<a name="l00823"></a>00823         [headerView unsetThemeState:CPThemeStateSelected];
<a name="l00824"></a>00824     }
<a name="l00825"></a>00825 
<a name="l00826"></a>00826     count = selectColumns.length;
<a name="l00827"></a>00827     <span class="keywordflow">while</span> (count--)
<a name="l00828"></a>00828     {
<a name="l00829"></a>00829         var columnIndex = selectColumns[count],
<a name="l00830"></a>00830             identifier = [_tableColumns[columnIndex] UID],
<a name="l00831"></a>00831             dataViewsInTableColumn = _dataViewsForTableColumns[identifier];
<a name="l00832"></a>00832 
<a name="l00833"></a>00833         [dataViewsInTableColumn makeObjectsPerformSelector:@selector(setThemeState:) withObject:CPThemeStateHighlighted];
<a name="l00834"></a>00834         var headerView = [_tableColumns[columnIndex] headerView];
<a name="l00835"></a>00835         [headerView setThemeState:CPThemeStateSelected];
<a name="l00836"></a>00836     }
<a name="l00837"></a>00837 }
<a name="l00838"></a>00838 
<a name="l00839"></a><a class="code" href="class_c_p_table_view.html#a26beabf6bfecebb33c7b0128a169cd9e">00839</a> - (<a class="code" href="class_c_p_index_set.html">CPIndexSet</a>)selectedColumnIndexes
<a name="l00840"></a>00840 {
<a name="l00841"></a>00841     <span class="keywordflow">return</span> _selectedColumnIndexes;
<a name="l00842"></a>00842 }
<a name="l00843"></a>00843 
<a name="l00844"></a><a class="code" href="class_c_p_table_view.html#a2bb55a58f2ae8d7636b0553982f3c9a7">00844</a> - (<a class="code" href="class_c_p_index_set.html">CPIndexSet</a>)selectedRowIndexes
<a name="l00845"></a>00845 {
<a name="l00846"></a>00846     <span class="keywordflow">return</span> _selectedRowIndexes;
<a name="l00847"></a>00847 }
<a name="l00848"></a>00848 
<a name="l00849"></a><a class="code" href="class_c_p_table_view.html#abf694b71bb60a22e4b09b9efa4e86e05">00849</a> - (void)deselectColumn:(CPInteger)aColumn
<a name="l00850"></a>00850 {
<a name="l00851"></a>00851     var selectedColumnIndexes = [_selectedColumnIndexes copy];
<a name="l00852"></a>00852     [selectedColumnIndexes removeIndex:aColumn];
<a name="l00853"></a>00853     [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#aea838609fe453ae9ed670d98c3c4ff04">selectColumnIndexes</a>:selectedColumnIndexes <a class="code" href="class_c_p_table_view.html#aea838609fe453ae9ed670d98c3c4ff04">byExtendingSelection</a>:NO];
<a name="l00854"></a>00854     [<span class="keyword">self</span> _noteSelectionDidChange];
<a name="l00855"></a>00855 }
<a name="l00856"></a>00856 
<a name="l00857"></a><a class="code" href="class_c_p_table_view.html#aa03aa6f24b45e335d09e2aea7d4a44c2">00857</a> - (void)deselectRow:(CPInteger)aRow
<a name="l00858"></a>00858 {
<a name="l00859"></a>00859     var selectedRowIndexes = [_selectedRowIndexes copy];
<a name="l00860"></a>00860     [<a class="code" href="class_c_p_table_view.html#a2bb55a58f2ae8d7636b0553982f3c9a7">selectedRowIndexes</a> removeIndex:aRow];
<a name="l00861"></a>00861     [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#aea838609fe453ae9ed670d98c3c4ff04">selectColumnIndexes</a>:selectedRowIndexes <a class="code" href="class_c_p_table_view.html#aea838609fe453ae9ed670d98c3c4ff04">byExtendingSelection</a>:NO];
<a name="l00862"></a>00862     [<span class="keyword">self</span> _noteSelectionDidChange];
<a name="l00863"></a>00863 }
<a name="l00864"></a>00864 
<a name="l00865"></a><a class="code" href="class_c_p_table_view.html#a246c8b3a4b46973fa63e56ade90f3363">00865</a> - (CPInteger)numberOfSelectedColumns
<a name="l00866"></a>00866 {
<a name="l00867"></a>00867     <span class="keywordflow">return</span> [_selectedColumnIndexes count];
<a name="l00868"></a>00868 }
<a name="l00869"></a>00869 
<a name="l00870"></a><a class="code" href="class_c_p_table_view.html#ab087d7a16c2f5430eecc4d173280e40c">00870</a> - (CPInteger)numberOfSelectedRows
<a name="l00871"></a>00871 {
<a name="l00872"></a>00872     <span class="keywordflow">return</span> [_selectedRowIndexes count];
<a name="l00873"></a>00873 }
<a name="l00874"></a>00874 
<a name="l00875"></a>00875 <span class="comment">/*</span>
<a name="l00876"></a>00876 <span class="comment">- (CPInteger)selectedColumn</span>
<a name="l00877"></a>00877 <span class="comment">    * - selectedRow</span>
<a name="l00878"></a>00878 <span class="comment">*/</span>
<a name="l00879"></a>00879 
<a name="l00880"></a><a class="code" href="class_c_p_table_view.html#a70e4facaf16993ce4f3b26d015768277">00880</a> - (BOOL)isColumnSelected:(CPInteger)aColumn
<a name="l00881"></a>00881 {
<a name="l00882"></a>00882     <span class="keywordflow">return</span> [_selectedColumnIndexes containsIndex:aColumn];
<a name="l00883"></a>00883 }
<a name="l00884"></a>00884 
<a name="l00885"></a><a class="code" href="class_c_p_table_view.html#a39fa58bb83f641a87f792ac788bc4c0c">00885</a> - (BOOL)isRowSelected:(CPInteger)aRow
<a name="l00886"></a>00886 {
<a name="l00887"></a>00887     <span class="keywordflow">return</span> [_selectedRowIndexes containsIndex:aRow];
<a name="l00888"></a>00888 }
<a name="l00889"></a>00889 <span class="comment">/*</span>
<a name="l00890"></a>00890 <span class="comment">- (void)selectAll:</span>
<a name="l00891"></a>00891 <span class="comment">    * - deselectAll:</span>
<a name="l00892"></a>00892 <span class="comment">    * - allowsTypeSelect</span>
<a name="l00893"></a>00893 <span class="comment">    * - setAllowsTypeSelect:</span>
<a name="l00894"></a>00894 <span class="comment">*/</span>
<a name="l00895"></a>00895 
<a name="l00899"></a><a class="code" href="class_c_p_table_view.html#a000c8dd3192600081340358c7f04c104">00899</a> - (void)deselectAll
<a name="l00900"></a>00900 {
<a name="l00901"></a>00901     [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#a9b6204a962c90a046897dce505fec408">selectRowIndexes</a>:[<a class="code" href="class_c_p_index_set.html">CPIndexSet</a> indexSet] <a class="code" href="class_c_p_table_view.html#a9b6204a962c90a046897dce505fec408">byExtendingSelection</a>:NO];
<a name="l00902"></a>00902     [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#aea838609fe453ae9ed670d98c3c4ff04">selectColumnIndexes</a>:[<a class="code" href="class_c_p_index_set.html">CPIndexSet</a> indexSet] <a class="code" href="class_c_p_table_view.html#aea838609fe453ae9ed670d98c3c4ff04">byExtendingSelection</a>:NO];
<a name="l00903"></a>00903 }
<a name="l00904"></a>00904 
<a name="l00905"></a>00905 <span class="comment">//Table Dimensions</span>
<a name="l00906"></a>00906 
<a name="l00907"></a><a class="code" href="class_c_p_table_view.html#ae601240f59853d00860181c80d763a03">00907</a> - (int)numberOfColumns
<a name="l00908"></a>00908 {
<a name="l00909"></a>00909     <span class="keywordflow">return</span> <a class="code" href="_c_p_table_view_8j.html#aa0c3e20940452d04b6708ec8b82b482b">NUMBER_OF_COLUMNS</a>();
<a name="l00910"></a>00910 }
<a name="l00911"></a>00911 
<a name="l00912"></a>00912 <span class="comment">/*</span>
<a name="l00913"></a>00913 <span class="comment">    Returns the number of rows in the receiver.</span>
<a name="l00914"></a>00914 <span class="comment">*/</span>
<a name="l00915"></a><a class="code" href="class_c_p_table_view.html#ab93d1883609b8aaca737188ee9667c17">00915</a> - (int)numberOfRows
<a name="l00916"></a>00916 {
<a name="l00917"></a>00917     <span class="keywordflow">if</span> (!_dataSource)
<a name="l00918"></a>00918         <span class="keywordflow">return</span> 0;
<a name="l00919"></a>00919 
<a name="l00920"></a>00920     <span class="keywordflow">return</span> [_dataSource numberOfRowsInTableView:self];
<a name="l00921"></a>00921 }
<a name="l00922"></a>00922 
<a name="l00923"></a>00923 <span class="comment">//Displaying Cell</span>
<a name="l00924"></a>00924 <span class="comment">/*</span>
<a name="l00925"></a>00925 <span class="comment">    * - preparedCellAtColumn:row:</span>
<a name="l00926"></a>00926 <span class="comment">*/</span>
<a name="l00927"></a>00927 <span class="comment">//Editing Cells</span>
<a name="l00928"></a>00928 <span class="comment">/*</span>
<a name="l00929"></a>00929 <span class="comment">    * - editColumn:row:withEvent:select:</span>
<a name="l00930"></a>00930 <span class="comment">    * - editedColumn</span>
<a name="l00931"></a>00931 <span class="comment">    * - editedRow</span>
<a name="l00932"></a>00932 <span class="comment">*/</span>
<a name="l00933"></a>00933 <span class="comment">//Setting Auxiliary Views</span>
<a name="l00934"></a>00934 <span class="comment">/*</span>
<a name="l00935"></a>00935 <span class="comment">    * - setHeaderView:</span>
<a name="l00936"></a>00936 <span class="comment">    * - headerView</span>
<a name="l00937"></a>00937 <span class="comment">    * - setCornerView:</span>
<a name="l00938"></a>00938 <span class="comment">    * - cornerView</span>
<a name="l00939"></a>00939 <span class="comment">*/</span>
<a name="l00940"></a>00940 
<a name="l00941"></a><a class="code" href="class_c_p_table_view.html#ac06f185ca68d4bbe813ebcf4f0da66c6">00941</a> - (<a class="code" href="class_c_p_view.html">CPView</a>)cornerView
<a name="l00942"></a>00942 {
<a name="l00943"></a>00943     <span class="keywordflow">return</span> _cornerView;
<a name="l00944"></a>00944 }
<a name="l00945"></a>00945 
<a name="l00946"></a><a class="code" href="class_c_p_table_view.html#ad6c2cf202a6c05de91e2e56fe7368811">00946</a> - (void)setCornerView:(<a class="code" href="class_c_p_view.html">CPView</a>)aView
<a name="l00947"></a>00947 {
<a name="l00948"></a>00948     <span class="keywordflow">if</span> (_cornerView === aView)
<a name="l00949"></a>00949         <span class="keywordflow">return</span>;
<a name="l00950"></a>00950 
<a name="l00951"></a>00951     _cornerView = aView;
<a name="l00952"></a>00952 
<a name="l00953"></a>00953     var scrollView = [[<span class="keyword">self</span> superview] superview];
<a name="l00954"></a>00954 
<a name="l00955"></a>00955     <span class="keywordflow">if</span> ([scrollView isKindOfClass:[<a class="code" href="class_c_p_scroll_view.html">CPScrollView</a> <span class="keyword">class</span>]] &amp;&amp; [scrollView documentView] === <span class="keyword">self</span>)
<a name="l00956"></a>00956         [scrollView _updateCornerAndHeaderView];
<a name="l00957"></a>00957 }
<a name="l00958"></a>00958 
<a name="l00959"></a><a class="code" href="class_c_p_table_view.html#a1200e854924976eed1efa14719a8eba6">00959</a> - (<a class="code" href="class_c_p_view.html">CPView</a>)headerView
<a name="l00960"></a>00960 {
<a name="l00961"></a>00961     <span class="keywordflow">return</span> _headerView;
<a name="l00962"></a>00962 }
<a name="l00963"></a>00963 
<a name="l00964"></a><a class="code" href="class_c_p_table_view.html#ade4b1dc944f33bcdbb33699aaa2c52f3">00964</a> - (void)setHeaderView:(<a class="code" href="class_c_p_view.html">CPView</a>)aHeaderView
<a name="l00965"></a>00965 {
<a name="l00966"></a>00966     <span class="keywordflow">if</span> (_headerView === aHeaderView)
<a name="l00967"></a>00967         <span class="keywordflow">return</span>;
<a name="l00968"></a>00968 
<a name="l00969"></a>00969     [_headerView setTableView:nil];
<a name="l00970"></a>00970 
<a name="l00971"></a>00971     _headerView = aHeaderView;
<a name="l00972"></a>00972 
<a name="l00973"></a>00973     <span class="keywordflow">if</span> (_headerView)
<a name="l00974"></a>00974     {
<a name="l00975"></a>00975         [_headerView setTableView:self];
<a name="l00976"></a>00976         [_headerView setFrameSize:_CGSizeMake(_CGRectGetWidth([<span class="keyword">self</span> frame]), _CGRectGetHeight([_headerView frame]))];
<a name="l00977"></a>00977     }
<a name="l00978"></a>00978 
<a name="l00979"></a>00979     var scrollView = [[<span class="keyword">self</span> superview] superview];
<a name="l00980"></a>00980 
<a name="l00981"></a>00981     <span class="keywordflow">if</span> ([scrollView isKindOfClass:[<a class="code" href="class_c_p_scroll_view.html">CPScrollView</a> <span class="keyword">class</span>]] &amp;&amp; [scrollView documentView] === <span class="keyword">self</span>)
<a name="l00982"></a>00982         [scrollView _updateCornerAndHeaderView];
<a name="l00983"></a>00983 }
<a name="l00984"></a>00984 
<a name="l00985"></a>00985 <span class="comment">//Layout Support</span>
<a name="l00986"></a>00986 
<a name="l00987"></a>00987 <span class="comment">// Complexity:</span>
<a name="l00988"></a>00988 <span class="comment">// O(Columns)</span>
<a name="l00989"></a>00989 - (void)_recalculateTableColumnRanges
<a name="l00990"></a>00990 {
<a name="l00991"></a>00991     <span class="keywordflow">if</span> (_dirtyTableColumnRangeIndex &lt; 0)
<a name="l00992"></a>00992         <span class="keywordflow">return</span>;
<a name="l00993"></a>00993 
<a name="l00994"></a>00994     var index = _dirtyTableColumnRangeIndex,
<a name="l00995"></a>00995         count = <a class="code" href="_c_p_table_view_8j.html#aa0c3e20940452d04b6708ec8b82b482b">NUMBER_OF_COLUMNS</a>(),
<a name="l00996"></a>00996         x = index === 0 ? 0.0 : CPMaxRange(_tableColumnRanges[index - 1]);
<a name="l00997"></a>00997 
<a name="l00998"></a>00998     <span class="keywordflow">for</span> (; index &lt; count; ++index)
<a name="l00999"></a>00999     {
<a name="l01000"></a>01000         var tableColumn = _tableColumns[index];
<a name="l01001"></a>01001 
<a name="l01002"></a>01002         <span class="keywordflow">if</span> ([tableColumn isHidden])
<a name="l01003"></a>01003             _tableColumnRanges[index] = CPMakeRange(x, 0.0);
<a name="l01004"></a>01004 
<a name="l01005"></a>01005         <span class="keywordflow">else</span>
<a name="l01006"></a>01006         {
<a name="l01007"></a>01007             var <a class="code" href="_c_p_segmented_control_8j.html#a2474a5474cbff19523a51eb1de01cda4">width</a> = [_tableColumns[index] width];
<a name="l01008"></a>01008 
<a name="l01009"></a>01009             _tableColumnRanges[index] = CPMakeRange(x, width);
<a name="l01010"></a>01010 
<a name="l01011"></a>01011             x += width;
<a name="l01012"></a>01012         }
<a name="l01013"></a>01013     }
<a name="l01014"></a>01014 
<a name="l01015"></a>01015     _tableColumnRanges.length = count;
<a name="l01016"></a>01016     _dirtyTableColumnRangeIndex = CPNotFound;
<a name="l01017"></a>01017 }
<a name="l01018"></a>01018 
<a name="l01019"></a>01019 <span class="comment">// Complexity:</span>
<a name="l01020"></a>01020 <span class="comment">// O(1)</span>
<a name="l01021"></a><a class="code" href="class_c_p_table_view.html#af86aacec5d36506c1fee17f1fab5803f">01021</a> - (CGRect)rectOfColumn:(CPInteger)aColumnIndex
<a name="l01022"></a>01022 {
<a name="l01023"></a>01023     aColumnIndex = +aColumnIndex;
<a name="l01024"></a>01024 
<a name="l01025"></a>01025     <span class="keywordflow">if</span> (aColumnIndex &lt; 0 || aColumnIndex &gt;= <a class="code" href="_c_p_table_view_8j.html#aa0c3e20940452d04b6708ec8b82b482b">NUMBER_OF_COLUMNS</a>())
<a name="l01026"></a>01026         <span class="keywordflow">return</span> _CGRectMakeZero();
<a name="l01027"></a>01027 
<a name="l01028"></a>01028     <a class="code" href="_c_p_table_view_8j.html#a8d863ee1b9f1e447c7ee408af11b8f22">UPDATE_COLUMN_RANGES_IF_NECESSARY</a>();
<a name="l01029"></a>01029 
<a name="l01030"></a>01030     var range = _tableColumnRanges[aColumnIndex];
<a name="l01031"></a>01031 
<a name="l01032"></a>01032     <span class="keywordflow">return</span> _CGRectMake(range.location, 0.0, range.length, <a class="code" href="_c_g_geometry_8j.html#a09d2072d60c7f39b04a41705d640fa98">CGRectGetHeight</a>([<span class="keyword">self</span> bounds]));
<a name="l01033"></a>01033 }
<a name="l01034"></a>01034 
<a name="l01035"></a><a class="code" href="class_c_p_table_view.html#abdf1f5cc725acaf6d5734cc535bc8a22">01035</a> - (CGRect)rectOfRow:(CPInteger)aRowIndex
<a name="l01036"></a>01036 {
<a name="l01037"></a>01037     <span class="keywordflow">if</span> (NO)
<a name="l01038"></a>01038         <span class="keywordflow">return</span> NULL;
<a name="l01039"></a>01039 
<a name="l01040"></a>01040     <span class="comment">// FIXME: WRONG: ASK TABLE COLUMN RANGE</span>
<a name="l01041"></a>01041     <span class="keywordflow">return</span> _CGRectMake(0.0, (aRowIndex * (_rowHeight + _intercellSpacing.height)), _CGRectGetWidth([<span class="keyword">self</span> bounds]), _rowHeight);
<a name="l01042"></a>01042 }
<a name="l01043"></a>01043 
<a name="l01044"></a>01044 <span class="comment">// Complexity:</span>
<a name="l01045"></a>01045 <span class="comment">// O(1)</span>
<a name="l01051"></a><a class="code" href="class_c_p_table_view.html#a7d9128a2f32c6714364d5217894daa44">01051</a> <span class="comment"></span>- (CPRange)rowsInRect:(CGRect)aRect
<a name="l01052"></a>01052 {
<a name="l01053"></a>01053     <span class="comment">// If we have no rows, then we won&#39;t intersect anything.</span>
<a name="l01054"></a>01054     <span class="keywordflow">if</span> (_numberOfRows &lt;= 0)
<a name="l01055"></a>01055         <span class="keywordflow">return</span> CPMakeRange(0, 0);
<a name="l01056"></a>01056 
<a name="l01057"></a>01057     var bounds = [<span class="keyword">self</span> bounds];
<a name="l01058"></a>01058 
<a name="l01059"></a>01059     <span class="comment">// No rows if the rect doesn&#39;t even intersect us.</span>
<a name="l01060"></a>01060     <span class="keywordflow">if</span> (!<a class="code" href="group__appkit.html#ga77d150d6cf60ff142fa46dc079e8203a">CGRectIntersectsRect</a>(aRect, bounds))
<a name="l01061"></a>01061         <span class="keywordflow">return</span> CPMakeRange(0, 0);
<a name="l01062"></a>01062 
<a name="l01063"></a>01063     var firstRow = [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#a6f1d4aad7598b4ca189e2a262d51cd08">rowAtPoint</a>:aRect.origin];
<a name="l01064"></a>01064 
<a name="l01065"></a>01065     <span class="comment">// first row has to be undershot, because if not we wouldn&#39;t be intersecting.</span>
<a name="l01066"></a>01066     <span class="keywordflow">if</span> (firstRow &lt; 0)
<a name="l01067"></a>01067         firstRow = 0;
<a name="l01068"></a>01068 
<a name="l01069"></a>01069     var lastRow = [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#a6f1d4aad7598b4ca189e2a262d51cd08">rowAtPoint</a>:_CGPointMake(0.0, _CGRectGetMaxY(aRect))];
<a name="l01070"></a>01070 
<a name="l01071"></a>01071     <span class="comment">// last row has to be overshot, because if not we wouldn&#39;t be intersecting.</span>
<a name="l01072"></a>01072     <span class="keywordflow">if</span> (lastRow &lt; 0)
<a name="l01073"></a>01073         lastRow = _numberOfRows - 1;
<a name="l01074"></a>01074 
<a name="l01075"></a>01075     <span class="keywordflow">return</span> CPMakeRange(firstRow, lastRow - firstRow + 1);
<a name="l01076"></a>01076 }
<a name="l01077"></a>01077 
<a name="l01078"></a>01078 <span class="comment">// Complexity:</span>
<a name="l01079"></a>01079 <span class="comment">// O(lg Columns) if table view contains no hidden columns</span>
<a name="l01080"></a>01080 <span class="comment">// O(Columns) if table view contains hidden columns</span>
<a name="l01081"></a>01081 
<a name="l01086"></a><a class="code" href="class_c_p_table_view.html#a1acdacf678fb91a541b692d378586289">01086</a> - (<a class="code" href="class_c_p_index_set.html">CPIndexSet</a>)columnIndexesInRect:(CGRect)aRect
<a name="l01087"></a>01087 {
<a name="l01088"></a>01088     var column = MAX(0, [<span class="keyword">self</span> columnAtPoint:_CGPointMake(aRect.origin.x, 0.0)]),
<a name="l01089"></a>01089         lastColumn = [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#aa5bce119e8c4b79e4ed0f9a10172996d">columnAtPoint</a>:_CGPointMake(_CGRectGetMaxX(aRect), 0.0)];
<a name="l01090"></a>01090 
<a name="l01091"></a>01091     <span class="keywordflow">if</span> (lastColumn === CPNotFound)
<a name="l01092"></a>01092         lastColumn = <a class="code" href="_c_p_table_view_8j.html#aa0c3e20940452d04b6708ec8b82b482b">NUMBER_OF_COLUMNS</a>() - 1;
<a name="l01093"></a>01093 
<a name="l01094"></a>01094     <span class="comment">// Don&#39;t bother doing the expensive removal of hidden indexes if we have no hidden columns.</span>
<a name="l01095"></a>01095     <span class="keywordflow">if</span> (_numberOfHiddenColumns &lt;= 0)
<a name="l01096"></a>01096         <span class="keywordflow">return</span> [<a class="code" href="class_c_p_index_set.html">CPIndexSet</a> indexSetWithIndexesInRange:CPMakeRange(column, lastColumn - column + 1)];
<a name="l01097"></a>01097 
<a name="l01098"></a>01098     <span class="comment">//</span>
<a name="l01099"></a>01099     var indexSet = [<a class="code" href="class_c_p_index_set.html">CPIndexSet</a> indexSet];
<a name="l01100"></a>01100 
<a name="l01101"></a>01101     <span class="keywordflow">for</span> (; column &lt;= lastColumn; ++column)
<a name="l01102"></a>01102     {
<a name="l01103"></a>01103         var tableColumn = _tableColumns[column];
<a name="l01104"></a>01104 
<a name="l01105"></a>01105         <span class="keywordflow">if</span> (![tableColumn isHidden])
<a name="l01106"></a>01106             [indexSet addIndex:column];
<a name="l01107"></a>01107     }
<a name="l01108"></a>01108 
<a name="l01109"></a>01109     <span class="keywordflow">return</span> indexSet;
<a name="l01110"></a>01110 }
<a name="l01111"></a>01111 
<a name="l01112"></a>01112 <span class="comment">// Complexity:</span>
<a name="l01113"></a>01113 <span class="comment">// O(lg Columns) if table view contains now hidden columns</span>
<a name="l01114"></a>01114 <span class="comment">// O(Columns) if table view contains hidden columns</span>
<a name="l01115"></a><a class="code" href="class_c_p_table_view.html#aa5bce119e8c4b79e4ed0f9a10172996d">01115</a> - (CPInteger)columnAtPoint:(CGPoint)aPoint
<a name="l01116"></a>01116 {
<a name="l01117"></a>01117     var bounds = [<span class="keyword">self</span> bounds];
<a name="l01118"></a>01118 
<a name="l01119"></a>01119     <span class="keywordflow">if</span> (!_CGRectContainsPoint(bounds, aPoint))
<a name="l01120"></a>01120         <span class="keywordflow">return</span> CPNotFound;
<a name="l01121"></a>01121 
<a name="l01122"></a>01122     <a class="code" href="_c_p_table_view_8j.html#a8d863ee1b9f1e447c7ee408af11b8f22">UPDATE_COLUMN_RANGES_IF_NECESSARY</a>();
<a name="l01123"></a>01123 
<a name="l01124"></a>01124     var x = aPoint.x,
<a name="l01125"></a>01125         low = 0,
<a name="l01126"></a>01126         high = _tableColumnRanges.length - 1;
<a name="l01127"></a>01127 
<a name="l01128"></a>01128     <span class="keywordflow">while</span> (low &lt;= high)
<a name="l01129"></a>01129     {
<a name="l01130"></a>01130         var middle = FLOOR(low + (high - low) / 2),
<a name="l01131"></a>01131             range = _tableColumnRanges[middle];
<a name="l01132"></a>01132 
<a name="l01133"></a>01133         <span class="keywordflow">if</span> (x &lt; range.location)
<a name="l01134"></a>01134             high = middle - 1;
<a name="l01135"></a>01135 
<a name="l01136"></a>01136         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (x &gt;= CPMaxRange(range))
<a name="l01137"></a>01137             low = middle + 1;
<a name="l01138"></a>01138 
<a name="l01139"></a>01139         <span class="keywordflow">else</span>
<a name="l01140"></a>01140         {
<a name="l01141"></a>01141             var numberOfColumns = _tableColumnRanges.length;
<a name="l01142"></a>01142 
<a name="l01143"></a>01143             <span class="keywordflow">while</span> (middle &lt; numberOfColumns &amp;&amp; [_tableColumns[middle] isHidden])
<a name="l01144"></a>01144                 ++middle;
<a name="l01145"></a>01145 
<a name="l01146"></a>01146             <span class="keywordflow">if</span> (middle &lt; numberOfColumns)
<a name="l01147"></a>01147                 <span class="keywordflow">return</span> middle;
<a name="l01148"></a>01148 
<a name="l01149"></a>01149             <span class="keywordflow">return</span> CPNotFound;
<a name="l01150"></a>01150         }
<a name="l01151"></a>01151    }
<a name="l01152"></a>01152 
<a name="l01153"></a>01153    <span class="keywordflow">return</span> CPNotFound;
<a name="l01154"></a>01154 }
<a name="l01155"></a>01155 
<a name="l01156"></a><a class="code" href="class_c_p_table_view.html#a6f1d4aad7598b4ca189e2a262d51cd08">01156</a> - (CPInteger)rowAtPoint:(CGPoint)aPoint
<a name="l01157"></a>01157 {
<a name="l01158"></a>01158     var y = aPoint.y;
<a name="l01159"></a>01159 
<a name="l01160"></a>01160     var row = FLOOR(y / (_rowHeight + _intercellSpacing.height));
<a name="l01161"></a>01161 
<a name="l01162"></a>01162     <span class="keywordflow">if</span> (row &gt;= _numberOfRows)
<a name="l01163"></a>01163         <span class="keywordflow">return</span> -1;
<a name="l01164"></a>01164 
<a name="l01165"></a>01165     <span class="keywordflow">return</span> row;
<a name="l01166"></a>01166 }
<a name="l01167"></a>01167 
<a name="l01168"></a><a class="code" href="class_c_p_table_view.html#afa878164caef6b4c75e2ef5328cc3612">01168</a> - (CGRect)frameOfDataViewAtColumn:(CPInteger)aColumn row:(CPInteger)aRow
<a name="l01169"></a>01169 {
<a name="l01170"></a>01170     <a class="code" href="_c_p_table_view_8j.html#a8d863ee1b9f1e447c7ee408af11b8f22">UPDATE_COLUMN_RANGES_IF_NECESSARY</a>();
<a name="l01171"></a>01171 
<a name="l01172"></a>01172     var tableColumnRange = _tableColumnRanges[aColumn],
<a name="l01173"></a>01173         rectOfRow = [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#abdf1f5cc725acaf6d5734cc535bc8a22">rectOfRow</a>:aRow];
<a name="l01174"></a>01174 
<a name="l01175"></a>01175     <span class="keywordflow">return</span> _CGRectMake(tableColumnRange.location, _CGRectGetMinY(rectOfRow), tableColumnRange.length, _CGRectGetHeight(rectOfRow));
<a name="l01176"></a>01176 }
<a name="l01177"></a>01177 
<a name="l01178"></a>01178 <span class="comment">//FIX ME: We should refactor this!</span>
<a name="l01179"></a><a class="code" href="class_c_p_table_view.html#a644c13b12bccbd4ff2995058bf0f5b36">01179</a> - (void)resizeWithOldSuperviewSize:(CGSize)aSize
<a name="l01180"></a>01180 {
<a name="l01181"></a>01181     [<span class="keyword">super</span> resizeWithOldSuperviewSize:aSize];
<a name="l01182"></a>01182 
<a name="l01183"></a>01183     var mask = _columnAutoResizingStyle;
<a name="l01184"></a>01184 
<a name="l01185"></a>01185     <span class="keywordflow">if</span>(mask === <a class="code" href="_c_p_table_view_8j.html#a8f4ff5bd6c8f021a249d46098015f486">CPTableViewUniformColumnAutoresizingStyle</a>)
<a name="l01186"></a>01186     {
<a name="l01187"></a>01187         <span class="comment">// FIX ME: needs to respect proportion of the the columns set width...</span>
<a name="l01188"></a>01188         <span class="comment">// this can also get slow when there are many rows</span>
<a name="l01189"></a>01189         <span class="comment">// do this by getting the width of the new size and subtracting it from the width of the old size dividing the difference by the number of visible rows.</span>
<a name="l01190"></a>01190         <span class="comment">// loop trough the rows one by one adding the quotient to each row be sure to check for min/max widths when doing it.</span>
<a name="l01191"></a>01191 
<a name="l01192"></a>01192         var superview = [<span class="keyword">self</span> superview];
<a name="l01193"></a>01193 
<a name="l01194"></a>01194         <span class="keywordflow">if</span> (!superview)
<a name="l01195"></a>01195             <span class="keywordflow">return</span>;
<a name="l01196"></a>01196 
<a name="l01197"></a>01197         var superviewSize = [superview bounds].size;
<a name="l01198"></a>01198 
<a name="l01199"></a>01199         <a class="code" href="_c_p_table_view_8j.html#a8d863ee1b9f1e447c7ee408af11b8f22">UPDATE_COLUMN_RANGES_IF_NECESSARY</a>();
<a name="l01200"></a>01200 
<a name="l01201"></a>01201         var count = <a class="code" href="_c_p_table_view_8j.html#aa0c3e20940452d04b6708ec8b82b482b">NUMBER_OF_COLUMNS</a>();
<a name="l01202"></a>01202 
<a name="l01203"></a>01203         var visColumns = [[CPArray alloc] init];
<a name="l01204"></a>01204 
<a name="l01205"></a>01205         <span class="keywordflow">for</span>(var i=0; i &lt; count; i++)
<a name="l01206"></a>01206         {
<a name="l01207"></a>01207             <span class="keywordflow">if</span>(![_tableColumns[i] isHidden])
<a name="l01208"></a>01208                 [visColumns addObject:i];
<a name="l01209"></a>01209         }
<a name="l01210"></a>01210 
<a name="l01211"></a>01211         count = [visColumns count];
<a name="l01212"></a>01212 
<a name="l01213"></a>01213         <span class="comment">//if there are rows</span>
<a name="l01214"></a>01214         <span class="keywordflow">if</span> (count &gt; 0)
<a name="l01215"></a>01215         {
<a name="l01216"></a>01216             <span class="comment">//get total width // don&#39;t let it be smaller than 15</span>
<a name="l01217"></a>01217             var newWidth = MAX(15.0, superviewSize.width / count);
<a name="l01218"></a>01218 
<a name="l01219"></a>01219             <span class="comment">//loop through all the rows again</span>
<a name="l01220"></a>01220             <span class="keywordflow">for</span>(var i = 0; i &lt; count; i++)
<a name="l01221"></a>01221             {
<a name="l01222"></a>01222                 var columnToResize = _tableColumns[visColumns[i]];
<a name="l01223"></a>01223                 var newWidth = MAX([columnToResize minWidth], superviewSize.width / count);
<a name="l01224"></a>01224                 newWidth = (newWidth &gt; [columnToResize maxWidth]) ? [columnToResize maxWidth] : newWidth;
<a name="l01225"></a>01225 
<a name="l01226"></a>01226                 [columnToResize setWidth:FLOOR(newWidth)];
<a name="l01227"></a>01227             }
<a name="l01228"></a>01228         }
<a name="l01229"></a>01229 
<a name="l01230"></a>01230         [<span class="keyword">self</span> setNeedsLayout];
<a name="l01231"></a>01231     }
<a name="l01232"></a>01232 
<a name="l01233"></a>01233     <span class="keywordflow">if</span>(mask === <a class="code" href="_c_p_table_view_8j.html#a0f472ac2d7a9f96e5ad5ec35e8d4af3f">CPTableViewLastColumnOnlyAutoresizingStyle</a>)
<a name="l01234"></a>01234     {
<a name="l01235"></a>01235         [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#a0e5f2712415987cf5453e6799ca157ab">sizeLastColumnToFit</a>];
<a name="l01236"></a>01236     }
<a name="l01237"></a>01237 
<a name="l01238"></a>01238     <span class="keywordflow">if</span>(mask === <a class="code" href="_c_p_table_view_8j.html#a2817258659933aa465a18e1798822134">CPTableViewFirstColumnOnlyAutoresizingStyle</a>)
<a name="l01239"></a>01239     {
<a name="l01240"></a>01240         var superview = [<span class="keyword">self</span> superview];
<a name="l01241"></a>01241 
<a name="l01242"></a>01242         <span class="keywordflow">if</span> (!superview)
<a name="l01243"></a>01243             <span class="keywordflow">return</span>;
<a name="l01244"></a>01244 
<a name="l01245"></a>01245         var superviewSize = [superview bounds].size;
<a name="l01246"></a>01246 
<a name="l01247"></a>01247         <a class="code" href="_c_p_table_view_8j.html#a8d863ee1b9f1e447c7ee408af11b8f22">UPDATE_COLUMN_RANGES_IF_NECESSARY</a>();
<a name="l01248"></a>01248 
<a name="l01249"></a>01249         var count = <a class="code" href="_c_p_table_view_8j.html#aa0c3e20940452d04b6708ec8b82b482b">NUMBER_OF_COLUMNS</a>();
<a name="l01250"></a>01250 
<a name="l01251"></a>01251         var visColumns = [[CPArray alloc] init];
<a name="l01252"></a>01252         var totalWidth = 0;
<a name="l01253"></a>01253 
<a name="l01254"></a>01254         <span class="keywordflow">for</span>(var i=0; i &lt; count; i++)
<a name="l01255"></a>01255         {
<a name="l01256"></a>01256             <span class="keywordflow">if</span>(![_tableColumns[i] isHidden])
<a name="l01257"></a>01257             {
<a name="l01258"></a>01258                 [visColumns addObject:i];
<a name="l01259"></a>01259                 totalWidth += [_tableColumns[i] width];
<a name="l01260"></a>01260             }
<a name="l01261"></a>01261         }
<a name="l01262"></a>01262 
<a name="l01263"></a>01263         count = [visColumns count];
<a name="l01264"></a>01264 
<a name="l01265"></a>01265         <span class="comment">//if there are rows</span>
<a name="l01266"></a>01266         <span class="keywordflow">if</span> (count &gt; 0)
<a name="l01267"></a>01267         {
<a name="l01268"></a>01268             var columnToResize = _tableColumns[visColumns[0]];
<a name="l01269"></a>01269             var newWidth = superviewSize.width - totalWidth;<span class="comment">// - [columnToResize width];</span>
<a name="l01270"></a>01270             newWidth += [columnToResize width];
<a name="l01271"></a>01271             newWidth = (newWidth &lt; [columnToResize minWidth]) ? [columnToResize minWidth] : newWidth;
<a name="l01272"></a>01272             newWidth = (newWidth &gt; [columnToResize maxWidth]) ? [columnToResize maxWidth] : newWidth;
<a name="l01273"></a>01273 
<a name="l01274"></a>01274             [columnToResize setWidth:FLOOR(newWidth)];
<a name="l01275"></a>01275         }
<a name="l01276"></a>01276 
<a name="l01277"></a>01277         [<span class="keyword">self</span> setNeedsLayout];
<a name="l01278"></a>01278     }
<a name="l01279"></a>01279 
<a name="l01280"></a>01280 }
<a name="l01281"></a>01281 
<a name="l01286"></a><a class="code" href="class_c_p_table_view.html#af55c0e265866be064bcd80e80a4d78dc">01286</a> - (void)setColumnAutoresizingStyle:(<span class="keywordtype">unsigned</span>)style
<a name="l01287"></a>01287 {
<a name="l01288"></a>01288     <span class="comment">//FIX ME: CPTableViewSequentialColumnAutoresizingStyle and CPTableViewReverseSequentialColumnAutoresizingStyle are not yet implemented</span>
<a name="l01289"></a>01289     _columnAutoResizingStyle = style;
<a name="l01290"></a>01290 }
<a name="l01291"></a>01291 
<a name="l01292"></a><a class="code" href="class_c_p_table_view.html#a64904071265deae401474834ea7c6dda">01292</a> - (unsigned)columnAutoresizingStyle
<a name="l01293"></a>01293 {
<a name="l01294"></a>01294     <span class="keywordflow">return</span> _columnAutoResizingStyle;
<a name="l01295"></a>01295 }
<a name="l01296"></a>01296 
<a name="l01300"></a><a class="code" href="class_c_p_table_view.html#a0e5f2712415987cf5453e6799ca157ab">01300</a> - (void)sizeLastColumnToFit
<a name="l01301"></a>01301 {
<a name="l01302"></a>01302     var superview = [<span class="keyword">self</span> superview];
<a name="l01303"></a>01303 
<a name="l01304"></a>01304     <span class="keywordflow">if</span> (!superview)
<a name="l01305"></a>01305         <span class="keywordflow">return</span>;
<a name="l01306"></a>01306 
<a name="l01307"></a>01307     var superviewSize = [superview bounds].size;
<a name="l01308"></a>01308 
<a name="l01309"></a>01309     <a class="code" href="_c_p_table_view_8j.html#a8d863ee1b9f1e447c7ee408af11b8f22">UPDATE_COLUMN_RANGES_IF_NECESSARY</a>();
<a name="l01310"></a>01310 
<a name="l01311"></a>01311     var count = <a class="code" href="_c_p_table_view_8j.html#aa0c3e20940452d04b6708ec8b82b482b">NUMBER_OF_COLUMNS</a>();
<a name="l01312"></a>01312 
<a name="l01313"></a>01313     <span class="comment">//decrement the counter until we get to the last row that&#39;s not hidden</span>
<a name="l01314"></a>01314     <span class="keywordflow">while</span> (count-- &amp;&amp; [_tableColumns[count] isHidden]) ;
<a name="l01315"></a>01315 
<a name="l01316"></a>01316     <span class="comment">//if the last row exists</span>
<a name="l01317"></a>01317     <span class="keywordflow">if</span> (count &gt;= 0)
<a name="l01318"></a>01318     {
<a name="l01319"></a>01319         var columnToResize = _tableColumns[count];
<a name="l01320"></a>01320         var newSize = MAX(0.0, superviewSize.width - <a class="code" href="_c_g_geometry_8j.html#a7c1a8fe081097d577b441f6b7b553421">CGRectGetMinX</a>([<span class="keyword">self</span> rectOfColumn:count]));
<a name="l01321"></a>01321 
<a name="l01322"></a>01322         <span class="keywordflow">if</span> (newSize &gt; 0)
<a name="l01323"></a>01323         {
<a name="l01324"></a>01324             newSize = (newSize &lt; [columnToResize minWidth]) ? [columnToResize minWidth] : newSize;
<a name="l01325"></a>01325             newSize = (newSize &gt; [columnToResize maxWidth]) ? [columnToResize maxWidth] : newSize;
<a name="l01326"></a>01326             [columnToResize setWidth:newSize];
<a name="l01327"></a>01327         }
<a name="l01328"></a>01328     }
<a name="l01329"></a>01329 
<a name="l01330"></a>01330     [<span class="keyword">self</span> setNeedsLayout];
<a name="l01331"></a>01331 }
<a name="l01332"></a>01332 
<a name="l01333"></a><a class="code" href="class_c_p_table_view.html#aa1b1194b660a264c3c330892e4f4ffe4">01333</a> - (void)noteNumberOfRowsChanged
<a name="l01334"></a>01334 {
<a name="l01335"></a>01335     _numberOfRows = [_dataSource numberOfRowsInTableView:self];
<a name="l01336"></a>01336 
<a name="l01337"></a>01337     [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#af2af4f3cd8a4020f17c25c64548051ea">tile</a>];
<a name="l01338"></a>01338 }
<a name="l01339"></a>01339 
<a name="l01340"></a><a class="code" href="class_c_p_table_view.html#af2af4f3cd8a4020f17c25c64548051ea">01340</a> - (void)tile
<a name="l01341"></a>01341 {
<a name="l01342"></a>01342     <a class="code" href="_c_p_table_view_8j.html#a8d863ee1b9f1e447c7ee408af11b8f22">UPDATE_COLUMN_RANGES_IF_NECESSARY</a>();
<a name="l01343"></a>01343 
<a name="l01344"></a>01344     <span class="comment">// FIXME: variable row heights.</span>
<a name="l01345"></a>01345     var <a class="code" href="_c_p_segmented_control_8j.html#a2474a5474cbff19523a51eb1de01cda4">width</a> = _tableColumnRanges.length &gt; 0 ? CPMaxRange([_tableColumnRanges lastObject]) : 0.0,
<a name="l01346"></a>01346         <a class="code" href="_c_p_screen_8j.html#a4540395d130d8a367becfe06b659b9f1">height</a> = (_rowHeight + _intercellSpacing.height) * _numberOfRows,
<a name="l01347"></a>01347         superview = [<span class="keyword">self</span> superview];
<a name="l01348"></a>01348 
<a name="l01349"></a>01349     <span class="keywordflow">if</span> ([superview isKindOfClass:[<a class="code" href="class_c_p_clip_view.html">CPClipView</a> <span class="keyword">class</span>]])
<a name="l01350"></a>01350     {
<a name="l01351"></a>01351         var superviewSize = [superview bounds].size;
<a name="l01352"></a>01352 
<a name="l01353"></a>01353         <a class="code" href="_c_p_segmented_control_8j.html#a2474a5474cbff19523a51eb1de01cda4">width</a> = MAX(superviewSize.width, <a class="code" href="_c_p_segmented_control_8j.html#a2474a5474cbff19523a51eb1de01cda4">width</a>);
<a name="l01354"></a>01354         <a class="code" href="_c_p_screen_8j.html#a4540395d130d8a367becfe06b659b9f1">height</a> = MAX(superviewSize.height, <a class="code" href="_c_p_screen_8j.html#a4540395d130d8a367becfe06b659b9f1">height</a>);
<a name="l01355"></a>01355     }
<a name="l01356"></a>01356 
<a name="l01357"></a>01357     [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#a2f8731a826f57388dba260fa2ccc64eb">setFrameSize</a>:_CGSizeMake(width, height)];
<a name="l01358"></a>01358 
<a name="l01359"></a>01359     [<span class="keyword">self</span> setNeedsLayout];
<a name="l01360"></a>01360     [<span class="keyword">self</span> setNeedsDisplay:YES];
<a name="l01361"></a>01361 }
<a name="l01362"></a>01362 
<a name="l01363"></a>01363 <span class="comment">/*</span>
<a name="l01364"></a>01364 <span class="comment">    * - tile</span>
<a name="l01365"></a>01365 <span class="comment">    * - sizeToFit</span>
<a name="l01366"></a>01366 <span class="comment">    * - noteHeightOfRowsWithIndexesChanged:</span>
<a name="l01367"></a>01367 <span class="comment">*/</span>
<a name="l01368"></a>01368 <span class="comment">//Scrolling</span>
<a name="l01369"></a>01369 <span class="comment">/*</span>
<a name="l01370"></a>01370 <span class="comment">    * - scrollRowToVisible:</span>
<a name="l01371"></a>01371 <span class="comment">    * - scrollColumnToVisible:</span>
<a name="l01372"></a>01372 <span class="comment">*/</span>
<a name="l01373"></a>01373 
<a name="l01378"></a><a class="code" href="class_c_p_table_view.html#aac2521d3f258b8a58f3357756a5b830f">01378</a> - (void)scrollRowToVisible:(<span class="keywordtype">int</span>)rowIndex
<a name="l01379"></a>01379 {
<a name="l01380"></a>01380     [<span class="keyword">self</span> scrollRectToVisible:[<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#abdf1f5cc725acaf6d5734cc535bc8a22">rectOfRow</a>:rowIndex]];
<a name="l01381"></a>01381 }
<a name="l01382"></a>01382 
<a name="l01387"></a><a class="code" href="class_c_p_table_view.html#a2ffae1b91fadd2aa6055af8b2be802d8">01387</a> - (void)scrollColumnToVisible:(<span class="keywordtype">int</span>)columnIndex
<a name="l01388"></a>01388 {
<a name="l01389"></a>01389     [<span class="keyword">self</span> scrollRectToVisible:[<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#af86aacec5d36506c1fee17f1fab5803f">rectOfColumn</a>:columnIndex]];
<a name="l01390"></a>01390     <span class="comment">/*FIX ME: tableview header isn&#39;t rendered until you click the horizontal scroller (or scroll)*/</span>
<a name="l01391"></a>01391 }
<a name="l01392"></a>01392 
<a name="l01393"></a>01393 <span class="comment">//Persistence</span>
<a name="l01394"></a>01394 <span class="comment">/*</span>
<a name="l01395"></a>01395 <span class="comment">    * - autosaveName</span>
<a name="l01396"></a>01396 <span class="comment">    * - autosaveTableColumns</span>
<a name="l01397"></a>01397 <span class="comment">    * - setAutosaveName:</span>
<a name="l01398"></a>01398 <span class="comment">    * - setAutosaveTableColumns:</span>
<a name="l01399"></a>01399 <span class="comment">*/</span>
<a name="l01400"></a>01400 
<a name="l01401"></a>01401 <span class="comment">//Setting the Delegate:(id)aDelegate</span>
<a name="l01402"></a>01402 
<a name="l01403"></a><a class="code" href="class_c_p_table_view.html#ad35bac24324e17ec66afbafce1a6e597">01403</a> - (void)setDelegate:(<span class="keywordtype">id</span>)aDelegate
<a name="l01404"></a>01404 {
<a name="l01405"></a>01405     <span class="keywordflow">if</span> (_delegate === aDelegate)
<a name="l01406"></a>01406         <span class="keywordflow">return</span>;
<a name="l01407"></a>01407 
<a name="l01408"></a>01408     var defaultCenter = [CPNotificationCenter defaultCenter];
<a name="l01409"></a>01409 
<a name="l01410"></a>01410     <span class="keywordflow">if</span> (_delegate)
<a name="l01411"></a>01411     {
<a name="l01412"></a>01412         <span class="keywordflow">if</span> ([_delegate respondsToSelector:<span class="keyword">@selector</span>(tableViewColumnDidMove:)])
<a name="l01413"></a>01413             [defaultCenter
<a name="l01414"></a>01414                 removeObserver:_delegate
<a name="l01415"></a>01415                           name:CPTableViewColumnDidMoveNotification
<a name="l01416"></a>01416                         object:self];
<a name="l01417"></a>01417 
<a name="l01418"></a>01418         <span class="keywordflow">if</span> ([_delegate respondsToSelector:<span class="keyword">@selector</span>(tableViewColumnDidResize:)])
<a name="l01419"></a>01419             [defaultCenter
<a name="l01420"></a>01420                 removeObserver:_delegate
<a name="l01421"></a>01421                           name:CPTableViewColumnDidResizeNotification
<a name="l01422"></a>01422                         object:self];
<a name="l01423"></a>01423 
<a name="l01424"></a>01424         <span class="keywordflow">if</span> ([_delegate respondsToSelector:<span class="keyword">@selector</span>(tableViewSelectionDidChange:)])
<a name="l01425"></a>01425             [defaultCenter
<a name="l01426"></a>01426                 removeObserver:_delegate
<a name="l01427"></a>01427                           name:CPTableViewSelectionDidChangeNotification
<a name="l01428"></a>01428                         object:self];
<a name="l01429"></a>01429 
<a name="l01430"></a>01430         <span class="keywordflow">if</span> ([_delegate respondsToSelector:<span class="keyword">@selector</span>(tableViewSelectionIsChanging:)])
<a name="l01431"></a>01431             [defaultCenter
<a name="l01432"></a>01432                 removeObserver:_delegate
<a name="l01433"></a>01433                           name:CPTableViewSelectionIsChangingNotification
<a name="l01434"></a>01434                         object:self];
<a name="l01435"></a>01435     }
<a name="l01436"></a>01436 
<a name="l01437"></a>01437     _delegate = aDelegate;
<a name="l01438"></a>01438     _implementedDelegateMethods = 0;
<a name="l01439"></a>01439 
<a name="l01440"></a>01440     <span class="keywordflow">if</span> ([_delegate respondsToSelector:<span class="keyword">@selector</span>(selectionShouldChangeInTableView:)])
<a name="l01441"></a>01441         _implementedDelegateMethods |= <a class="code" href="_c_p_table_view_8j.html#a17dd3c2f77d47e02db83a2643962e03f">CPTableViewDelegate_selectionShouldChangeInTableView_</a>;
<a name="l01442"></a>01442 
<a name="l01443"></a>01443     <span class="keywordflow">if</span> ([_delegate respondsToSelector:<span class="keyword">@selector</span>(tableView:dataViewForTableColumn:row:)])
<a name="l01444"></a>01444         _implementedDelegateMethods |= <a class="code" href="_c_p_table_view_8j.html#a50ccc5dbd574a129aca4b61924308813">CPTableViewDelegate_tableView_dataViewForTableColumn_row_</a>;
<a name="l01445"></a>01445 
<a name="l01446"></a>01446     <span class="keywordflow">if</span> ([_delegate respondsToSelector:<span class="keyword">@selector</span>(tableView:didClickTableColumn:)])
<a name="l01447"></a>01447         _implementedDelegateMethods |= <a class="code" href="_c_p_table_view_8j.html#a11302327c1511f3a71d93e494794c655">CPTableViewDelegate_tableView_didClickTableColumn_</a>;
<a name="l01448"></a>01448 
<a name="l01449"></a>01449     <span class="keywordflow">if</span> ([_delegate respondsToSelector:<span class="keyword">@selector</span>(tableView:didDragTableColumn:)])
<a name="l01450"></a>01450         _implementedDelegateMethods |= <a class="code" href="_c_p_table_view_8j.html#ac6764797b21b0862c8ea1223c05626c2">CPTableViewDelegate_tableView_didDragTableColumn_</a>;
<a name="l01451"></a>01451 
<a name="l01452"></a>01452     <span class="keywordflow">if</span> ([_delegate respondsToSelector:<span class="keyword">@selector</span>(tableView:heightOfRow:)])
<a name="l01453"></a>01453         _implementedDelegateMethods |= <a class="code" href="_c_p_table_view_8j.html#afd61c24dda7ceebc29da34fa3b5f4a3a">CPTableViewDelegate_tableView_heightOfRow_</a>;
<a name="l01454"></a>01454 
<a name="l01455"></a>01455     <span class="keywordflow">if</span> ([_delegate respondsToSelector:<span class="keyword">@selector</span>(tableView:isGroupRow:)])
<a name="l01456"></a>01456         _implementedDelegateMethods |= <a class="code" href="_c_p_table_view_8j.html#a1b2d38c75129c936b93b4163a5a32889">CPTableViewDelegate_tableView_isGroupRow_</a>;
<a name="l01457"></a>01457 
<a name="l01458"></a>01458     <span class="keywordflow">if</span> ([_delegate respondsToSelector:<span class="keyword">@selector</span>(tableView:mouseDownInHeaderOfTableColumn:)])
<a name="l01459"></a>01459         _implementedDelegateMethods |= <a class="code" href="_c_p_table_view_8j.html#a53db520f3c6c396184ef32c5a586b027">CPTableViewDelegate_tableView_mouseDownInHeaderOfTableColumn_</a>;
<a name="l01460"></a>01460 
<a name="l01461"></a>01461     <span class="keywordflow">if</span> ([_delegate respondsToSelector:<span class="keyword">@selector</span>(tableView:nextTypeSelectMatchFromRow:toRow:forString:)])
<a name="l01462"></a>01462         _implementedDelegateMethods |= <a class="code" href="_c_p_table_view_8j.html#abf8671c1652c48238dc5c04fc9550a62">CPTableViewDelegate_tableView_nextTypeSelectMatchFromRow_toRow_forString_</a>;
<a name="l01463"></a>01463 
<a name="l01464"></a>01464     <span class="keywordflow">if</span> ([_delegate respondsToSelector:<span class="keyword">@selector</span>(tableView:selectionIndexesForProposedSelection:)])
<a name="l01465"></a>01465         _implementedDelegateMethods |= <a class="code" href="_c_p_table_view_8j.html#a87a639d266ecdd1db204b2b3e3d0e97d">CPTableViewDelegate_tableView_selectionIndexesForProposedSelection_</a>;
<a name="l01466"></a>01466 
<a name="l01467"></a>01467     <span class="keywordflow">if</span> ([_delegate respondsToSelector:<span class="keyword">@selector</span>(tableView:shouldEditTableColumn:row:)])
<a name="l01468"></a>01468         _implementedDelegateMethods |= <a class="code" href="_c_p_table_view_8j.html#a13a5d77ea463b7ee16d106bdf440baef">CPTableViewDelegate_tableView_shouldEditTableColumn_row_</a>;
<a name="l01469"></a>01469 
<a name="l01470"></a>01470     <span class="keywordflow">if</span> ([_delegate respondsToSelector:<span class="keyword">@selector</span>(tableView:shouldSelectRow:)])
<a name="l01471"></a>01471         _implementedDelegateMethods |= <a class="code" href="_c_p_table_view_8j.html#aaea951ab19dc11a096a69b28cc216e38">CPTableViewDelegate_tableView_shouldSelectRow_</a>;
<a name="l01472"></a>01472 
<a name="l01473"></a>01473     <span class="keywordflow">if</span> ([_delegate respondsToSelector:<span class="keyword">@selector</span>(tableView:shouldSelectTableColumn:)])
<a name="l01474"></a>01474         _implementedDelegateMethods |= <a class="code" href="_c_p_table_view_8j.html#a40e46e56c68f00ce2e3fe0c2dce75577">CPTableViewDelegate_tableView_shouldSelectTableColumn_</a>;
<a name="l01475"></a>01475 
<a name="l01476"></a>01476     <span class="keywordflow">if</span> ([_delegate respondsToSelector:<span class="keyword">@selector</span>(tableView:shouldShowViewExpansionForTableColumn:row:)])
<a name="l01477"></a>01477         _implementedDelegateMethods |= <a class="code" href="_c_p_table_view_8j.html#a47c3d5fa0d018996943ef98b80ffd3ed">CPTableViewDelegate_tableView_shouldShowViewExpansionForTableColumn_row_</a>;
<a name="l01478"></a>01478 
<a name="l01479"></a>01479     <span class="keywordflow">if</span> ([_delegate respondsToSelector:<span class="keyword">@selector</span>(tableView:shouldTrackView:forTableColumn:row:)])
<a name="l01480"></a>01480         _implementedDelegateMethods |= <a class="code" href="_c_p_table_view_8j.html#a84373538a8878335c8efedfc6a73dfda">CPTableViewDelegate_tableView_shouldTrackView_forTableColumn_row_</a>;
<a name="l01481"></a>01481 
<a name="l01482"></a>01482     <span class="keywordflow">if</span> ([_delegate respondsToSelector:<span class="keyword">@selector</span>(tableView:shouldTypeSelectForEvent:withCurrentSearchString:)])
<a name="l01483"></a>01483         _implementedDelegateMethods |= <a class="code" href="_c_p_table_view_8j.html#a90bdeeee16a3591df2596384e4f627e3">CPTableViewDelegate_tableView_shouldTypeSelectForEvent_withCurrentSearchString_</a>;
<a name="l01484"></a>01484 
<a name="l01485"></a>01485     <span class="keywordflow">if</span> ([_delegate respondsToSelector:<span class="keyword">@selector</span>(tableView:toolTipForView:rect:tableColumn:row:mouseLocation:)])
<a name="l01486"></a>01486         _implementedDelegateMethods |= <a class="code" href="_c_p_table_view_8j.html#a106983f227bb2afdff8e05449a4ea33a">CPTableViewDelegate_tableView_toolTipForView_rect_tableColumn_row_mouseLocation_</a>;
<a name="l01487"></a>01487 
<a name="l01488"></a>01488     <span class="keywordflow">if</span> ([_delegate respondsToSelector:<span class="keyword">@selector</span>(tableView:typeSelectStringForTableColumn:row:)])
<a name="l01489"></a>01489         _implementedDelegateMethods |= <a class="code" href="_c_p_table_view_8j.html#a8a84faf4826019c8a187588890360704">CPTableViewDelegate_tableView_typeSelectStringForTableColumn_row_</a>;
<a name="l01490"></a>01490 
<a name="l01491"></a>01491     <span class="keywordflow">if</span> ([_delegate respondsToSelector:<span class="keyword">@selector</span>(tableView:willDisplayView:forTableColumn:row:)])
<a name="l01492"></a>01492         _implementedDelegateMethods |= <a class="code" href="_c_p_table_view_8j.html#ad543a1b68132942313c20a9414cb508c">CPTableViewDelegate_tableView_willDisplayView_forTableColumn_row_</a>;
<a name="l01493"></a>01493 
<a name="l01494"></a>01494     <span class="keywordflow">if</span> ([_delegate respondsToSelector:<span class="keyword">@selector</span>(tableViewColumnDidMove:)])
<a name="l01495"></a>01495         [defaultCenter
<a name="l01496"></a>01496             addObserver:_delegate
<a name="l01497"></a>01497             selector:@selector(tableViewColumnDidMove:)
<a name="l01498"></a>01498             name:CPTableViewColumnDidMoveNotification
<a name="l01499"></a>01499             object:self];
<a name="l01500"></a>01500 
<a name="l01501"></a>01501     <span class="keywordflow">if</span> ([_delegate respondsToSelector:<span class="keyword">@selector</span>(tableViewColumnDidResize:)])
<a name="l01502"></a>01502         [defaultCenter
<a name="l01503"></a>01503             addObserver:_delegate
<a name="l01504"></a>01504             selector:@selector(tableViewColumnDidResize:)
<a name="l01505"></a>01505             name:CPTableViewColumnDidResizeNotification
<a name="l01506"></a>01506             object:self];
<a name="l01507"></a>01507 
<a name="l01508"></a>01508     <span class="keywordflow">if</span> ([_delegate respondsToSelector:<span class="keyword">@selector</span>(tableViewSelectionDidChange:)])
<a name="l01509"></a>01509         [defaultCenter
<a name="l01510"></a>01510             addObserver:_delegate
<a name="l01511"></a>01511             selector:@selector(tableViewSelectionDidChange:)
<a name="l01512"></a>01512             name:CPTableViewSelectionDidChangeNotification
<a name="l01513"></a>01513             object:self];
<a name="l01514"></a>01514 
<a name="l01515"></a>01515     <span class="keywordflow">if</span> ([_delegate respondsToSelector:<span class="keyword">@selector</span>(tableViewSelectionIsChanging:)])
<a name="l01516"></a>01516         [defaultCenter
<a name="l01517"></a>01517             addObserver:_delegate
<a name="l01518"></a>01518             selector:@selector(tableViewSelectionIsChanging:)
<a name="l01519"></a>01519             name:CPTableViewSelectionIsChangingNotification
<a name="l01520"></a>01520             object:self];
<a name="l01521"></a>01521 }
<a name="l01522"></a>01522 
<a name="l01523"></a><a class="code" href="class_c_p_table_view.html#a2d965d92f1eadcfbd2d98bc750c32c92">01523</a> - (id)delegate
<a name="l01524"></a>01524 {
<a name="l01525"></a>01525     <span class="keywordflow">return</span> _delegate;
<a name="l01526"></a>01526 }
<a name="l01527"></a>01527 
<a name="l01528"></a>01528 - (void)_sendDelegateDidClickColumn:(<span class="keywordtype">int</span>)column
<a name="l01529"></a>01529 {
<a name="l01530"></a>01530     <span class="keywordflow">if</span> (_implementedDelegateMethods &amp; <a class="code" href="_c_p_table_view_8j.html#a11302327c1511f3a71d93e494794c655">CPTableViewDelegate_tableView_didClickTableColumn_</a>)
<a name="l01531"></a>01531             [_delegate tableView:self didClickTableColumn:_tableColumns[column]];
<a name="l01532"></a>01532 }
<a name="l01533"></a>01533 
<a name="l01534"></a>01534 - (void)_sendDelegateDidDragColumn:(<span class="keywordtype">int</span>)column
<a name="l01535"></a>01535 {
<a name="l01536"></a>01536     <span class="keywordflow">if</span> (_implementedDelegateMethods &amp; <a class="code" href="_c_p_table_view_8j.html#ac6764797b21b0862c8ea1223c05626c2">CPTableViewDelegate_tableView_didDragTableColumn_</a>)
<a name="l01537"></a>01537             [_delegate tableView:self didDragTableColumn:_tableColumns[column]];
<a name="l01538"></a>01538 }
<a name="l01539"></a>01539 
<a name="l01540"></a>01540 - (void)_sendDelegateDidMouseDownInHeader:(<span class="keywordtype">int</span>)column
<a name="l01541"></a>01541 {
<a name="l01542"></a>01542     <span class="keywordflow">if</span> (_implementedDelegateMethods &amp; <a class="code" href="_c_p_table_view_8j.html#a53db520f3c6c396184ef32c5a586b027">CPTableViewDelegate_tableView_mouseDownInHeaderOfTableColumn_</a>)
<a name="l01543"></a>01543             [_delegate tableView:self mouseDownInHeaderOfTableColumn:_tableColumns[column]];
<a name="l01544"></a>01544 }
<a name="l01545"></a>01545 
<a name="l01546"></a>01546 <span class="comment">//Highlightable Column Headers</span>
<a name="l01547"></a>01547 <span class="comment">/*</span>
<a name="l01548"></a>01548 <span class="comment">- (CPTableColumn)highlightedTableColumn</span>
<a name="l01549"></a>01549 <span class="comment">{</span>
<a name="l01550"></a>01550 <span class="comment"></span>
<a name="l01551"></a>01551 <span class="comment">}</span>
<a name="l01552"></a>01552 <span class="comment"></span>
<a name="l01553"></a>01553 <span class="comment">    * - setHighlightedTableColumn:</span>
<a name="l01554"></a>01554 <span class="comment">*/</span>
<a name="l01555"></a>01555 <span class="comment">//Dragging</span>
<a name="l01556"></a>01556 <span class="comment">/*</span>
<a name="l01557"></a>01557 <span class="comment">    * - dragImageForRowsWithIndexes:tableColumns:event:offset:</span>
<a name="l01558"></a>01558 <span class="comment">    * - canDragRowsWithIndexes:atPoint:</span>
<a name="l01559"></a>01559 <span class="comment">    * - setDraggingSourceOperationMask:forLocal:</span>
<a name="l01560"></a>01560 <span class="comment">    * - setDropRow:dropOperation:</span>
<a name="l01561"></a>01561 <span class="comment">    * - setVerticalMotionCanBeginDrag:</span>
<a name="l01562"></a>01562 <span class="comment">    * - verticalMotionCanBeginDrag</span>
<a name="l01563"></a>01563 <span class="comment">*/</span>
<a name="l01569"></a><a class="code" href="class_c_p_table_view.html#a36bbab18fe3008a1ccdc7de1a58e3089">01569</a> - (BOOL)canDragRowsWithIndexes:(<a class="code" href="class_c_p_index_set.html">CPIndexSet</a>)rowIndexes atPoint:(CGPoint)mouseDownPoint
<a name="l01570"></a>01570 {
<a name="l01571"></a>01571     <span class="keywordflow">return</span> YES;
<a name="l01572"></a>01572 }
<a name="l01573"></a>01573 
<a name="l01574"></a><a class="code" href="class_c_p_table_view.html#a4d762c62bdd4525f7b3a4fe6ddf38164">01574</a> - (<a class="code" href="class_c_p_image.html">CPImage</a>)dragImageForRowsWithIndexes:(<a class="code" href="class_c_p_index_set.html">CPIndexSet</a>)dragRows 
<a name="l01575"></a>01575                           tableColumns:(CPArray)theTableColumns 
<a name="l01576"></a>01576                                  event:(<a class="code" href="class_c_p_event.html">CPEvent</a>)dragEvent 
<a name="l01577"></a>01577                                 offset:(CPPointPointer)dragImageOffset
<a name="l01578"></a>01578 {
<a name="l01579"></a>01579     <span class="keywordflow">return</span> [[<a class="code" href="class_c_p_image.html">CPImage</a> alloc] initWithContentsOfFile:@&quot;Frameworks/AppKit/Resources/GenericFile.png&quot; size:CGSizeMake(32,32)];
<a name="l01580"></a>01580 }
<a name="l01581"></a>01581 
<a name="l01582"></a><a class="code" href="class_c_p_table_view.html#acb389ac8e4905c13aae0b290ce7f8e37">01582</a> - (<a class="code" href="class_c_p_view.html">CPView</a>)dragViewForRowsWithIndexes:(<a class="code" href="class_c_p_index_set.html">CPIndexSet</a>)theDraggedRows 
<a name="l01583"></a>01583                         tableColumns:(CPArray)theTableColumns 
<a name="l01584"></a>01584                                event:(<a class="code" href="class_c_p_event.html">CPEvent</a>)theDragEvent 
<a name="l01585"></a>01585                               offset:(CPPoint)dragViewOffset
<a name="l01586"></a>01586 {
<a name="l01587"></a>01587     var bounds = [<span class="keyword">self</span> bounds],
<a name="l01588"></a>01588         view = [[<a class="code" href="class_c_p_view.html">CPView</a> alloc] initWithFrame:bounds];
<a name="l01589"></a>01589         
<a name="l01590"></a>01590     [view setBackgroundColor:[<a class="code" href="class_c_p_color.html">CPColor</a> clearColor]];
<a name="l01591"></a>01591     [view setAlphaValue:0.7];
<a name="l01592"></a>01592     
<a name="l01593"></a>01593     <span class="comment">// We have to fetch all the data views for the selected rows and columns</span>
<a name="l01594"></a>01594     <span class="comment">// After that we can copy these add them to a transparent drag view and use that drag view </span>
<a name="l01595"></a>01595     <span class="comment">// to make it appear we are dragging images of those rows (as you would do in regular Cocoa)</span>
<a name="l01596"></a>01596     var firstExposedColumn = [_exposedColumns firstIndex],
<a name="l01597"></a>01597         firstExposedRow = [_exposedRows firstIndex],
<a name="l01598"></a>01598         exposedColumnsLength = [_exposedColumns lastIndex] - firstExposedColumn + 1,
<a name="l01599"></a>01599         exposedRowsLength = [_exposedRows lastIndex] - firstExposedRow + 1,
<a name="l01600"></a>01600         columns = [],
<a name="l01601"></a>01601         rows = [];
<a name="l01602"></a>01602         
<a name="l01603"></a>01603     [_exposedColumns getIndexes:columns maxCount:-1 inIndexRange:CPMakeRange(firstExposedColumn, exposedColumnsLength)];
<a name="l01604"></a>01604     [theDraggedRows getIndexes:rows maxCount:-1 inIndexRange:CPMakeRange(firstExposedRow, exposedRowsLength)];
<a name="l01605"></a>01605 
<a name="l01606"></a>01606     var columnIndex = [columns count];
<a name="l01607"></a>01607         
<a name="l01608"></a>01608     <span class="keywordflow">while</span> (columnIndex--) 
<a name="l01609"></a>01609     {
<a name="l01610"></a>01610         var column = columns[columnIndex],
<a name="l01611"></a>01611             tableColumn = [_tableColumns objectAtIndex:column],
<a name="l01612"></a>01612             rowIndex = [rows count];
<a name="l01613"></a>01613         
<a name="l01614"></a>01614         <span class="keywordflow">while</span> (rowIndex--)
<a name="l01615"></a>01615         { 
<a name="l01616"></a>01616             var row = rows[rowIndex];
<a name="l01617"></a>01617             var dataView = [<span class="keyword">self</span> _newDataViewForRow:row tableColumn:tableColumn];
<a name="l01618"></a>01618             
<a name="l01619"></a>01619             [dataView setBackgroundColor:[<a class="code" href="class_c_p_color.html">CPColor</a> clearColor]];
<a name="l01620"></a>01620             [dataView setFrame:[<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#afa878164caef6b4c75e2ef5328cc3612">frameOfDataViewAtColumn</a>:column <a class="code" href="class_c_p_table_view.html#afa878164caef6b4c75e2ef5328cc3612">row</a>:row]];
<a name="l01621"></a>01621             [dataView setObjectValue:[<span class="keyword">self</span> _objectValueForTableColumn:tableColumn row:row]];
<a name="l01622"></a>01622             
<a name="l01623"></a>01623             [view addSubview:dataView];
<a name="l01624"></a>01624         }
<a name="l01625"></a>01625     }
<a name="l01626"></a>01626     
<a name="l01627"></a>01627     var dragPoint = [<span class="keyword">self</span> convertPoint:[theDragEvent <a class="code" href="class_c_p_event.html#a5a57f4fa909de5d83e5402a8d8af4b94">locationInWindow</a>] fromView:nil];
<a name="l01628"></a>01628     dragViewOffset.x = <a class="code" href="_c_g_geometry_8j.html#aa310af239f2108c573299b35776996fa">CGRectGetWidth</a>(bounds)/2 - dragPoint.x;
<a name="l01629"></a>01629     dragViewOffset.y = <a class="code" href="_c_g_geometry_8j.html#a09d2072d60c7f39b04a41705d640fa98">CGRectGetHeight</a>(bounds)/2 - dragPoint.y;
<a name="l01630"></a>01630     
<a name="l01631"></a>01631     <span class="keywordflow">return</span> view;
<a name="l01632"></a>01632 }
<a name="l01633"></a>01633 
<a name="l01634"></a><a class="code" href="class_c_p_table_view.html#a2950280f57f4aae1189e143fe23d0b2e">01634</a> - (void)setDraggingSourceOperationMask:(CPDragOperation)mask forLocal:(BOOL)isLocal
<a name="l01635"></a>01635 {
<a name="l01636"></a>01636     <span class="comment">//ignoral local for the time being since only one capp app can run at a time...</span>
<a name="l01637"></a>01637     _dragOperationDefaultMask = mask;
<a name="l01638"></a>01638 }
<a name="l01639"></a>01639 
<a name="l01645"></a><a class="code" href="class_c_p_table_view.html#a6d0d013a22f3acb18da993ea3c310e6e">01645</a> - (void)setDropRow:(CPInteger)row dropOperation:(CPTableViewDropOperation)operation
<a name="l01646"></a>01646 {
<a name="l01647"></a>01647     <span class="keywordflow">if</span>(row &lt; 0 &amp;&amp; operation === <a class="code" href="_c_p_table_view_8j.html#a4c2d1434c8bc5b937eeb47b55f5c74d0">CPTableViewDropAbove</a>)
<a name="l01648"></a>01648         row = 0;
<a name="l01649"></a>01649 
<a name="l01650"></a>01650     <span class="keywordflow">if</span>(row &gt;= [<span class="keyword">self</span> numberOfRows] &amp;&amp; operation === <a class="code" href="_c_p_table_view_8j.html#a279093eafa50075a94c202e0dd51861a">CPTableViewDropOn</a>)
<a name="l01651"></a>01651         [[CPException exceptionWithName:@&quot;Error&quot; reason:@&quot;Attempt to set dropRow=&quot;+ row +&quot;, dropOperation=CPTableViewDropOn when [0 - &quot;+ [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#ab93d1883609b8aaca737188ee9667c17">numberOfRows</a>] +&quot;] is valid range of rows.&quot; userInfo:nil] raise];
<a name="l01652"></a>01652 
<a name="l01653"></a>01653     _retargetedDropRow = row;
<a name="l01654"></a>01654     _retargetedDropOperation = operation;
<a name="l01655"></a>01655 }
<a name="l01656"></a>01656 
<a name="l01664"></a><a class="code" href="class_c_p_table_view.html#ac3b64dfb51786e6eabb88333b160abd1">01664</a> - (void)setDraggingDestinationFeedbackStyle:(CPTableViewDraggingDestinationFeedbackStyle)aStyle
<a name="l01665"></a>01665 {
<a name="l01666"></a>01666     <span class="comment">//FIX ME: this should vary up the highlight color, currently nothing is being done with it</span>
<a name="l01667"></a>01667     _destinationDragStyle = aStyle;
<a name="l01668"></a>01668 }
<a name="l01669"></a>01669 
<a name="l01670"></a><a class="code" href="class_c_p_table_view.html#a5dc6ce6bc6c517f59a4a6ee9f6f11043">01670</a> - (CPTableViewDraggingDestinationFeedbackStyle)draggingDestinationFeedbackStyle
<a name="l01671"></a>01671 {
<a name="l01672"></a>01672     <span class="keywordflow">return</span> _destinationDragStyle;
<a name="l01673"></a>01673 }
<a name="l01674"></a>01674 
<a name="l01679"></a><a class="code" href="class_c_p_table_view.html#af8ef2e471bdae5db5e21d05177e9e1ff">01679</a> - (void)setVerticalMotionCanBeginDrag:(BOOL)aFlag
<a name="l01680"></a>01680 {
<a name="l01681"></a>01681     _verticalMotionCanDrag = aFlag;
<a name="l01682"></a>01682 }
<a name="l01683"></a>01683 
<a name="l01684"></a><a class="code" href="class_c_p_table_view.html#a92dba28832bd617d81dbd5b8e64dda6d">01684</a> - (BOOL)verticalMotionCanBeginDrag
<a name="l01685"></a>01685 {
<a name="l01686"></a>01686     <span class="keywordflow">return</span> _verticalMotionCanDrag;
<a name="l01687"></a>01687 }
<a name="l01688"></a>01688 
<a name="l01689"></a>01689 
<a name="l01690"></a>01690 
<a name="l01691"></a>01691 <span class="comment">//Sorting</span>
<a name="l01692"></a>01692 <span class="comment">/*</span>
<a name="l01693"></a>01693 <span class="comment">    * - setSortDescriptors:</span>
<a name="l01694"></a>01694 <span class="comment">    * - sortDescriptors</span>
<a name="l01695"></a>01695 <span class="comment">*/</span>
<a name="l01696"></a>01696 
<a name="l01697"></a>01697 <span class="comment">//Text Delegate Methods</span>
<a name="l01698"></a>01698 <span class="comment">/*</span>
<a name="l01699"></a>01699 <span class="comment">    * - textShouldBeginEditing:</span>
<a name="l01700"></a>01700 <span class="comment">    * - textDidBeginEditing:</span>
<a name="l01701"></a>01701 <span class="comment">    * - textDidChange:</span>
<a name="l01702"></a>01702 <span class="comment">    * - textShouldEndEditing:</span>
<a name="l01703"></a>01703 <span class="comment">    * - textDidEndEditing:</span>
<a name="l01704"></a>01704 <span class="comment">*/</span>
<a name="l01705"></a>01705 
<a name="l01706"></a>01706 - (id)_objectValueForTableColumn:(<a class="code" href="class_c_p_table_column.html">CPTableColumn</a>)aTableColumn row:(CPInteger)aRowIndex
<a name="l01707"></a>01707 {
<a name="l01708"></a>01708     var tableColumnUID = [aTableColumn UID],
<a name="l01709"></a>01709         tableColumnObjectValues = _objectValues[tableColumnUID];
<a name="l01710"></a>01710 
<a name="l01711"></a>01711     <span class="keywordflow">if</span> (!tableColumnObjectValues)
<a name="l01712"></a>01712     {
<a name="l01713"></a>01713         tableColumnObjectValues = [];
<a name="l01714"></a>01714         _objectValues[tableColumnUID] = tableColumnObjectValues;
<a name="l01715"></a>01715     }
<a name="l01716"></a>01716 
<a name="l01717"></a>01717     var objectValue = tableColumnObjectValues[aRowIndex];
<a name="l01718"></a>01718 
<a name="l01719"></a>01719     <span class="keywordflow">if</span> (objectValue === undefined)
<a name="l01720"></a>01720     {
<a name="l01721"></a>01721         objectValue = [_dataSource tableView:self objectValueForTableColumn:aTableColumn row:aRowIndex];
<a name="l01722"></a>01722         tableColumnObjectValues[aRowIndex] = objectValue;
<a name="l01723"></a>01723     }
<a name="l01724"></a>01724 
<a name="l01725"></a>01725     <span class="keywordflow">return</span> objectValue;
<a name="l01726"></a>01726 }
<a name="l01727"></a>01727 
<a name="l01728"></a>01728 - (CGRect)_exposedRect
<a name="l01729"></a>01729 {
<a name="l01730"></a>01730     var superview = [<span class="keyword">self</span> superview];
<a name="l01731"></a>01731 
<a name="l01732"></a>01732     <span class="keywordflow">if</span> (![superview isKindOfClass:[<a class="code" href="class_c_p_clip_view.html">CPClipView</a> <span class="keyword">class</span>]])
<a name="l01733"></a>01733         <span class="keywordflow">return</span> [<span class="keyword">self</span> bounds];
<a name="l01734"></a>01734 
<a name="l01735"></a>01735     <span class="keywordflow">return</span> [<span class="keyword">self</span> convertRect:CGRectIntersection([superview bounds], [<span class="keyword">self</span> frame]) fromView:superview];
<a name="l01736"></a>01736 }
<a name="l01737"></a>01737 
<a name="l01738"></a><a class="code" href="class_c_p_table_view.html#a7dc6ff16b80a132f5bb7aa3dbaa16e50">01738</a> - (void)load
<a name="l01739"></a>01739 {
<a name="l01740"></a>01740 <span class="comment">//    if (!window.blah)</span>
<a name="l01741"></a>01741 <span class="comment">//        return window.setTimeout(function() { window.blah = true; [self load]; window.blah = false}, 0.0);</span>
<a name="l01742"></a>01742 
<a name="l01743"></a>01743  <span class="comment">//   if (window.console &amp;&amp; window.console.profile)</span>
<a name="l01744"></a>01744  <span class="comment">//       console.profile(&quot;cell-load&quot;);</span>
<a name="l01745"></a>01745 
<a name="l01746"></a>01746     <span class="keywordflow">if</span> (_reloadAllRows)
<a name="l01747"></a>01747     {
<a name="l01748"></a>01748         [<span class="keyword">self</span> _unloadDataViewsInRows:_exposedRows columns:_exposedColumns];
<a name="l01749"></a>01749 
<a name="l01750"></a>01750         _exposedRows = [<a class="code" href="class_c_p_index_set.html">CPIndexSet</a> indexSet];
<a name="l01751"></a>01751         _exposedColumns = [<a class="code" href="class_c_p_index_set.html">CPIndexSet</a> indexSet];
<a name="l01752"></a>01752 
<a name="l01753"></a>01753         _reloadAllRows = NO;
<a name="l01754"></a>01754     }
<a name="l01755"></a>01755 
<a name="l01756"></a>01756     var exposedRect = [<span class="keyword">self</span> _exposedRect],
<a name="l01757"></a>01757         exposedRows = [<a class="code" href="class_c_p_index_set.html">CPIndexSet</a> indexSetWithIndexesInRange:[<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#a7d9128a2f32c6714364d5217894daa44">rowsInRect</a>:exposedRect]],
<a name="l01758"></a>01758         exposedColumns = [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#a1acdacf678fb91a541b692d378586289">columnIndexesInRect</a>:exposedRect],
<a name="l01759"></a>01759         obscuredRows = [_exposedRows copy],
<a name="l01760"></a>01760         obscuredColumns = [_exposedColumns copy];
<a name="l01761"></a>01761 
<a name="l01762"></a>01762     [obscuredRows removeIndexes:exposedRows];
<a name="l01763"></a>01763     [obscuredColumns removeIndexes:exposedColumns];
<a name="l01764"></a>01764 
<a name="l01765"></a>01765     var newlyExposedRows = [exposedRows copy],
<a name="l01766"></a>01766         newlyExposedColumns = [exposedColumns copy];
<a name="l01767"></a>01767 
<a name="l01768"></a>01768     [newlyExposedRows removeIndexes:_exposedRows];
<a name="l01769"></a>01769     [newlyExposedColumns removeIndexes:_exposedColumns];
<a name="l01770"></a>01770 
<a name="l01771"></a>01771     var previouslyExposedRows = [exposedRows copy],
<a name="l01772"></a>01772         previouslyExposedColumns = [exposedColumns copy];
<a name="l01773"></a>01773 
<a name="l01774"></a>01774     [previouslyExposedRows removeIndexes:newlyExposedRows];
<a name="l01775"></a>01775     [previouslyExposedColumns removeIndexes:newlyExposedColumns];
<a name="l01776"></a>01776 
<a name="l01777"></a>01777 <span class="comment">//    console.log(&quot;will remove:&quot; + &#39;\n\n&#39; +</span>
<a name="l01778"></a>01778 <span class="comment">//        previouslyExposedRows + &quot;\n&quot; + obscuredColumns + &quot;\n\n&quot; +</span>
<a name="l01779"></a>01779 <span class="comment">//        obscuredRows + &quot;\n&quot; + previouslyExposedColumns + &quot;\n\n&quot; +</span>
<a name="l01780"></a>01780 <span class="comment">//        obscuredRows + &quot;\n&quot; + obscuredColumns);</span>
<a name="l01781"></a>01781     [<span class="keyword">self</span> _unloadDataViewsInRows:previouslyExposedRows columns:obscuredColumns];
<a name="l01782"></a>01782     [<span class="keyword">self</span> _unloadDataViewsInRows:obscuredRows columns:previouslyExposedColumns];
<a name="l01783"></a>01783     [<span class="keyword">self</span> _unloadDataViewsInRows:obscuredRows columns:obscuredColumns];
<a name="l01784"></a>01784 
<a name="l01785"></a>01785     [<span class="keyword">self</span> _loadDataViewsInRows:previouslyExposedRows columns:newlyExposedColumns];
<a name="l01786"></a>01786     [<span class="keyword">self</span> _loadDataViewsInRows:newlyExposedRows columns:previouslyExposedColumns];
<a name="l01787"></a>01787     [<span class="keyword">self</span> _loadDataViewsInRows:newlyExposedRows columns:newlyExposedColumns];
<a name="l01788"></a>01788 
<a name="l01789"></a>01789 <span class="comment">//    console.log(&quot;newly exposed rows: &quot; + newlyExposedRows + &quot;\nnewly exposed columns: &quot; + newlyExposedColumns);</span>
<a name="l01790"></a>01790     _exposedRows = exposedRows;
<a name="l01791"></a>01791     _exposedColumns = exposedColumns;
<a name="l01792"></a>01792 
<a name="l01793"></a>01793     [_tableDrawView setFrame:exposedRect];
<a name="l01794"></a>01794 
<a name="l01795"></a>01795 <span class="comment">//    [_tableDrawView setBounds:exposedRect];</span>
<a name="l01796"></a>01796     [_tableDrawView display];
<a name="l01797"></a>01797 
<a name="l01798"></a>01798     <span class="comment">// Now clear all the leftovers</span>
<a name="l01799"></a>01799     <span class="comment">// FIXME: this could be faster!</span>
<a name="l01800"></a>01800     <span class="keywordflow">for</span> (identifier in _cachedDataViews)
<a name="l01801"></a>01801     {
<a name="l01802"></a>01802         var dataViews = _cachedDataViews[identifier],
<a name="l01803"></a>01803             count = dataViews.length;
<a name="l01804"></a>01804 
<a name="l01805"></a>01805         <span class="keywordflow">while</span> (count--)
<a name="l01806"></a>01806             [dataViews[count] removeFromSuperview];
<a name="l01807"></a>01807     }
<a name="l01808"></a>01808 
<a name="l01809"></a>01809   <span class="comment">//  if (window.console &amp;&amp; window.console.profile)</span>
<a name="l01810"></a>01810 <span class="comment">//        console.profileEnd(&quot;cell-load&quot;);</span>
<a name="l01811"></a>01811 }
<a name="l01812"></a>01812 
<a name="l01813"></a>01813 - (void)_unloadDataViewsInRows:(<a class="code" href="class_c_p_index_set.html">CPIndexSet</a>)rows columns:(<a class="code" href="class_c_p_index_set.html">CPIndexSet</a>)columns
<a name="l01814"></a>01814 {
<a name="l01815"></a>01815     <span class="keywordflow">if</span> (![rows count] || ![columns count])
<a name="l01816"></a>01816         <span class="keywordflow">return</span>;
<a name="l01817"></a>01817 
<a name="l01818"></a>01818     var rowArray = [],
<a name="l01819"></a>01819         columnArray = [];
<a name="l01820"></a>01820 
<a name="l01821"></a>01821     [rows getIndexes:rowArray maxCount:-1 inIndexRange:nil];
<a name="l01822"></a>01822     [columns getIndexes:columnArray maxCount:-1 inIndexRange:nil];
<a name="l01823"></a>01823 
<a name="l01824"></a>01824     var columnIndex = 0,
<a name="l01825"></a>01825         columnsCount = columnArray.length;
<a name="l01826"></a>01826 
<a name="l01827"></a>01827     <span class="keywordflow">for</span> (; columnIndex &lt; columnsCount; ++columnIndex)
<a name="l01828"></a>01828     {
<a name="l01829"></a>01829         var column = columnArray[columnIndex],
<a name="l01830"></a>01830             tableColumn = _tableColumns[column],
<a name="l01831"></a>01831             tableColumnUID = [tableColumn UID];
<a name="l01832"></a>01832 
<a name="l01833"></a>01833         var rowIndex = 0,
<a name="l01834"></a>01834             rowsCount = rowArray.length;
<a name="l01835"></a>01835 
<a name="l01836"></a>01836         <span class="keywordflow">for</span> (; rowIndex &lt; rowsCount; ++rowIndex)
<a name="l01837"></a>01837         {
<a name="l01838"></a>01838             var row = rowArray[rowIndex],
<a name="l01839"></a>01839                 dataView = _dataViewsForTableColumns[tableColumnUID][row];
<a name="l01840"></a>01840 
<a name="l01841"></a>01841             _dataViewsForTableColumns[tableColumnUID][row] = nil;
<a name="l01842"></a>01842 
<a name="l01843"></a>01843             [<span class="keyword">self</span> _enqueueReusableDataView:dataView];
<a name="l01844"></a>01844         }
<a name="l01845"></a>01845     }
<a name="l01846"></a>01846 }
<a name="l01847"></a>01847 
<a name="l01848"></a>01848 - (void)_loadDataViewsInRows:(<a class="code" href="class_c_p_index_set.html">CPIndexSet</a>)rows columns:(<a class="code" href="class_c_p_index_set.html">CPIndexSet</a>)columns
<a name="l01849"></a>01849 {
<a name="l01850"></a>01850     <span class="keywordflow">if</span> (![rows count] || ![columns count])
<a name="l01851"></a>01851         <span class="keywordflow">return</span>;
<a name="l01852"></a>01852 
<a name="l01853"></a>01853     var rowArray = [],
<a name="l01854"></a>01854         rowRects = [],
<a name="l01855"></a>01855         columnArray = [];
<a name="l01856"></a>01856 
<a name="l01857"></a>01857     [rows getIndexes:rowArray maxCount:-1 inIndexRange:nil];
<a name="l01858"></a>01858     [columns getIndexes:columnArray maxCount:-1 inIndexRange:nil];
<a name="l01859"></a>01859 
<a name="l01860"></a>01860     <a class="code" href="_c_p_table_view_8j.html#a8d863ee1b9f1e447c7ee408af11b8f22">UPDATE_COLUMN_RANGES_IF_NECESSARY</a>();
<a name="l01861"></a>01861 
<a name="l01862"></a>01862     var columnIndex = 0,
<a name="l01863"></a>01863         columnsCount = columnArray.length;
<a name="l01864"></a>01864 
<a name="l01865"></a>01865     <span class="keywordflow">for</span> (; columnIndex &lt; columnsCount; ++columnIndex)
<a name="l01866"></a>01866     {
<a name="l01867"></a>01867         var column = columnArray[columnIndex],
<a name="l01868"></a>01868             tableColumn = _tableColumns[column],
<a name="l01869"></a>01869             tableColumnUID = [tableColumn UID];
<a name="l01870"></a>01870 
<a name="l01871"></a>01871         <span class="keywordflow">if</span> (!_dataViewsForTableColumns[tableColumnUID])
<a name="l01872"></a>01872             _dataViewsForTableColumns[tableColumnUID] = [];
<a name="l01873"></a>01873 
<a name="l01874"></a>01874         var rowIndex = 0,
<a name="l01875"></a>01875             rowsCount = rowArray.length;
<a name="l01876"></a>01876 
<a name="l01877"></a>01877         var isColumnSelected = [_selectedColumnIndexes containsIndex:column];
<a name="l01878"></a>01878         <span class="keywordflow">for</span> (; rowIndex &lt; rowsCount; ++rowIndex)
<a name="l01879"></a>01879         {
<a name="l01880"></a>01880             var row = rowArray[rowIndex],
<a name="l01881"></a>01881                 dataView = [<span class="keyword">self</span> _newDataViewForRow:row tableColumn:tableColumn],
<a name="l01882"></a>01882                 isTextField = [dataView isKindOfClass:[<a class="code" href="class_c_p_text_field.html">CPTextField</a> class]];
<a name="l01883"></a>01883 
<a name="l01884"></a>01884             [dataView setFrame:[<span class="keyword">self</span> frameOfDataViewAtColumn:column row:row]];
<a name="l01885"></a>01885             [dataView setObjectValue:[<span class="keyword">self</span> _objectValueForTableColumn:tableColumn row:row]];
<a name="l01886"></a>01886 
<a name="l01887"></a>01887             <span class="keywordflow">if</span> (isColumnSelected || [<span class="keyword">self</span> isRowSelected:row])
<a name="l01888"></a>01888                 [dataView setThemeState:<a class="code" href="_c_p_theme_8j.html#aa68f7cdbec02d10022cccba055493bec">CPThemeStateHighlighted</a>];
<a name="l01889"></a>01889             <span class="keywordflow">else</span>
<a name="l01890"></a>01890                 [dataView unsetThemeState:CPThemeStateHighlighted];
<a name="l01891"></a>01891 
<a name="l01892"></a>01892             <span class="keywordflow">if</span> (_implementedDelegateMethods &amp; <a class="code" href="_c_p_table_view_8j.html#ad543a1b68132942313c20a9414cb508c">CPTableViewDelegate_tableView_willDisplayView_forTableColumn_row_</a>)
<a name="l01893"></a>01893                 [[<span class="keyword">self</span> delegate] tableView:<span class="keyword">self</span> willDisplayView:dataView forTableColumn:tableColumn row:row];
<a name="l01894"></a>01894 
<a name="l01895"></a>01895             <span class="keywordflow">if</span> ([dataView superview] !== <span class="keyword">self</span>)
<a name="l01896"></a>01896                 [<span class="keyword">self</span> addSubview:dataView];
<a name="l01897"></a>01897 
<a name="l01898"></a>01898             _dataViewsForTableColumns[tableColumnUID][row] = dataView;
<a name="l01899"></a>01899 
<a name="l01900"></a>01900             <span class="keywordflow">if</span> (_editingCellIndex &amp;&amp; _editingCellIndex.x === column &amp;&amp; _editingCellIndex.y === row) {
<a name="l01901"></a>01901                 _editingCellIndex = undefined;
<a name="l01902"></a>01902 
<a name="l01903"></a>01903                 <a class="code" href="_c_a_backing_store_8j.html#ad2b049b1f6911d2ffffc0769dfe601e4">if</a> (isTextField) {
<a name="l01904"></a>01904                     [dataView setEditable:YES];
<a name="l01905"></a>01905                     [dataView setSendsActionOnEndEditing:YES];
<a name="l01906"></a>01906                     [dataView setSelectable:YES];
<a name="l01907"></a>01907                     [dataView selectText:nil]; <span class="comment">// Doesn&#39;t seem to actually work (yet?).</span>
<a name="l01908"></a>01908                 }
<a name="l01909"></a>01909                 [dataView setTarget:self];
<a name="l01910"></a>01910                 [dataView setAction:@selector(_commitDataViewObjectValue:)];
<a name="l01911"></a>01911                 dataView.tableViewEditedColumnObj = tableColumn;
<a name="l01912"></a>01912                 dataView.tableViewEditedRowIndex = row;
<a name="l01913"></a>01913             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isTextField) {
<a name="l01914"></a>01914                 [dataView setEditable:NO];
<a name="l01915"></a>01915                 [dataView setSelectable:NO];
<a name="l01916"></a>01916             }
<a name="l01917"></a>01917         }
<a name="l01918"></a>01918     }
<a name="l01919"></a>01919 }
<a name="l01920"></a>01920 
<a name="l01921"></a>01921 - (void)_layoutDataViewsInRows:(<a class="code" href="class_c_p_index_set.html">CPIndexSet</a>)rows columns:(<a class="code" href="class_c_p_index_set.html">CPIndexSet</a>)columns
<a name="l01922"></a>01922 {
<a name="l01923"></a>01923    var rowArray = [],
<a name="l01924"></a>01924         rowRects = [],
<a name="l01925"></a>01925         columnArray = [];
<a name="l01926"></a>01926 
<a name="l01927"></a>01927     [rows getIndexes:rowArray maxCount:-1 inIndexRange:nil];
<a name="l01928"></a>01928     [columns getIndexes:columnArray maxCount:-1 inIndexRange:nil];
<a name="l01929"></a>01929 
<a name="l01930"></a>01930     <a class="code" href="_c_p_table_view_8j.html#a8d863ee1b9f1e447c7ee408af11b8f22">UPDATE_COLUMN_RANGES_IF_NECESSARY</a>();
<a name="l01931"></a>01931 
<a name="l01932"></a>01932     var columnIndex = 0,
<a name="l01933"></a>01933         columnsCount = columnArray.length;
<a name="l01934"></a>01934 
<a name="l01935"></a>01935     <span class="keywordflow">for</span> (; columnIndex &lt; columnsCount; ++columnIndex)
<a name="l01936"></a>01936     {        
<a name="l01937"></a>01937         var column = columnArray[columnIndex],
<a name="l01938"></a>01938             tableColumn = _tableColumns[column],
<a name="l01939"></a>01939             tableColumnUID = [tableColumn UID],
<a name="l01940"></a>01940             dataViewsForTableColumn = _dataViewsForTableColumns[tableColumnUID],
<a name="l01941"></a>01941             columnRange = _tableColumnRanges[column];
<a name="l01942"></a>01942             
<a name="l01943"></a>01943         var rowIndex = 0,
<a name="l01944"></a>01944             rowsCount = rowArray.length;            
<a name="l01945"></a>01945 
<a name="l01946"></a>01946         <span class="keywordflow">for</span> (; rowIndex &lt; rowsCount; ++rowIndex)
<a name="l01947"></a>01947         {
<a name="l01948"></a>01948             var row = rowArray[rowIndex],
<a name="l01949"></a>01949                 dataView = dataViewsForTableColumn[row],                
<a name="l01950"></a>01950                 <a class="code" href="_c_p_segmented_control_8j.html#a63fcc9e0dd97e8502cce685e88234e16">frame</a> = [dataView frame];
<a name="l01951"></a>01951             
<a name="l01952"></a>01952             frame.origin.x = columnRange.location;
<a name="l01953"></a>01953             frame.size.width = columnRange.length;
<a name="l01954"></a>01954         
<a name="l01955"></a>01955             [dataView setFrame:frame];
<a name="l01956"></a>01956         }
<a name="l01957"></a>01957     }
<a name="l01958"></a>01958 }
<a name="l01959"></a>01959 
<a name="l01960"></a>01960 - (void)_commitDataViewObjectValue:(CPTextView)sender
<a name="l01961"></a>01961 {
<a name="l01962"></a>01962     [_dataSource tableView:self
<a name="l01963"></a>01963         setObjectValue:[sender objectValue]
<a name="l01964"></a>01964         forTableColumn:sender.tableViewEditedColumnObj
<a name="l01965"></a>01965         row:sender.tableViewEditedRowIndex];
<a name="l01966"></a>01966 }
<a name="l01967"></a>01967 
<a name="l01968"></a>01968 - (<a class="code" href="class_c_p_view.html">CPView</a>)_newDataViewForRow:(CPInteger)aRow tableColumn:(<a class="code" href="class_c_p_table_column.html">CPTableColumn</a>)aTableColumn
<a name="l01969"></a>01969 {
<a name="l01970"></a>01970     <span class="keywordflow">return</span> [aTableColumn _newDataViewForRow:aRow];
<a name="l01971"></a>01971 }
<a name="l01972"></a>01972 
<a name="l01973"></a>01973 - (void)_enqueueReusableDataView:(<a class="code" href="class_c_p_view.html">CPView</a>)aDataView
<a name="l01974"></a>01974 {
<a name="l01975"></a>01975     <span class="comment">// FIXME: yuck!</span>
<a name="l01976"></a>01976     var identifier = aDataView.identifier;
<a name="l01977"></a>01977 
<a name="l01978"></a>01978     <span class="keywordflow">if</span> (!_cachedDataViews[identifier])
<a name="l01979"></a>01979         _cachedDataViews[identifier] = [aDataView];
<a name="l01980"></a>01980     <span class="keywordflow">else</span>
<a name="l01981"></a>01981         _cachedDataViews[identifier].push(aDataView);
<a name="l01982"></a>01982 }
<a name="l01983"></a>01983 
<a name="l01984"></a><a class="code" href="class_c_p_table_view.html#a2f8731a826f57388dba260fa2ccc64eb">01984</a> - (void)setFrameSize:(CGSize)aSize
<a name="l01985"></a>01985 {
<a name="l01986"></a>01986     [<span class="keyword">super</span> setFrameSize:aSize];
<a name="l01987"></a>01987 
<a name="l01988"></a>01988     <span class="keywordflow">if</span> (_headerView)
<a name="l01989"></a>01989         [_headerView setFrameSize:_CGSizeMake(_CGRectGetWidth([<span class="keyword">self</span> frame]), _CGRectGetHeight([_headerView frame]))];
<a name="l01990"></a>01990 }
<a name="l01991"></a>01991 
<a name="l01992"></a><a class="code" href="class_c_p_table_view.html#afa602354d5faf24cf16734c4aa52beec">01992</a> - (CGRect)exposedClipRect
<a name="l01993"></a>01993 {
<a name="l01994"></a>01994     var superview = [<span class="keyword">self</span> superview];
<a name="l01995"></a>01995 
<a name="l01996"></a>01996     <span class="keywordflow">if</span> (![superview isKindOfClass:[<a class="code" href="class_c_p_clip_view.html">CPClipView</a> <span class="keyword">class</span>]])
<a name="l01997"></a>01997         <span class="keywordflow">return</span> [<span class="keyword">self</span> bounds];
<a name="l01998"></a>01998 
<a name="l01999"></a>01999     <span class="keywordflow">return</span> [<span class="keyword">self</span> convertRect:CGRectIntersection([superview bounds], [<span class="keyword">self</span> frame]) fromView:superview];
<a name="l02000"></a>02000 }
<a name="l02001"></a>02001 
<a name="l02002"></a>02002 - (void)_drawRect:(CGRect)aRect
<a name="l02003"></a>02003 {   
<a name="l02004"></a>02004     <span class="comment">// FIX ME: All three of these methods will likely need to be rewritten for 1.0</span>
<a name="l02005"></a>02005     <span class="comment">// We&#39;ve got grid drawing in highlightSelection and crap everywhere.</span>
<a name="l02006"></a>02006     
<a name="l02007"></a>02007     var exposedRect = [<span class="keyword">self</span> _exposedRect];
<a name="l02008"></a>02008 
<a name="l02009"></a>02009     [<span class="keyword">self</span> drawBackgroundInClipRect:exposedRect];
<a name="l02010"></a>02010     [<span class="keyword">self</span> drawGridInClipRect:exposedRect];
<a name="l02011"></a>02011     [<span class="keyword">self</span> highlightSelectionInClipRect:exposedRect];
<a name="l02012"></a>02012 }
<a name="l02013"></a>02013 
<a name="l02014"></a><a class="code" href="class_c_p_table_view.html#a41afac4cdd07690faf2500f0b3cd123b">02014</a> - (void)drawBackgroundInClipRect:(CGRect)aRect
<a name="l02015"></a>02015 {
<a name="l02016"></a>02016     <span class="keywordflow">if</span> (![<span class="keyword">self</span> usesAlternatingRowBackgroundColors])
<a name="l02017"></a>02017         <span class="keywordflow">return</span>;
<a name="l02018"></a>02018 
<a name="l02019"></a>02019     var rowColors = [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#aa31301940f52f185b7905f89a17e9bc1">alternatingRowBackgroundColors</a>],
<a name="l02020"></a>02020         colorCount = [rowColors count];
<a name="l02021"></a>02021 
<a name="l02022"></a>02022     <span class="keywordflow">if</span> (colorCount === 0)
<a name="l02023"></a>02023         <span class="keywordflow">return</span>;
<a name="l02024"></a>02024 
<a name="l02025"></a>02025     var context = [[<a class="code" href="class_c_p_graphics_context.html">CPGraphicsContext</a> <a class="code" href="class_c_p_graphics_context.html#a378dafc8fb951053dd6877fb45e87f61">currentContext</a>] <a class="code" href="class_c_p_graphics_context.html#a92895bd939c04da463d02425bec83f0b">graphicsPort</a>];
<a name="l02026"></a>02026 
<a name="l02027"></a>02027     <span class="keywordflow">if</span> (colorCount === 1)
<a name="l02028"></a>02028     {
<a name="l02029"></a>02029         <a class="code" href="group__coregraphics.html#ga800a3e5b0c46359d28b091376630bb0e">CGContextSetFillColor</a>(context, rowColors[0]);
<a name="l02030"></a>02030         <a class="code" href="group__coregraphics.html#ga74c13e165c00cc434a54bb8c2148e1ba">CGContextFillRect</a>(context, aRect);
<a name="l02031"></a>02031 
<a name="l02032"></a>02032         <span class="keywordflow">return</span>;
<a name="l02033"></a>02033     }
<a name="l02034"></a>02034     <span class="comment">// CGContextFillRect(context, CGRectIntersection(aRect, fillRect));</span>
<a name="l02035"></a>02035     <span class="comment">// console.profile(&quot;row-paint&quot;);</span>
<a name="l02036"></a>02036     var exposedRows = [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#a7d9128a2f32c6714364d5217894daa44">rowsInRect</a>:aRect],
<a name="l02037"></a>02037         firstRow = exposedRows.location,
<a name="l02038"></a>02038         lastRow = CPMaxRange(exposedRows) - 1,
<a name="l02039"></a>02039         colorIndex = MIN(exposedRows.length, colorCount),
<a name="l02040"></a>02040         heightFilled = 0.0;
<a name="l02041"></a>02041 
<a name="l02042"></a>02042     <span class="keywordflow">while</span> (colorIndex--)
<a name="l02043"></a>02043     {
<a name="l02044"></a>02044         var row = firstRow - firstRow % colorCount + colorIndex,
<a name="l02045"></a>02045             fillRect = nil;
<a name="l02046"></a>02046 
<a name="l02047"></a>02047         <a class="code" href="group__coregraphics.html#ga02cca9368e5aacc0bef423d724635376">CGContextBeginPath</a>(context);
<a name="l02048"></a>02048 
<a name="l02049"></a>02049         <span class="keywordflow">for</span> (; row &lt;= lastRow; row += colorCount)
<a name="l02050"></a>02050             <span class="keywordflow">if</span> (row &gt;= firstRow)
<a name="l02051"></a>02051                 <a class="code" href="group__coregraphics.html#ga63142912cf5a80c8c72c29d55cd7f730">CGContextAddRect</a>(context, <a class="code" href="group__appkit.html#gaa7d357ddb0a9100773cb092dd14a243f">CGRectIntersection</a>(aRect, fillRect = [<span class="keyword">self</span> rectOfRow:row]));
<a name="l02052"></a>02052 
<a name="l02053"></a>02053         <span class="keywordflow">if</span> (row - colorCount === lastRow)
<a name="l02054"></a>02054             heightFilled = _CGRectGetMaxY(fillRect);
<a name="l02055"></a>02055 
<a name="l02056"></a>02056         <a class="code" href="group__coregraphics.html#gaaf20d10c7501084913e6fdee367f3efa">CGContextClosePath</a>(context);
<a name="l02057"></a>02057 
<a name="l02058"></a>02058         <a class="code" href="group__coregraphics.html#ga800a3e5b0c46359d28b091376630bb0e">CGContextSetFillColor</a>(context, rowColors[colorIndex]);
<a name="l02059"></a>02059         <a class="code" href="group__coregraphics.html#ga5619db65db539d72c1ab275d1d5f54a1">CGContextFillPath</a>(context);
<a name="l02060"></a>02060     }
<a name="l02061"></a>02061     <span class="comment">// console.profileEnd(&quot;row-paint&quot;);</span>
<a name="l02062"></a>02062 
<a name="l02063"></a>02063     var totalHeight = _CGRectGetMaxY(aRect);
<a name="l02064"></a>02064 
<a name="l02065"></a>02065     <span class="keywordflow">if</span> (heightFilled &gt;= totalHeight || _rowHeight &lt;= 0.0)
<a name="l02066"></a>02066         <span class="keywordflow">return</span>;
<a name="l02067"></a>02067 
<a name="l02068"></a>02068     var rowHeight = _rowHeight + _intercellSpacing.height,
<a name="l02069"></a>02069         fillRect = _CGRectMake(_CGRectGetMinX(aRect), _CGRectGetMinY(aRect) + heightFilled, _CGRectGetWidth(aRect), rowHeight);
<a name="l02070"></a>02070 
<a name="l02071"></a>02071     <span class="keywordflow">for</span> (row = lastRow + 1; heightFilled &lt; totalHeight; ++row)
<a name="l02072"></a>02072     {
<a name="l02073"></a>02073         <a class="code" href="group__coregraphics.html#ga800a3e5b0c46359d28b091376630bb0e">CGContextSetFillColor</a>(context, rowColors[row % colorCount]);
<a name="l02074"></a>02074         <a class="code" href="group__coregraphics.html#ga74c13e165c00cc434a54bb8c2148e1ba">CGContextFillRect</a>(context, fillRect);
<a name="l02075"></a>02075 
<a name="l02076"></a>02076         heightFilled += rowHeight;
<a name="l02077"></a>02077         fillRect.origin.y += rowHeight;
<a name="l02078"></a>02078     }
<a name="l02079"></a>02079 }
<a name="l02080"></a>02080 
<a name="l02081"></a><a class="code" href="class_c_p_table_view.html#adf388c00db8e69dee3bb1e60e2df0203">02081</a> - (void)drawGridInClipRect:(CGRect)aRect
<a name="l02082"></a>02082 {
<a name="l02083"></a>02083     var context = [[<a class="code" href="class_c_p_graphics_context.html">CPGraphicsContext</a> <a class="code" href="class_c_p_graphics_context.html#a378dafc8fb951053dd6877fb45e87f61">currentContext</a>] <a class="code" href="class_c_p_graphics_context.html#a92895bd939c04da463d02425bec83f0b">graphicsPort</a>],
<a name="l02084"></a>02084         gridStyleMask = [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#a9b133d62d7aba9a887f38e686627e160">gridStyleMask</a>];
<a name="l02085"></a>02085 
<a name="l02086"></a>02086     <span class="keywordflow">if</span> (!(gridStyleMask &amp; (<a class="code" href="_c_p_table_view_8j.html#acc262027919f5d8fa9961299c57e4887">CPTableViewSolidHorizontalGridLineMask</a> | <a class="code" href="_c_p_table_view_8j.html#af147002e8b12fcaf12a2df975edb95b5">CPTableViewSolidVerticalGridLineMask</a>)))
<a name="l02087"></a>02087         <span class="keywordflow">return</span>;
<a name="l02088"></a>02088 
<a name="l02089"></a>02089     <a class="code" href="group__coregraphics.html#ga02cca9368e5aacc0bef423d724635376">CGContextBeginPath</a>(context);
<a name="l02090"></a>02090 
<a name="l02091"></a>02091     <span class="keywordflow">if</span> (gridStyleMask &amp; <a class="code" href="_c_p_table_view_8j.html#acc262027919f5d8fa9961299c57e4887">CPTableViewSolidHorizontalGridLineMask</a>)
<a name="l02092"></a>02092     {
<a name="l02093"></a>02093         var exposedRows = [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#a7d9128a2f32c6714364d5217894daa44">rowsInRect</a>:aRect];
<a name="l02094"></a>02094             row = exposedRows.location,
<a name="l02095"></a>02095             lastRow = CPMaxRange(exposedRows) - 1,
<a name="l02096"></a>02096             rowY = 0.0,
<a name="l02097"></a>02097             minX = _CGRectGetMinX(aRect),
<a name="l02098"></a>02098             maxX = _CGRectGetMaxX(aRect);
<a name="l02099"></a>02099 
<a name="l02100"></a>02100         <span class="keywordflow">for</span> (; row &lt;= lastRow; ++row)
<a name="l02101"></a>02101         {
<a name="l02102"></a>02102             <span class="comment">// grab each row rect and add the top and bottom lines</span>
<a name="l02103"></a>02103             var rowRect = [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#abdf1f5cc725acaf6d5734cc535bc8a22">rectOfRow</a>:row],
<a name="l02104"></a>02104                 rowY = _CGRectGetMaxY(rowRect) - 0.5;
<a name="l02105"></a>02105 
<a name="l02106"></a>02106             <a class="code" href="group__coregraphics.html#ga44dc04bb1efb98ff834308c997d10dc5">CGContextMoveToPoint</a>(context, minX, rowY);
<a name="l02107"></a>02107             <a class="code" href="group__coregraphics.html#ga834b9d5848989453730d162f251a29c3">CGContextAddLineToPoint</a>(context, maxX, rowY);
<a name="l02108"></a>02108         }
<a name="l02109"></a>02109 
<a name="l02110"></a>02110         <span class="keywordflow">if</span> (_rowHeight &gt; 0.0)
<a name="l02111"></a>02111         {
<a name="l02112"></a>02112             var rowHeight = _rowHeight + _intercellSpacing.height,
<a name="l02113"></a>02113                 totalHeight = _CGRectGetMaxY(aRect);
<a name="l02114"></a>02114 
<a name="l02115"></a>02115             <span class="keywordflow">while</span> (rowY &lt; totalHeight)
<a name="l02116"></a>02116             {
<a name="l02117"></a>02117                 rowY += rowHeight;
<a name="l02118"></a>02118 
<a name="l02119"></a>02119                 <a class="code" href="group__coregraphics.html#ga44dc04bb1efb98ff834308c997d10dc5">CGContextMoveToPoint</a>(context, minX, rowY);
<a name="l02120"></a>02120                 <a class="code" href="group__coregraphics.html#ga834b9d5848989453730d162f251a29c3">CGContextAddLineToPoint</a>(context, maxX, rowY);
<a name="l02121"></a>02121             }
<a name="l02122"></a>02122         }
<a name="l02123"></a>02123     }
<a name="l02124"></a>02124 
<a name="l02125"></a>02125     <span class="keywordflow">if</span> (gridStyleMask &amp; <a class="code" href="_c_p_table_view_8j.html#af147002e8b12fcaf12a2df975edb95b5">CPTableViewSolidVerticalGridLineMask</a>)
<a name="l02126"></a>02126     {
<a name="l02127"></a>02127         var exposedColumnIndexes = [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#a1acdacf678fb91a541b692d378586289">columnIndexesInRect</a>:aRect],
<a name="l02128"></a>02128             columnsArray = [];
<a name="l02129"></a>02129 
<a name="l02130"></a>02130         [exposedColumnIndexes getIndexes:columnsArray maxCount:-1 inIndexRange:nil];
<a name="l02131"></a>02131 
<a name="l02132"></a>02132         var columnArrayIndex = 0,
<a name="l02133"></a>02133             columnArrayCount = columnsArray.length,
<a name="l02134"></a>02134             minY = _CGRectGetMinY(aRect),
<a name="l02135"></a>02135             maxY = _CGRectGetMaxY(aRect);
<a name="l02136"></a>02136 
<a name="l02137"></a>02137 
<a name="l02138"></a>02138         <span class="keywordflow">for</span> (; columnArrayIndex &lt; columnArrayCount; ++columnArrayIndex)
<a name="l02139"></a>02139         {
<a name="l02140"></a>02140             var columnRect = [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#af86aacec5d36506c1fee17f1fab5803f">rectOfColumn</a>:columnsArray[columnArrayIndex]],
<a name="l02141"></a>02141                 columnX = _CGRectGetMaxX(columnRect) + 0.5;
<a name="l02142"></a>02142 
<a name="l02143"></a>02143             <a class="code" href="group__coregraphics.html#ga44dc04bb1efb98ff834308c997d10dc5">CGContextMoveToPoint</a>(context, columnX, minY);
<a name="l02144"></a>02144             <a class="code" href="group__coregraphics.html#ga834b9d5848989453730d162f251a29c3">CGContextAddLineToPoint</a>(context, columnX, maxY);
<a name="l02145"></a>02145         }
<a name="l02146"></a>02146     }
<a name="l02147"></a>02147 
<a name="l02148"></a>02148     <a class="code" href="group__coregraphics.html#gaaf20d10c7501084913e6fdee367f3efa">CGContextClosePath</a>(context);
<a name="l02149"></a>02149     <a class="code" href="group__coregraphics.html#gac13f17a8bed76d16b9e5252106d196e0">CGContextSetStrokeColor</a>(context, _gridColor);
<a name="l02150"></a>02150     <a class="code" href="group__coregraphics.html#ga03bda4b6dc1763d22d122d565e027012">CGContextStrokePath</a>(context);
<a name="l02151"></a>02151 }
<a name="l02152"></a>02152 
<a name="l02153"></a>02153 
<a name="l02154"></a><a class="code" href="class_c_p_table_view.html#a0c0337c6cc26dff4a0f656e889f21fae">02154</a> - (void)highlightSelectionInClipRect:(CGRect)aRect
<a name="l02155"></a>02155 {
<a name="l02156"></a>02156     <span class="comment">// FIXME: This color thingy is terrible probably.</span>
<a name="l02157"></a>02157     <span class="keywordflow">if</span> ([<span class="keyword">self</span> selectionHighlightStyle] === <a class="code" href="_c_p_table_view_8j.html#a9b1494c16eb023b6a546dc0fb584fce7">CPTableViewSelectionHighlightStyleSourceList</a>)
<a name="l02158"></a>02158         [[<a class="code" href="class_c_p_color.html">CPColor</a> <a class="code" href="class_c_p_color.html#a1226e56d2ace061bd057253bcb8a26f6">selectionColorSourceView</a>] setFill];
<a name="l02159"></a>02159     <span class="keywordflow">else</span>
<a name="l02160"></a>02160        [[<a class="code" href="class_c_p_color.html">CPColor</a> <a class="code" href="class_c_p_color.html#a3c17f4544abd947afd5d30d7c240c378">selectionColor</a>] setFill];
<a name="l02161"></a>02161 
<a name="l02162"></a>02162     var context = [[<a class="code" href="class_c_p_graphics_context.html">CPGraphicsContext</a> <a class="code" href="class_c_p_graphics_context.html#a378dafc8fb951053dd6877fb45e87f61">currentContext</a>] <a class="code" href="class_c_p_graphics_context.html#a92895bd939c04da463d02425bec83f0b">graphicsPort</a>],
<a name="l02163"></a>02163         indexes = [],
<a name="l02164"></a>02164         rectSelector = <span class="keyword">@selector</span>(rectOfRow:);
<a name="l02165"></a>02165 
<a name="l02166"></a>02166        [_selectionHightlightColor setFill];
<a name="l02167"></a>02167 
<a name="l02168"></a>02168 
<a name="l02169"></a>02169     <span class="keywordflow">if</span> ([_selectedRowIndexes count] &gt;= 1)
<a name="l02170"></a>02170     {
<a name="l02171"></a>02171         var exposedRows = [<a class="code" href="class_c_p_index_set.html">CPIndexSet</a> indexSetWithIndexesInRange:[<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#a7d9128a2f32c6714364d5217894daa44">rowsInRect</a>:aRect]],
<a name="l02172"></a>02172             firstRow = [exposedRows firstIndex],
<a name="l02173"></a>02173             exposedRange = CPMakeRange(firstRow, [exposedRows lastIndex] - firstRow + 1);
<a name="l02174"></a>02174 
<a name="l02175"></a>02175         [_selectedRowIndexes getIndexes:indexes maxCount:-1 inIndexRange:exposedRange];
<a name="l02176"></a>02176     }
<a name="l02177"></a>02177 
<a name="l02178"></a>02178     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ([_selectedColumnIndexes count] &gt;= 1)
<a name="l02179"></a>02179     {
<a name="l02180"></a>02180         rectSelector = <span class="keyword">@selector</span>(rectOfColumn:);
<a name="l02181"></a>02181 
<a name="l02182"></a>02182         var exposedColumns = [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#a1acdacf678fb91a541b692d378586289">columnIndexesInRect</a>:aRect],
<a name="l02183"></a>02183             firstColumn = [exposedColumns firstIndex],
<a name="l02184"></a>02184             exposedRange = CPMakeRange(firstColumn, [exposedColumns lastIndex] - firstColumn + 1);
<a name="l02185"></a>02185 
<a name="l02186"></a>02186         [_selectedColumnIndexes getIndexes:indexes maxCount:-1 inIndexRange:exposedRange];
<a name="l02187"></a>02187     }
<a name="l02188"></a>02188 
<a name="l02189"></a>02189     var count = [indexes count];
<a name="l02190"></a>02190 
<a name="l02191"></a>02191     <span class="keywordflow">if</span> (!count)
<a name="l02192"></a>02192         <span class="keywordflow">return</span>;
<a name="l02193"></a>02193 
<a name="l02194"></a>02194     var count2 = count;
<a name="l02195"></a>02195 
<a name="l02196"></a>02196     <a class="code" href="group__coregraphics.html#ga02cca9368e5aacc0bef423d724635376">CGContextBeginPath</a>(context);
<a name="l02197"></a>02197 
<a name="l02198"></a>02198     <span class="keywordflow">while</span> (count--)
<a name="l02199"></a>02199         <a class="code" href="group__coregraphics.html#ga63142912cf5a80c8c72c29d55cd7f730">CGContextAddRect</a>(context, <a class="code" href="group__appkit.html#gaa7d357ddb0a9100773cb092dd14a243f">CGRectIntersection</a>(objj_msgSend(<span class="keyword">self</span>, rectSelector, indexes[count]), aRect));
<a name="l02200"></a>02200 
<a name="l02201"></a>02201     <a class="code" href="group__coregraphics.html#gaaf20d10c7501084913e6fdee367f3efa">CGContextClosePath</a>(context);
<a name="l02202"></a>02202     <a class="code" href="group__coregraphics.html#ga5619db65db539d72c1ab275d1d5f54a1">CGContextFillPath</a>(context);
<a name="l02203"></a>02203 
<a name="l02204"></a>02204     <a class="code" href="group__coregraphics.html#ga02cca9368e5aacc0bef423d724635376">CGContextBeginPath</a>(context);
<a name="l02205"></a>02205     gridStyleMask = [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#a9b133d62d7aba9a887f38e686627e160">gridStyleMask</a>];
<a name="l02206"></a>02206     <span class="keywordflow">for</span>(var i=0; i &lt; count2; i++)
<a name="l02207"></a>02207     {
<a name="l02208"></a>02208          var rect = objj_msgSend(<span class="keyword">self</span>, rectSelector, indexes[i]),
<a name="l02209"></a>02209              minX = <a class="code" href="_c_g_geometry_8j.html#a7c1a8fe081097d577b441f6b7b553421">CGRectGetMinX</a>(rect) - 0.5,
<a name="l02210"></a>02210              maxX = <a class="code" href="_c_g_geometry_8j.html#af3a2c4d8cf973ee27fb86b6ed74497cc">CGRectGetMaxX</a>(rect) - 0.5,
<a name="l02211"></a>02211              minY = <a class="code" href="_c_g_geometry_8j.html#a9408ba6b0750742be8d630f59a3d4669">CGRectGetMinY</a>(rect) - 0.5,
<a name="l02212"></a>02212              maxY = <a class="code" href="_c_g_geometry_8j.html#ab0a24500a256a6e58aab6ae4f19d7a77">CGRectGetMaxY</a>(rect) - 0.5;
<a name="l02213"></a>02213 
<a name="l02214"></a>02214         <span class="keywordflow">if</span> ([_selectedRowIndexes count] &gt;= 1 &amp;&amp; gridStyleMask &amp; <a class="code" href="_c_p_table_view_8j.html#af147002e8b12fcaf12a2df975edb95b5">CPTableViewSolidVerticalGridLineMask</a>)
<a name="l02215"></a>02215         {
<a name="l02216"></a>02216             var exposedColumns = [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#a1acdacf678fb91a541b692d378586289">columnIndexesInRect</a>:aRect],
<a name="l02217"></a>02217             exposedColumnIndexes = [],
<a name="l02218"></a>02218             firstExposedColumn = [exposedColumns firstIndex],
<a name="l02219"></a>02219             exposedRange = CPMakeRange(firstExposedColumn, [exposedColumns lastIndex] - firstExposedColumn + 1);
<a name="l02220"></a>02220             [exposedColumns getIndexes:exposedColumnIndexes maxCount:-1 inIndexRange:exposedRange];
<a name="l02221"></a>02221             var exposedColumnCount = [exposedColumnIndexes count];
<a name="l02222"></a>02222             
<a name="l02223"></a>02223             <span class="keywordflow">for</span>(var c = firstExposedColumn; c &lt; exposedColumnCount; c++)
<a name="l02224"></a>02224             {
<a name="l02225"></a>02225                 <span class="comment">//console.log(columnIndexes);</span>
<a name="l02226"></a>02226                 var colRect = [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#af86aacec5d36506c1fee17f1fab5803f">rectOfColumn</a>:exposedColumnIndexes[c]],
<a name="l02227"></a>02227                     colX = <a class="code" href="_c_g_geometry_8j.html#af3a2c4d8cf973ee27fb86b6ed74497cc">CGRectGetMaxX</a>(colRect) + 0.5;
<a name="l02228"></a>02228                 <span class="comment">//console.log(colX);</span>
<a name="l02229"></a>02229                 <a class="code" href="group__coregraphics.html#ga44dc04bb1efb98ff834308c997d10dc5">CGContextMoveToPoint</a>(context, colX, minY);
<a name="l02230"></a>02230                 <a class="code" href="group__coregraphics.html#ga834b9d5848989453730d162f251a29c3">CGContextAddLineToPoint</a>(context, colX, maxY);
<a name="l02231"></a>02231             }
<a name="l02232"></a>02232 
<a name="l02233"></a>02233         }
<a name="l02234"></a>02234         
<a name="l02235"></a>02235         <span class="comment">//if the row after the current row is not selected then there is no need to draw the bottom grid line white.</span>
<a name="l02236"></a>02236         <span class="keywordflow">if</span>([indexes containsObject:indexes[i]+1])
<a name="l02237"></a>02237         {
<a name="l02238"></a>02238             <a class="code" href="group__coregraphics.html#ga44dc04bb1efb98ff834308c997d10dc5">CGContextMoveToPoint</a>(context, minX, maxY);
<a name="l02239"></a>02239             <a class="code" href="group__coregraphics.html#ga834b9d5848989453730d162f251a29c3">CGContextAddLineToPoint</a>(context, maxX, maxY);
<a name="l02240"></a>02240         }
<a name="l02241"></a>02241     }
<a name="l02242"></a>02242 
<a name="l02243"></a>02243     <a class="code" href="group__coregraphics.html#gaaf20d10c7501084913e6fdee367f3efa">CGContextClosePath</a>(context);
<a name="l02244"></a>02244     <a class="code" href="group__coregraphics.html#gac13f17a8bed76d16b9e5252106d196e0">CGContextSetStrokeColor</a>(context, [<a class="code" href="class_c_p_color.html">CPColor</a> colorWithHexString:<span class="stringliteral">@&quot;e5e5e5&quot;</span>]);
<a name="l02245"></a>02245     <a class="code" href="group__coregraphics.html#ga03bda4b6dc1763d22d122d565e027012">CGContextStrokePath</a>(context);
<a name="l02246"></a>02246 }
<a name="l02247"></a>02247 
<a name="l02248"></a><a class="code" href="class_c_p_table_view.html#a37955da775ea839340abc7bea7bd9fd1">02248</a> - (void)layoutSubviews
<a name="l02249"></a>02249 {
<a name="l02250"></a>02250     [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#a7dc6ff16b80a132f5bb7aa3dbaa16e50">load</a>];
<a name="l02251"></a>02251 }
<a name="l02252"></a>02252 
<a name="l02253"></a><a class="code" href="class_c_p_table_view.html#a7a71c5e32d14791d19693f9a87d88491">02253</a> - (void)viewWillMoveToSuperview:(<a class="code" href="class_c_p_view.html">CPView</a>)aView
<a name="l02254"></a>02254 {
<a name="l02255"></a>02255     var superview = [<span class="keyword">self</span> superview],
<a name="l02256"></a>02256         defaultCenter = [CPNotificationCenter defaultCenter];
<a name="l02257"></a>02257 
<a name="l02258"></a>02258     <span class="keywordflow">if</span> (superview)
<a name="l02259"></a>02259     {
<a name="l02260"></a>02260         [defaultCenter
<a name="l02261"></a>02261             removeObserver:self
<a name="l02262"></a>02262                       name:CPViewFrameDidChangeNotification
<a name="l02263"></a>02263                     object:superview];
<a name="l02264"></a>02264 
<a name="l02265"></a>02265         [defaultCenter
<a name="l02266"></a>02266             removeObserver:self
<a name="l02267"></a>02267                       name:CPViewBoundsDidChangeNotification
<a name="l02268"></a>02268                     object:superview];
<a name="l02269"></a>02269     }
<a name="l02270"></a>02270 
<a name="l02271"></a>02271     <span class="keywordflow">if</span> (aView)
<a name="l02272"></a>02272     {
<a name="l02273"></a>02273         [aView <a class="code" href="class_c_p_view.html#a1e2e604070ac86b98b610bde11488eb9">setPostsFrameChangedNotifications</a>:YES];
<a name="l02274"></a>02274         [aView <a class="code" href="class_c_p_view.html#a4cac5dff2634c55e643412707b514d53">setPostsBoundsChangedNotifications</a>:YES];
<a name="l02275"></a>02275 
<a name="l02276"></a>02276         [defaultCenter
<a name="l02277"></a>02277             addObserver:self
<a name="l02278"></a>02278                selector:@selector(superviewFrameChanged:)
<a name="l02279"></a>02279                    name:CPViewFrameDidChangeNotification
<a name="l02280"></a>02280                  object:aView];
<a name="l02281"></a>02281 
<a name="l02282"></a>02282         [defaultCenter
<a name="l02283"></a>02283             addObserver:self
<a name="l02284"></a>02284                selector:@selector(superviewBoundsChanged:)
<a name="l02285"></a>02285                    name:CPViewBoundsDidChangeNotification
<a name="l02286"></a>02286                  object:aView];
<a name="l02287"></a>02287     }
<a name="l02288"></a>02288 }
<a name="l02289"></a>02289 
<a name="l02290"></a><a class="code" href="class_c_p_table_view.html#abe4f0984deafc23e6ae4e952155e75f4">02290</a> - (void)superviewBoundsChanged:(CPNotification)aNotification
<a name="l02291"></a>02291 {
<a name="l02292"></a>02292     [<span class="keyword">self</span> setNeedsDisplay:YES];
<a name="l02293"></a>02293     [<span class="keyword">self</span> setNeedsLayout];
<a name="l02294"></a>02294 }
<a name="l02295"></a>02295 
<a name="l02296"></a><a class="code" href="class_c_p_table_view.html#a95d81bc03909fd8aa1c2ace4c5a81285">02296</a> - (void)superviewFrameChanged:(CPNotification)aNotification
<a name="l02297"></a>02297 {
<a name="l02298"></a>02298     [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#af2af4f3cd8a4020f17c25c64548051ea">tile</a>];
<a name="l02299"></a>02299 }
<a name="l02300"></a>02300 
<a name="l02301"></a>02301 <span class="comment">//</span>
<a name="l02302"></a>02302 
<a name="l02303"></a>02303 <span class="comment">/*</span>
<a name="l02304"></a>02304 <span class="comment">    var type = [anEvent type],</span>
<a name="l02305"></a>02305 <span class="comment">        point = [self convertPoint:[anEvent locationInWindow] fromView:nil],</span>
<a name="l02306"></a>02306 <span class="comment">        currentRow = MAX(0, MIN(_numberOfRows-1, [self _rowAtY:point.y]));</span>
<a name="l02307"></a>02307 <span class="comment"></span>
<a name="l02308"></a>02308 <span class="comment">*/</span>
<a name="l02309"></a>02309 
<a name="l02310"></a>02310 <span class="comment">/*</span>
<a name="l02311"></a>02311 <span class="comment">    @ignore</span>
<a name="l02312"></a>02312 <span class="comment">*/</span>
<a name="l02313"></a><a class="code" href="class_c_p_table_view.html#a1f7e3a786ba3254260371678d08d0abf">02313</a> - (BOOL)tracksMouseOutsideOfFrame
<a name="l02314"></a>02314 {
<a name="l02315"></a>02315     <span class="keywordflow">return</span> YES;
<a name="l02316"></a>02316 }
<a name="l02317"></a>02317 
<a name="l02318"></a>02318 <span class="comment">/*</span>
<a name="l02319"></a>02319 <span class="comment">    @ignore</span>
<a name="l02320"></a>02320 <span class="comment">*/</span>
<a name="l02321"></a><a class="code" href="class_c_p_table_view.html#abbf2e419712fbe7887c2660c1b6a8370">02321</a> - (BOOL)startTrackingAt:(CGPoint)aPoint
<a name="l02322"></a>02322 {
<a name="l02323"></a>02323     var row = [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#a6f1d4aad7598b4ca189e2a262d51cd08">rowAtPoint</a>:aPoint];
<a name="l02324"></a>02324 
<a name="l02325"></a>02325     <span class="comment">//if the user clicks outside a row then deslect everything</span>
<a name="l02326"></a>02326     <span class="keywordflow">if</span> (row &lt; 0 &amp;&amp; _allowsEmptySelection)
<a name="l02327"></a>02327         [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#a9b6204a962c90a046897dce505fec408">selectRowIndexes</a>:[<a class="code" href="class_c_p_index_set.html">CPIndexSet</a> indexSet] <a class="code" href="class_c_p_table_view.html#a9b6204a962c90a046897dce505fec408">byExtendingSelection</a>:NO];
<a name="l02328"></a>02328 
<a name="l02329"></a>02329     [<span class="keyword">self</span> _noteSelectionIsChanging];
<a name="l02330"></a>02330 
<a name="l02331"></a>02331     <span class="keywordflow">if</span> ([<span class="keyword">self</span> mouseDownFlags] &amp; <a class="code" href="_c_p_event_8j.html#a2343191b34b38dc1952bb44d83fa30d6">CPShiftKeyMask</a>)
<a name="l02332"></a>02332         _selectionAnchorRow = (ABS([_selectedRowIndexes firstIndex] - row) &lt; ABS([_selectedRowIndexes lastIndex] - row)) ?
<a name="l02333"></a>02333             [_selectedRowIndexes firstIndex] : [_selectedRowIndexes lastIndex];
<a name="l02334"></a>02334     <span class="keywordflow">else</span>
<a name="l02335"></a>02335         _selectionAnchorRow = row;
<a name="l02336"></a>02336 
<a name="l02337"></a>02337         
<a name="l02338"></a>02338     <span class="comment">//set ivars for startTrackingPoint and time...    </span>
<a name="l02339"></a>02339     _startTrackingPoint = aPoint; 
<a name="l02340"></a>02340     _startTrackingTimestamp = <span class="keyword">new</span> Date();
<a name="l02341"></a>02341 
<a name="l02342"></a>02342     <span class="keywordflow">if</span> (_implementedDataSourceMethods &amp; <a class="code" href="_c_p_table_view_8j.html#a9f25c28df39dca590ad108beb6b4b48b">CPTableViewDataSource_tableView_setObjectValue_forTableColumn_row_</a>)
<a name="l02343"></a>02343         _trackingPointMovedOutOfClickSlop = NO;
<a name="l02344"></a>02344 
<a name="l02345"></a>02345     <span class="comment">// if the table has drag support then we use mouseUp to select a single row.</span>
<a name="l02346"></a>02346     <span class="comment">// otherwise it uses mouse down.</span>
<a name="l02347"></a>02347     <span class="keywordflow">if</span> (!(_implementedDataSourceMethods &amp; <a class="code" href="_c_p_table_view_8j.html#a3fb0a731ef8cca0484830f426bcbe81f">CPTableViewDataSource_tableView_writeRowsWithIndexes_toPasteboard_</a>))
<a name="l02348"></a>02348         [<span class="keyword">self</span> _updateSelectionWithMouseAtRow:row];
<a name="l02349"></a>02349 
<a name="l02350"></a>02350     [[<span class="keyword">self</span> window] makeFirstResponder:self];
<a name="l02351"></a>02351     <span class="keywordflow">return</span> YES;
<a name="l02352"></a>02352 }
<a name="l02353"></a>02353 
<a name="l02354"></a>02354 <span class="comment">/*</span>
<a name="l02355"></a>02355 <span class="comment">    @ignore</span>
<a name="l02356"></a>02356 <span class="comment">*/</span>
<a name="l02357"></a><a class="code" href="class_c_p_table_view.html#adbef7bbed471e4c00409a0931612ac33">02357</a> - (void)trackMouse:(<a class="code" href="class_c_p_event.html">CPEvent</a>)anEvent
<a name="l02358"></a>02358 {
<a name="l02359"></a>02359     <span class="comment">// Prevent CPControl from eating the mouse events when we are in a drag session</span>
<a name="l02360"></a>02360     <span class="keywordflow">if</span> (![_draggedRowIndexes count])
<a name="l02361"></a>02361         [<span class="keyword">super</span> trackMouse:anEvent];
<a name="l02362"></a>02362     <span class="keywordflow">else</span>
<a name="l02363"></a>02363         [CPApp sendEvent:anEvent];
<a name="l02364"></a>02364 }
<a name="l02365"></a>02365 
<a name="l02366"></a>02366 <span class="comment">/*</span>
<a name="l02367"></a>02367 <span class="comment">    @ignore</span>
<a name="l02368"></a>02368 <span class="comment">*/</span>
<a name="l02369"></a><a class="code" href="class_c_p_table_view.html#a76f737f3ee5a3cae63075c13d8ac3496">02369</a> - (BOOL)continueTracking:(CGPoint)lastPoint at:(CGPoint)aPoint
<a name="l02370"></a>02370 {
<a name="l02371"></a>02371     var row = [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#a6f1d4aad7598b4ca189e2a262d51cd08">rowAtPoint</a>:aPoint];
<a name="l02372"></a>02372     <span class="comment">// begin the drag is the datasource lets us, we&#39;ve move at least +-3px vertical or horizontal, or we&#39;re dragging from selected rows and we haven&#39;t begun a drag session</span>
<a name="l02373"></a>02373     <span class="keywordflow">if</span>(!_isSelectingSession &amp;&amp; _implementedDataSourceMethods &amp; <a class="code" href="_c_p_table_view_8j.html#a3fb0a731ef8cca0484830f426bcbe81f">CPTableViewDataSource_tableView_writeRowsWithIndexes_toPasteboard_</a>)
<a name="l02374"></a>02374     {
<a name="l02375"></a>02375         <span class="keywordflow">if</span> (
<a name="l02376"></a>02376                 (ABS(_startTrackingPoint.x - aPoint.x) &gt; 4 || (_verticalMotionCanDrag &amp;&amp; ABS(_startTrackingPoint.y - aPoint.y) &gt; 4)) || 
<a name="l02377"></a>02377                 ([_selectedRowIndexes containsIndex:row])
<a name="l02378"></a>02378            )
<a name="l02379"></a>02379         {
<a name="l02380"></a>02380                 <span class="keywordflow">if</span> ([_selectedRowIndexes containsIndex:row])
<a name="l02381"></a>02381                     _draggedRowIndexes = [[<a class="code" href="class_c_p_index_set.html">CPIndexSet</a> alloc] initWithIndexSet:_selectedRowIndexes];
<a name="l02382"></a>02382                 <span class="keywordflow">else</span>
<a name="l02383"></a>02383                     _draggedRowIndexes = [<a class="code" href="class_c_p_index_set.html">CPIndexSet</a> indexSetWithIndex:row];
<a name="l02384"></a>02384         
<a name="l02385"></a>02385         
<a name="l02386"></a>02386                 <span class="comment">//ask the datasource for the data</span>
<a name="l02387"></a>02387                 var pboard = [<a class="code" href="class_c_p_pasteboard.html">CPPasteboard</a> <a class="code" href="class_c_p_pasteboard.html#adc671279bc4d0608ebe421e4657ecd07">pasteboardWithName</a>:CPDragPboard];
<a name="l02388"></a>02388         
<a name="l02389"></a>02389                 <span class="keywordflow">if</span> ([<span class="keyword">self</span> canDragRowsWithIndexes:_draggedRowIndexes atPoint:aPoint] &amp;&amp; [_dataSource tableView:<span class="keyword">self</span> writeRowsWithIndexes:_draggedRowIndexes toPasteboard:pboard])
<a name="l02390"></a>02390                 {
<a name="l02391"></a>02391                     var currentEvent = [CPApp currentEvent],
<a name="l02392"></a>02392                         offset = <a class="code" href="group__appkit.html#gaf966bac39815f4926c5e7dcf7bf4c67c">CPPointMakeZero</a>(),
<a name="l02393"></a>02393                         tableColumns = [_tableColumns objectsAtIndexes:_exposedColumns];
<a name="l02394"></a>02394                         
<a name="l02395"></a>02395                     <span class="comment">// We deviate from the default Cocoa implementation here by asking for a view in stead of an image</span>
<a name="l02396"></a>02396                     <span class="comment">// We support both, but the view prefered over the image because we can mimic the rows we are dragging</span>
<a name="l02397"></a>02397                     <span class="comment">// by re-creating the data views for the dragged rows</span>
<a name="l02398"></a>02398                     var view = [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#acb389ac8e4905c13aae0b290ce7f8e37">dragViewForRowsWithIndexes</a>:_draggedRowIndexes 
<a name="l02399"></a>02399                                                    <a class="code" href="class_c_p_table_view.html#acb389ac8e4905c13aae0b290ce7f8e37">tableColumns</a>:tableColumns 
<a name="l02400"></a>02400                                                           <a class="code" href="class_c_p_table_view.html#acb389ac8e4905c13aae0b290ce7f8e37">event</a>:currentEvent 
<a name="l02401"></a>02401                                                          <a class="code" href="class_c_p_table_view.html#acb389ac8e4905c13aae0b290ce7f8e37">offset</a>:offset];
<a name="l02402"></a>02402                     
<a name="l02403"></a>02403                     <span class="keywordflow">if</span> (!view)
<a name="l02404"></a>02404                     {
<a name="l02405"></a>02405                         var image = [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#a4d762c62bdd4525f7b3a4fe6ddf38164">dragImageForRowsWithIndexes</a>:_draggedRowIndexes 
<a name="l02406"></a>02406                                                          <a class="code" href="class_c_p_table_view.html#a4d762c62bdd4525f7b3a4fe6ddf38164">tableColumns</a>:tableColumns 
<a name="l02407"></a>02407                                                                 <a class="code" href="class_c_p_table_view.html#a4d762c62bdd4525f7b3a4fe6ddf38164">event</a>:currentEvent 
<a name="l02408"></a>02408                                                                <a class="code" href="class_c_p_table_view.html#a4d762c62bdd4525f7b3a4fe6ddf38164">offset</a>:offset];
<a name="l02409"></a>02409                         view = [[<a class="code" href="class_c_p_image_view.html">CPImageView</a> alloc] initWithFrame:CPMakeRect(0, 0, [image size].width, [image size].height)];
<a name="l02410"></a>02410                         [view setImage:image];
<a name="l02411"></a>02411                     }
<a name="l02412"></a>02412                     
<a name="l02413"></a>02413                     var bounds = [view bounds];
<a name="l02414"></a>02414                     var viewLocation = <a class="code" href="group__appkit.html#gabbd24c413b418848a07ac0ce30db3f8d">CPPointMake</a>(aPoint.x - <a class="code" href="_c_g_geometry_8j.html#aa310af239f2108c573299b35776996fa">CGRectGetWidth</a>(bounds)/2 + offset.x, aPoint.y - <a class="code" href="_c_g_geometry_8j.html#a09d2072d60c7f39b04a41705d640fa98">CGRectGetHeight</a>(bounds)/2 + offset.y);
<a name="l02415"></a>02415                     [<span class="keyword">self</span> dragView:view at:viewLocation offset:CPPointMakeZero() event:[CPApp currentEvent] pasteboard:pboard source:self slideBack:YES];
<a name="l02416"></a>02416                     _startTrackingPoint = nil;
<a name="l02417"></a>02417                     
<a name="l02418"></a>02418                     <span class="keywordflow">return</span> NO;
<a name="l02419"></a>02419                 }
<a name="l02420"></a>02420         }
<a name="l02421"></a>02421         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ABS(_startTrackingPoint.x - aPoint.x) &lt; 5 &amp;&amp; ABS(_startTrackingPoint.y - aPoint.y) &lt; 5)
<a name="l02422"></a>02422             <span class="keywordflow">return</span> YES;
<a name="l02423"></a>02423     }
<a name="l02424"></a>02424 
<a name="l02425"></a>02425     _isSelectingSession = YES;
<a name="l02426"></a>02426     [<span class="keyword">self</span> _updateSelectionWithMouseAtRow:row];
<a name="l02427"></a>02427     [<span class="keyword">self</span> _updateSelectionWithMouseAtRow:[<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#a6f1d4aad7598b4ca189e2a262d51cd08">rowAtPoint</a>:aPoint]];
<a name="l02428"></a>02428 
<a name="l02429"></a>02429     <span class="keywordflow">if</span> ((_implementedDataSourceMethods &amp; <a class="code" href="_c_p_table_view_8j.html#a9f25c28df39dca590ad108beb6b4b48b">CPTableViewDataSource_tableView_setObjectValue_forTableColumn_row_</a>)
<a name="l02430"></a>02430         &amp;&amp; !_trackingPointMovedOutOfClickSlop)
<a name="l02431"></a>02431     {
<a name="l02432"></a>02432         var CLICK_SPACE_DELTA = 5.0; <span class="comment">// Stolen from AppKit/Platform/DOM/CPPlatformWindow+DOM.j</span>
<a name="l02433"></a>02433         <span class="keywordflow">if</span> (ABS(aPoint.x - _startTrackingPoint.x) &gt; CLICK_SPACE_DELTA
<a name="l02434"></a>02434             || ABS(aPoint.y - _startTrackingPoint.y) &gt; CLICK_SPACE_DELTA)
<a name="l02435"></a>02435         {
<a name="l02436"></a>02436             _trackingPointMovedOutOfClickSlop = YES;
<a name="l02437"></a>02437         }
<a name="l02438"></a>02438     }
<a name="l02439"></a>02439 
<a name="l02440"></a>02440     <span class="keywordflow">return</span> YES;
<a name="l02441"></a>02441 }
<a name="l02442"></a>02442 
<a name="l02446"></a><a class="code" href="class_c_p_table_view.html#a3b1fa54e2fd7aa107531a00790b725ed">02446</a> - (void)stopTracking:(CGPoint)lastPoint at:(CGPoint)aPoint mouseIsUp:(BOOL)mouseIsUp
<a name="l02447"></a>02447 {
<a name="l02448"></a>02448     _isSelectingSession = NO;
<a name="l02449"></a>02449 
<a name="l02450"></a>02450     var <a class="code" href="_c_p_platform_window_09_d_o_m_8j.html#ac9c1a06e4e73b609503a9bd1dd1980d9">CLICK_TIME_DELTA</a> = 1000,
<a name="l02451"></a>02451         columnIndex,
<a name="l02452"></a>02452         column,
<a name="l02453"></a>02453         rowIndex,
<a name="l02454"></a>02454         shouldEdit = YES;
<a name="l02455"></a>02455 
<a name="l02456"></a>02456     <span class="keywordflow">if</span>(_implementedDataSourceMethods &amp; <a class="code" href="_c_p_table_view_8j.html#a3fb0a731ef8cca0484830f426bcbe81f">CPTableViewDataSource_tableView_writeRowsWithIndexes_toPasteboard_</a>)
<a name="l02457"></a>02457     {
<a name="l02458"></a>02458         rowIndex = [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#a6f1d4aad7598b4ca189e2a262d51cd08">rowAtPoint</a>:aPoint];
<a name="l02459"></a>02459         <span class="keywordflow">if</span> (rowIndex !== -1)
<a name="l02460"></a>02460         {
<a name="l02461"></a>02461             <span class="keywordflow">if</span> ([_draggedRowIndexes count] &gt; 0)
<a name="l02462"></a>02462             {
<a name="l02463"></a>02463                 _draggedRowIndexes = [<a class="code" href="class_c_p_index_set.html">CPIndexSet</a> indexSet];
<a name="l02464"></a>02464                 <span class="keywordflow">return</span>;
<a name="l02465"></a>02465             }
<a name="l02466"></a>02466             <span class="comment">// if the table has drag support then we use mouseUp to select a single row.</span>
<a name="l02467"></a>02467              _previouslySelectedRowIndexes = [_selectedRowIndexes copy];
<a name="l02468"></a>02468             [<span class="keyword">self</span> _updateSelectionWithMouseAtRow:rowIndex];
<a name="l02469"></a>02469         }
<a name="l02470"></a>02470     }
<a name="l02471"></a>02471 
<a name="l02472"></a>02472     <span class="keywordflow">if</span> (mouseIsUp
<a name="l02473"></a>02473         &amp;&amp; (_implementedDataSourceMethods &amp; <a class="code" href="_c_p_table_view_8j.html#a9f25c28df39dca590ad108beb6b4b48b">CPTableViewDataSource_tableView_setObjectValue_forTableColumn_row_</a>)
<a name="l02474"></a>02474         &amp;&amp; !_trackingPointMovedOutOfClickSlop
<a name="l02475"></a>02475         &amp;&amp; ([[<a class="code" href="_c_p_application_8j.html#a428912231c07effc32c420ee523bf0b7">CPApp</a> currentEvent] clickCount] &gt; 1))
<a name="l02476"></a>02476     {
<a name="l02477"></a>02477         columnIndex = [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#aa5bce119e8c4b79e4ed0f9a10172996d">columnAtPoint</a>:lastPoint];
<a name="l02478"></a>02478         <span class="keywordflow">if</span> (columnIndex !== -1)
<a name="l02479"></a>02479         {
<a name="l02480"></a>02480             column = _tableColumns[columnIndex];
<a name="l02481"></a>02481             <span class="keywordflow">if</span> ([column isEditable])
<a name="l02482"></a>02482             {
<a name="l02483"></a>02483                 rowIndex = [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#a6f1d4aad7598b4ca189e2a262d51cd08">rowAtPoint</a>:aPoint];
<a name="l02484"></a>02484                 <span class="keywordflow">if</span> (rowIndex !== -1)
<a name="l02485"></a>02485                 {
<a name="l02486"></a>02486 
<a name="l02487"></a>02487                     <span class="keywordflow">if</span> (_implementedDelegateMethods &amp; <a class="code" href="_c_p_table_view_8j.html#a13a5d77ea463b7ee16d106bdf440baef">CPTableViewDelegate_tableView_shouldEditTableColumn_row_</a>)
<a name="l02488"></a>02488                         shouldEdit = [_delegate tableView:self shouldEditTableColumn:column row:rowIndex];
<a name="l02489"></a>02489                     <span class="keywordflow">if</span> (shouldEdit)
<a name="l02490"></a>02490                     {
<a name="l02491"></a>02491                         _editingCellIndex = <a class="code" href="_c_g_geometry_8j.html#a06c96cb5931220da52ff44b8ce9b603e">CGPointMake</a>(columnIndex, rowIndex);
<a name="l02492"></a>02492                         [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#a69ae01655437f565b3f51bd2805fe68a">reloadDataForRowIndexes</a>:[<a class="code" href="class_c_p_index_set.html">CPIndexSet</a> indexSetWithIndex:rowIndex]
<a name="l02493"></a>02493                             <a class="code" href="class_c_p_table_view.html#a69ae01655437f565b3f51bd2805fe68a">columnIndexes</a>:[<a class="code" href="class_c_p_index_set.html">CPIndexSet</a> indexSetWithIndex:columnIndex]];
<a name="l02494"></a>02494 
<a name="l02495"></a>02495                         <span class="keywordflow">return</span>;
<a name="l02496"></a>02496                     }
<a name="l02497"></a>02497                 }
<a name="l02498"></a>02498             }
<a name="l02499"></a>02499         }
<a name="l02500"></a>02500 
<a name="l02501"></a>02501     } <span class="comment">//end of editing conditional</span>
<a name="l02502"></a>02502 
<a name="l02503"></a>02503     <span class="comment">//double click actions</span>
<a name="l02504"></a>02504     <span class="keywordflow">if</span>([[<a class="code" href="_c_p_application_8j.html#a428912231c07effc32c420ee523bf0b7">CPApp</a> currentEvent] clickCount] === 2 &amp;&amp; _doubleAction &amp;&amp; _target)
<a name="l02505"></a>02505         [<span class="keyword">self</span> sendAction:_doubleAction to:_target];
<a name="l02506"></a>02506 }
<a name="l02507"></a>02507 
<a name="l02511"></a><a class="code" href="class_c_p_table_view.html#a917e31de3a4edadbd66e2c2095b70951">02511</a> - (CPDragOperation)draggingEntered:(<span class="keywordtype">id</span>)sender
<a name="l02512"></a>02512 {
<a name="l02513"></a>02513     var dropOperation = [<span class="keyword">self</span> _proposedDropOperation],
<a name="l02514"></a>02514         draggingLocation = [sender draggingLocation],
<a name="l02515"></a>02515         row;
<a name="l02516"></a>02516 
<a name="l02517"></a>02517     var location = [<span class="keyword">self</span> convertPoint:draggingLocation fromView:nil];
<a name="l02518"></a>02518 
<a name="l02519"></a>02519     row = [<span class="keyword">self</span> _proposedRowAtPoint:location];
<a name="l02520"></a>02520     
<a name="l02521"></a>02521     <span class="keywordflow">if</span>(_retargetedDropRow !== nil)
<a name="l02522"></a>02522         row = _retargetedDropRow;
<a name="l02523"></a>02523     
<a name="l02524"></a>02524     var draggedTypes = [<span class="keyword">self</span> registeredDraggedTypes], 
<a name="l02525"></a>02525         count = [draggedTypes count],
<a name="l02526"></a>02526         i;
<a name="l02527"></a>02527         
<a name="l02528"></a>02528     <span class="keywordflow">for</span> (i = 0; i &lt; count; i++) 
<a name="l02529"></a>02529     { 
<a name="l02530"></a>02530         <span class="keywordflow">if</span> ([[[sender draggingPasteboard] types] containsObject:[draggedTypes objectAtIndex: i]]) 
<a name="l02531"></a>02531             <span class="keywordflow">return</span> [<span class="keyword">self</span> _validateDrop:sender proposedRow:row proposedDropOperation:dropOperation]; 
<a name="l02532"></a>02532     }
<a name="l02533"></a>02533     
<a name="l02534"></a>02534     <span class="keywordflow">return</span> <a class="code" href="_c_p_drag_server_8j.html#a24774df20b45f1dd94c64eb79c5f7338">CPDragOperationNone</a>;
<a name="l02535"></a>02535 }
<a name="l02536"></a>02536 
<a name="l02537"></a>02537 <span class="comment">/*</span>
<a name="l02538"></a>02538 <span class="comment">    @ignore</span>
<a name="l02539"></a>02539 <span class="comment">*/</span>
<a name="l02540"></a><a class="code" href="class_c_p_table_view.html#a7184eae8871a2f1046906dbd68ed4e5f">02540</a> - (void)draggingExited:(<span class="keywordtype">id</span>)sender
<a name="l02541"></a>02541 {
<a name="l02542"></a>02542     [_dropOperationFeedbackView setHidden:YES];
<a name="l02543"></a>02543 }
<a name="l02544"></a>02544 
<a name="l02545"></a>02545 <span class="comment">/*</span>
<a name="l02546"></a>02546 <span class="comment">    @ignore</span>
<a name="l02547"></a>02547 <span class="comment">*/</span>
<a name="l02548"></a><a class="code" href="class_c_p_table_view.html#a6db889a793062a09ddede1f02d991f5f">02548</a> - (void)draggingEnded:(<span class="keywordtype">id</span>)sender
<a name="l02549"></a>02549 {
<a name="l02550"></a>02550     [<span class="keyword">self</span> _draggingEnded];
<a name="l02551"></a>02551 }
<a name="l02552"></a>02552 
<a name="l02553"></a>02553 - (void)_draggingEnded
<a name="l02554"></a>02554 {
<a name="l02555"></a>02555     _retargetedDropOperation = nil;
<a name="l02556"></a>02556     _retargetedDropRow = nil;
<a name="l02557"></a>02557     _draggedRowIndexes = [<a class="code" href="class_c_p_index_set.html">CPIndexSet</a> indexSet];
<a name="l02558"></a>02558     [_dropOperationFeedbackView setHidden:YES];
<a name="l02559"></a>02559 }
<a name="l02560"></a>02560 <span class="comment">/*</span>
<a name="l02561"></a>02561 <span class="comment">    @ignore</span>
<a name="l02562"></a>02562 <span class="comment">*/</span>
<a name="l02563"></a><a class="code" href="class_c_p_table_view.html#a84a148402b33c5309fb33eb077d016d0">02563</a> - (BOOL)wantsPeriodicDraggingUpdates
<a name="l02564"></a>02564 {
<a name="l02565"></a>02565     <span class="keywordflow">return</span> YES;
<a name="l02566"></a>02566 }
<a name="l02567"></a>02567 
<a name="l02568"></a>02568 <span class="comment">/*</span>
<a name="l02569"></a>02569 <span class="comment">    @ignore</span>
<a name="l02570"></a>02570 <span class="comment">*/</span>
<a name="l02571"></a>02571 - (CPTableViewDropOperation)_proposedDropOperation
<a name="l02572"></a>02572 {
<a name="l02573"></a>02573     <span class="comment">//check is something is forced...</span>
<a name="l02574"></a>02574     <span class="comment">// otherwise we use the above action by default</span>
<a name="l02575"></a>02575     <span class="keywordflow">if</span>(_retargetedDropOperation !== nil)
<a name="l02576"></a>02576         <span class="keywordflow">return</span> _retargetedDropOperation;
<a name="l02577"></a>02577     <span class="keywordflow">else</span>
<a name="l02578"></a>02578         <span class="keywordflow">return</span> <a class="code" href="_c_p_table_view_8j.html#a4c2d1434c8bc5b937eeb47b55f5c74d0">CPTableViewDropAbove</a>;
<a name="l02579"></a>02579 }
<a name="l02580"></a>02580 
<a name="l02581"></a>02581 <span class="comment">/*</span>
<a name="l02582"></a>02582 <span class="comment">    @ignore</span>
<a name="l02583"></a>02583 <span class="comment">*/</span>
<a name="l02584"></a>02584 - (CPInteger)_proposedRowAtPoint:(CGPoint)dragPoint
<a name="l02585"></a>02585 {
<a name="l02586"></a>02586     var numberOfRows = [<span class="keyword">self</span> numberOfRows],
<a name="l02587"></a>02587         row;
<a name="l02588"></a>02588     <span class="comment">// cocoa seems to jump to the next row when we approach the below row</span>
<a name="l02589"></a>02589     dragPoint.y += FLOOR(_rowHeight/4);
<a name="l02590"></a>02590     
<a name="l02591"></a>02591     <span class="keywordflow">if</span> (dragPoint.y &gt; numberOfRows * (_rowHeight + _intercellSpacing.height))
<a name="l02592"></a>02592     {
<a name="l02593"></a>02593         <span class="keywordflow">if</span> ([<span class="keyword">self</span> _proposedDropOperation] === <a class="code" href="_c_p_table_view_8j.html#a4c2d1434c8bc5b937eeb47b55f5c74d0">CPTableViewDropAbove</a>) 
<a name="l02594"></a>02594             row = numberOfRows;
<a name="l02595"></a>02595         <span class="keywordflow">else</span>
<a name="l02596"></a>02596             row = numberOfRows - 1;
<a name="l02597"></a>02597     }
<a name="l02598"></a>02598     <span class="keywordflow">else</span>
<a name="l02599"></a>02599         row = [<span class="keyword">self</span> rowAtPoint:dragPoint];
<a name="l02600"></a>02600     
<a name="l02601"></a>02601     <span class="keywordflow">return</span> row;
<a name="l02602"></a>02602 }
<a name="l02603"></a>02603 
<a name="l02604"></a>02604 - (void)_validateDrop:(<span class="keywordtype">id</span>)info proposedRow:(CPInteger)row proposedDropOperation:(CPTableViewDropOperation)dropOperation
<a name="l02605"></a>02605 {
<a name="l02606"></a>02606     <span class="keywordflow">if</span>(_implementedDataSourceMethods &amp; <a class="code" href="_c_p_table_view_8j.html#a4f6917aa9754d8c13c933ae043ca4963">CPTableViewDataSource_tableView_validateDrop_proposedRow_proposedDropOperation_</a>)
<a name="l02607"></a>02607         <span class="keywordflow">return</span> [_dataSource tableView:self validateDrop:info proposedRow:row proposedDropOperation:dropOperation];
<a name="l02608"></a>02608 
<a name="l02609"></a>02609     <span class="keywordflow">return</span> <a class="code" href="_c_p_drag_server_8j.html#a24774df20b45f1dd94c64eb79c5f7338">CPDragOperationNone</a>;
<a name="l02610"></a>02610 }
<a name="l02611"></a>02611 
<a name="l02612"></a><a class="code" href="class_c_p_table_view.html#abeda677bfc7e10aac73b1fe55bb2dd9e">02612</a> - (CPDragOperation)draggingUpdated:(<span class="keywordtype">id</span>)sender
<a name="l02613"></a>02613 {
<a name="l02614"></a>02614     var dropOperation = [<span class="keyword">self</span> _proposedDropOperation],
<a name="l02615"></a>02615         numberOfRows = [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#ab93d1883609b8aaca737188ee9667c17">numberOfRows</a>],
<a name="l02616"></a>02616         draggingLocation = [sender draggingLocation],
<a name="l02617"></a>02617         dragOperation,
<a name="l02618"></a>02618         row;
<a name="l02619"></a>02619 
<a name="l02620"></a>02620     var location = [<span class="keyword">self</span> convertPoint:draggingLocation fromView:nil];
<a name="l02621"></a>02621 
<a name="l02622"></a>02622     row = [<span class="keyword">self</span> _proposedRowAtPoint:location];
<a name="l02623"></a>02623     dragOperation = [<span class="keyword">self</span> _validateDrop:sender proposedRow:row proposedDropOperation:dropOperation];
<a name="l02624"></a>02624     
<a name="l02625"></a>02625     <span class="keywordflow">if</span>(_retargetedDropRow !== nil)
<a name="l02626"></a>02626         row = _retargetedDropRow;
<a name="l02627"></a>02627 
<a name="l02628"></a>02628     <span class="comment">//if the user forces -1 then we should highlight the whole tabelview</span>
<a name="l02629"></a>02629     var rowRect;
<a name="l02630"></a>02630     <span class="keywordflow">if</span>(_retargetedDropRow === -1)
<a name="l02631"></a>02631         rowRect = [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#afa602354d5faf24cf16734c4aa52beec">exposedClipRect</a>];
<a name="l02632"></a>02632     <span class="keywordflow">else</span>
<a name="l02633"></a>02633         rowRect = [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#abdf1f5cc725acaf6d5734cc535bc8a22">rectOfRow</a>:row];
<a name="l02634"></a>02634     
<a name="l02635"></a>02635     var exposedClipRect = [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#afa602354d5faf24cf16734c4aa52beec">exposedClipRect</a>];
<a name="l02636"></a>02636     var visibleWidth = _CGRectGetWidth(exposedClipRect);
<a name="l02637"></a>02637 
<a name="l02638"></a>02638     rowRect = _CGRectMake(_CGRectGetMinX(exposedClipRect), rowRect.origin.y, visibleWidth, rowRect.size.height);
<a name="l02639"></a>02639 
<a name="l02640"></a>02640     [_dropOperationFeedbackView setDropOperation:dropOperation];
<a name="l02641"></a>02641     [_dropOperationFeedbackView setHidden:(dragOperation == CPDragOperationNone)];
<a name="l02642"></a>02642     [_dropOperationFeedbackView setFrame:rowRect];
<a name="l02643"></a>02643     [_dropOperationFeedbackView setCurrentRow:row];
<a name="l02644"></a>02644     [<span class="keyword">self</span> addSubview:_dropOperationFeedbackView];
<a name="l02645"></a>02645     
<a name="l02646"></a>02646     <span class="comment">// FIXME : Maybe we should do this in a timer outside this method. Problem: we don&#39;t know when the scroll ends and neighter when the next -draggingUpdated is called. Which one will come first ?</span>
<a name="l02647"></a>02647     <span class="keywordflow">if</span> (row &gt; 0 &amp;&amp; location.y - <a class="code" href="_c_g_geometry_8j.html#a9408ba6b0750742be8d630f59a3d4669">CGRectGetMinY</a>(exposedClipRect) &lt; _rowHeight)
<a name="l02648"></a>02648         [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#aac2521d3f258b8a58f3357756a5b830f">scrollRowToVisible</a>:row - 1];
<a name="l02649"></a>02649     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (row &lt; numberOfRows &amp;&amp; <a class="code" href="_c_g_geometry_8j.html#ab0a24500a256a6e58aab6ae4f19d7a77">CGRectGetMaxY</a>(exposedClipRect) - location.y &lt; _rowHeight)
<a name="l02650"></a>02650         [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#aac2521d3f258b8a58f3357756a5b830f">scrollRowToVisible</a>:row + 1];
<a name="l02651"></a>02651         
<a name="l02652"></a>02652     <span class="keywordflow">return</span> dragOperation;
<a name="l02653"></a>02653 }
<a name="l02654"></a>02654 
<a name="l02655"></a>02655 <span class="comment">/*</span>
<a name="l02656"></a>02656 <span class="comment">    @ignore</span>
<a name="l02657"></a>02657 <span class="comment">*/</span>
<a name="l02658"></a><a class="code" href="class_c_p_table_view.html#a1dbc3c06724af6921ba35a9c15b5c7c5">02658</a> - (BOOL)prepareForDragOperation:(<span class="keywordtype">id</span>)sender
<a name="l02659"></a>02659 {
<a name="l02660"></a>02660     <span class="comment">// FIX ME: is there anything else that needs to happen here?</span>
<a name="l02661"></a>02661     <span class="comment">// actual validation is called in dragginUpdated:</span>
<a name="l02662"></a>02662     [_dropOperationFeedbackView setHidden:YES];
<a name="l02663"></a>02663 
<a name="l02664"></a>02664     <span class="keywordflow">return</span> (_implementedDataSourceMethods &amp; <a class="code" href="_c_p_table_view_8j.html#a4f6917aa9754d8c13c933ae043ca4963">CPTableViewDataSource_tableView_validateDrop_proposedRow_proposedDropOperation_</a>);
<a name="l02665"></a>02665 }
<a name="l02666"></a>02666 
<a name="l02667"></a>02667 <span class="comment">/*</span>
<a name="l02668"></a>02668 <span class="comment">    @ignore</span>
<a name="l02669"></a>02669 <span class="comment">*/</span>
<a name="l02670"></a><a class="code" href="class_c_p_table_view.html#af404297dc87b64a9111ed86eaa4f0881">02670</a> - (BOOL)performDragOperation:(<span class="keywordtype">id</span>)sender
<a name="l02671"></a>02671 {
<a name="l02672"></a>02672     var operation = [<span class="keyword">self</span> _proposedDropOperation],
<a name="l02673"></a>02673         draggingLocation = [sender draggingLocation];
<a name="l02674"></a>02674 
<a name="l02675"></a>02675     var location = [<span class="keyword">self</span> convertPoint:draggingLocation fromView:nil];
<a name="l02676"></a>02676 
<a name="l02677"></a>02677     <span class="keywordflow">if</span>(_retargetedDropRow !== nil)
<a name="l02678"></a>02678         var row = _retargetedDropRow;
<a name="l02679"></a>02679     <span class="keywordflow">else</span>
<a name="l02680"></a>02680         var row = [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#a6f1d4aad7598b4ca189e2a262d51cd08">rowAtPoint</a>:location] - 1;
<a name="l02681"></a>02681 
<a name="l02682"></a>02682     <span class="keywordflow">return</span> [_dataSource tableView:self acceptDrop:sender row:row dropOperation:operation];
<a name="l02683"></a>02683 }
<a name="l02684"></a>02684 
<a name="l02685"></a>02685 <span class="comment">/*</span>
<a name="l02686"></a>02686 <span class="comment">    @ignore</span>
<a name="l02687"></a>02687 <span class="comment">*/</span>
<a name="l02688"></a><a class="code" href="class_c_p_table_view.html#a9c2df81b08de90e3ca739e8433d1e4b1">02688</a> - (void)concludeDragOperation:(<span class="keywordtype">id</span>)sender
<a name="l02689"></a>02689 {
<a name="l02690"></a>02690     [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#a25ec67f805f6a97b91879cb04933310e">reloadData</a>];
<a name="l02691"></a>02691 }
<a name="l02692"></a>02692 
<a name="l02693"></a>02693 <span class="comment">/*</span>
<a name="l02694"></a>02694 <span class="comment">    //this method is sent to the data source for conviences...</span>
<a name="l02695"></a>02695 <span class="comment">*/</span>
<a name="l02696"></a><a class="code" href="class_c_p_table_view.html#ab92264bacee96b12c9c4180243807c69">02696</a> - (void)draggedImage:(<a class="code" href="class_c_p_image.html">CPImage</a>)anImage endedAt:(CGPoint)aLocation operation:(CPDragOperation)anOperation
<a name="l02697"></a>02697 {
<a name="l02698"></a>02698     <span class="keywordflow">if</span>([_dataSource respondsToSelector:<span class="keyword">@selector</span>(tableView:didEndDraggedImage:atPosition:operation:)])
<a name="l02699"></a>02699         [_dataSource tableView:self didEndDraggedImage:anImage atPosition:aLocation operation:anOperation];
<a name="l02700"></a>02700 }
<a name="l02701"></a>02701 
<a name="l02702"></a>02702 <span class="comment">/*</span>
<a name="l02703"></a>02703 <span class="comment">    @ignore</span>
<a name="l02704"></a>02704 <span class="comment">    we&#39;re using this because we drag views instead of images so we can get the rows themselves to actually drag</span>
<a name="l02705"></a>02705 <span class="comment">*/</span>
<a name="l02706"></a><a class="code" href="class_c_p_table_view.html#a91b55cc101d16dead6206293bdfa11c1">02706</a> - (void)draggedView:(<a class="code" href="class_c_p_image.html">CPImage</a>)aView endedAt:(CGPoint)aLocation operation:(CPDragOperation)anOperation
<a name="l02707"></a>02707 {   
<a name="l02708"></a>02708     [<span class="keyword">self</span> _draggingEnded];
<a name="l02709"></a>02709     [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#ab92264bacee96b12c9c4180243807c69">draggedImage</a>:aView <a class="code" href="class_c_p_table_view.html#ab92264bacee96b12c9c4180243807c69">endedAt</a>:aLocation <a class="code" href="class_c_p_table_view.html#ab92264bacee96b12c9c4180243807c69">operation</a>:anOperation];
<a name="l02710"></a>02710 }
<a name="l02711"></a>02711 
<a name="l02712"></a>02712 - (void)_updateSelectionWithMouseAtRow:(CPInteger)aRow
<a name="l02713"></a>02713 {
<a name="l02714"></a>02714 
<a name="l02715"></a>02715     <span class="comment">//check to make sure the row exists</span>
<a name="l02716"></a>02716     <span class="keywordflow">if</span>(aRow &lt; 0)
<a name="l02717"></a>02717         <span class="keywordflow">return</span>;
<a name="l02718"></a>02718 
<a name="l02719"></a>02719     <span class="comment">// If cmd/ctrl was held down XOR the old selection with the proposed selection</span>
<a name="l02720"></a>02720     <span class="keywordflow">if</span> ([<span class="keyword">self</span> mouseDownFlags] &amp; (<a class="code" href="_c_p_event_8j.html#a675a3ab6cfc14dd4ad6702d7c682c7fe">CPCommandKeyMask</a> | <a class="code" href="_c_p_event_8j.html#a144f394b3de6afb9b329491dba0e8d14">CPControlKeyMask</a> | <a class="code" href="_c_p_event_8j.html#abb24a409c7daa575dd1fa20b7fcf8d51">CPAlternateKeyMask</a>))
<a name="l02721"></a>02721     {
<a name="l02722"></a>02722         <span class="keywordflow">if</span> ([_selectedRowIndexes containsIndex:aRow])
<a name="l02723"></a>02723         {
<a name="l02724"></a>02724             newSelection = [_selectedRowIndexes copy];
<a name="l02725"></a>02725 
<a name="l02726"></a>02726             [newSelection removeIndex:aRow];
<a name="l02727"></a>02727         }
<a name="l02728"></a>02728 
<a name="l02729"></a>02729         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (_allowsMultipleSelection)
<a name="l02730"></a>02730         {
<a name="l02731"></a>02731             newSelection = [_selectedRowIndexes copy];
<a name="l02732"></a>02732 
<a name="l02733"></a>02733             [newSelection addIndex:aRow];
<a name="l02734"></a>02734         }
<a name="l02735"></a>02735 
<a name="l02736"></a>02736         <span class="keywordflow">else</span>
<a name="l02737"></a>02737             newSelection = [<a class="code" href="class_c_p_index_set.html">CPIndexSet</a> indexSetWithIndex:aRow];
<a name="l02738"></a>02738     }
<a name="l02739"></a>02739 
<a name="l02740"></a>02740     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (_allowsMultipleSelection)
<a name="l02741"></a>02741         newSelection = [<a class="code" href="class_c_p_index_set.html">CPIndexSet</a> indexSetWithIndexesInRange:CPMakeRange(MIN(aRow, _selectionAnchorRow), ABS(aRow - _selectionAnchorRow) + 1)];
<a name="l02742"></a>02742 
<a name="l02743"></a>02743     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (aRow &gt;= 0 &amp;&amp; aRow &lt; _numberOfRows)
<a name="l02744"></a>02744         newSelection = [<a class="code" href="class_c_p_index_set.html">CPIndexSet</a> indexSetWithIndex:aRow];
<a name="l02745"></a>02745 
<a name="l02746"></a>02746     <span class="keywordflow">else</span>
<a name="l02747"></a>02747         newSelection = [<a class="code" href="class_c_p_index_set.html">CPIndexSet</a> indexSet];
<a name="l02748"></a>02748 
<a name="l02749"></a>02749     <span class="keywordflow">if</span> ([newSelection isEqualToIndexSet:_selectedRowIndexes])
<a name="l02750"></a>02750         <span class="keywordflow">return</span>;
<a name="l02751"></a>02751 
<a name="l02752"></a>02752     <span class="keywordflow">if</span> (_implementedDelegateMethods &amp; <a class="code" href="_c_p_table_view_8j.html#a17dd3c2f77d47e02db83a2643962e03f">CPTableViewDelegate_selectionShouldChangeInTableView_</a> &amp;&amp;
<a name="l02753"></a>02753         ![_delegate selectionShouldChangeInTableView:<span class="keyword">self</span>])
<a name="l02754"></a>02754         <span class="keywordflow">return</span>;
<a name="l02755"></a>02755 
<a name="l02756"></a>02756     <span class="keywordflow">if</span> (_implementedDelegateMethods &amp; <a class="code" href="_c_p_table_view_8j.html#a87a639d266ecdd1db204b2b3e3d0e97d">CPTableViewDelegate_tableView_selectionIndexesForProposedSelection_</a>)
<a name="l02757"></a>02757         newSelection = [_delegate tableView:self selectionIndexesForProposedSelection:newSelection];
<a name="l02758"></a>02758 
<a name="l02759"></a>02759     <span class="keywordflow">if</span> (_implementedDelegateMethods &amp; <a class="code" href="_c_p_table_view_8j.html#aaea951ab19dc11a096a69b28cc216e38">CPTableViewDelegate_tableView_shouldSelectRow_</a>)
<a name="l02760"></a>02760     {
<a name="l02761"></a>02761         var indexArray = [];
<a name="l02762"></a>02762 
<a name="l02763"></a>02763         [newSelection getIndexes:indexArray maxCount:-1 inIndexRange:nil];
<a name="l02764"></a>02764 
<a name="l02765"></a>02765         var indexCount = indexArray.length;
<a name="l02766"></a>02766 
<a name="l02767"></a>02767         <span class="keywordflow">while</span> (indexCount--)
<a name="l02768"></a>02768         {
<a name="l02769"></a>02769             var index = indexArray[indexCount];
<a name="l02770"></a>02770 
<a name="l02771"></a>02771             <span class="keywordflow">if</span> (![_delegate tableView:<span class="keyword">self</span> shouldSelectRow:index])
<a name="l02772"></a>02772                 [newSelection removeIndex:index];
<a name="l02773"></a>02773         }
<a name="l02774"></a>02774     }
<a name="l02775"></a>02775 
<a name="l02776"></a>02776     <span class="comment">// if empty selection is not allowed and the new selection has nothing selected, abort</span>
<a name="l02777"></a>02777     <span class="keywordflow">if</span> (!_allowsEmptySelection &amp;&amp; [newSelection count] === 0)
<a name="l02778"></a>02778         <span class="keywordflow">return</span>;
<a name="l02779"></a>02779 
<a name="l02780"></a>02780     <span class="keywordflow">if</span> ([newSelection isEqualToIndexSet:_selectedRowIndexes])
<a name="l02781"></a>02781         <span class="keywordflow">return</span>;
<a name="l02782"></a>02782 
<a name="l02783"></a>02783 
<a name="l02784"></a>02784     [<span class="keyword">self</span> selectRowIndexes:newSelection byExtendingSelection:NO];
<a name="l02785"></a>02785 
<a name="l02786"></a>02786 }
<a name="l02787"></a>02787 
<a name="l02788"></a>02788 - (void)_noteSelectionIsChanging
<a name="l02789"></a>02789 {
<a name="l02790"></a>02790     [[CPNotificationCenter defaultCenter]
<a name="l02791"></a>02791         postNotificationName:CPTableViewSelectionIsChangingNotification
<a name="l02792"></a>02792                       object:self
<a name="l02793"></a>02793                     userInfo:nil];
<a name="l02794"></a>02794 }
<a name="l02795"></a>02795 
<a name="l02796"></a>02796 - (void)_noteSelectionDidChange
<a name="l02797"></a>02797 {
<a name="l02798"></a>02798     [[CPNotificationCenter defaultCenter]
<a name="l02799"></a>02799         postNotificationName:CPTableViewSelectionDidChangeNotification
<a name="l02800"></a>02800                       object:self
<a name="l02801"></a>02801                     userInfo:nil];
<a name="l02802"></a>02802 }
<a name="l02803"></a>02803 
<a name="l02804"></a><a class="code" href="class_c_p_table_view.html#a11b8c128c30eddaa1c1e4934183dee4a">02804</a> - (BOOL)becomeFirstResponder
<a name="l02805"></a>02805 {
<a name="l02806"></a>02806     <span class="keywordflow">return</span> YES;
<a name="l02807"></a>02807 }
<a name="l02808"></a>02808 
<a name="l02809"></a><a class="code" href="class_c_p_table_view.html#a2a59649caf5935edd4b2d24ee477cc6b">02809</a> - (BOOL)acceptsFirstResponder
<a name="l02810"></a>02810 {
<a name="l02811"></a>02811     <span class="keywordflow">return</span> YES;
<a name="l02812"></a>02812 }
<a name="l02813"></a>02813 
<a name="l02814"></a><a class="code" href="class_c_p_table_view.html#acef038119638ef86e8c02a10d7076c7e">02814</a> - (void)keyDown:(<a class="code" href="class_c_p_event.html">CPEvent</a>)anEvent
<a name="l02815"></a>02815 {
<a name="l02816"></a>02816     [<span class="keyword">self</span> interpretKeyEvents:[CPArray arrayWithObject:anEvent]];
<a name="l02817"></a>02817 }
<a name="l02818"></a>02818 
<a name="l02819"></a><a class="code" href="class_c_p_table_view.html#a9b49b59c007344e7f42d1ca03793d533">02819</a> - (void)moveDown:(<span class="keywordtype">id</span>)sender
<a name="l02820"></a>02820 {
<a name="l02821"></a>02821     <span class="keywordflow">if</span> (_implementedDelegateMethods &amp; <a class="code" href="_c_p_table_view_8j.html#a17dd3c2f77d47e02db83a2643962e03f">CPTableViewDelegate_selectionShouldChangeInTableView_</a> &amp;&amp;
<a name="l02822"></a>02822         ![_delegate selectionShouldChangeInTableView:<span class="keyword">self</span>])
<a name="l02823"></a>02823         <span class="keywordflow">return</span>;
<a name="l02824"></a>02824 
<a name="l02825"></a>02825     var anEvent = [CPApp currentEvent];
<a name="l02826"></a>02826     <span class="keywordflow">if</span>([[<span class="keyword">self</span> selectedRowIndexes] count] &gt; 0)
<a name="l02827"></a>02827     {
<a name="l02828"></a>02828        var extend = NO;
<a name="l02829"></a>02829 
<a name="l02830"></a>02830        <span class="keywordflow">if</span>(([anEvent modifierFlags] &amp; <a class="code" href="_c_p_event_8j.html#a2343191b34b38dc1952bb44d83fa30d6">CPShiftKeyMask</a>) &amp;&amp; _allowsMultipleSelection)
<a name="l02831"></a>02831            extend = YES;
<a name="l02832"></a>02832 
<a name="l02833"></a>02833         var i = [[<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#a2bb55a58f2ae8d7636b0553982f3c9a7">selectedRowIndexes</a>] lastIndex];
<a name="l02834"></a>02834         <span class="keywordflow">if</span>(i&lt;[<span class="keyword">self</span> numberOfRows] - 1)
<a name="l02835"></a>02835             i++; <span class="comment">//set index to the next row after the last row selected</span>
<a name="l02836"></a>02836     }
<a name="l02837"></a>02837     <span class="keywordflow">else</span>
<a name="l02838"></a>02838     {
<a name="l02839"></a>02839         var extend = NO;
<a name="l02840"></a>02840         <span class="comment">//no rows are currently selected</span>
<a name="l02841"></a>02841         <span class="keywordflow">if</span>([<span class="keyword">self</span> numberOfRows] &gt; 0)
<a name="l02842"></a>02842             var i = 0; <span class="comment">//select the first row</span>
<a name="l02843"></a>02843     }
<a name="l02844"></a>02844 
<a name="l02845"></a>02845 
<a name="l02846"></a>02846     <span class="keywordflow">if</span>(_implementedDelegateMethods &amp; <a class="code" href="_c_p_table_view_8j.html#aaea951ab19dc11a096a69b28cc216e38">CPTableViewDelegate_tableView_shouldSelectRow_</a>)
<a name="l02847"></a>02847     {
<a name="l02848"></a>02848 
<a name="l02849"></a>02849         <span class="keywordflow">while</span>((![_delegate tableView:<span class="keyword">self</span> shouldSelectRow:i]) &amp;&amp; i&lt;[<span class="keyword">self</span> numberOfRows])
<a name="l02850"></a>02850         {
<a name="l02851"></a>02851             <span class="comment">//check to see if the row can be selected if it can&#39;t be then see if the next row can be selected</span>
<a name="l02852"></a>02852             i++;
<a name="l02853"></a>02853         }
<a name="l02854"></a>02854 
<a name="l02855"></a>02855         <span class="comment">//if the index still can be selected after the loop then just return</span>
<a name="l02856"></a>02856          <span class="keywordflow">if</span>(![_delegate tableView:<span class="keyword">self</span> shouldSelectRow:i])
<a name="l02857"></a>02857              <span class="keywordflow">return</span>;
<a name="l02858"></a>02858     }
<a name="l02859"></a>02859 
<a name="l02860"></a>02860     [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#a9b6204a962c90a046897dce505fec408">selectRowIndexes</a>:[<a class="code" href="class_c_p_index_set.html">CPIndexSet</a> indexSetWithIndex:i] <a class="code" href="class_c_p_table_view.html#a9b6204a962c90a046897dce505fec408">byExtendingSelection</a>:extend];
<a name="l02861"></a>02861 
<a name="l02862"></a>02862     <span class="keywordflow">if</span>(i &gt;= 0)
<a name="l02863"></a>02863         [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#aac2521d3f258b8a58f3357756a5b830f">scrollRowToVisible</a>:i];
<a name="l02864"></a>02864 }
<a name="l02865"></a>02865 
<a name="l02866"></a><a class="code" href="class_c_p_table_view.html#aebcba411b8f6a6b736e2b12282433035">02866</a> - (void)moveUp:(<span class="keywordtype">id</span>)sender
<a name="l02867"></a>02867 {
<a name="l02868"></a>02868     <span class="keywordflow">if</span> (_implementedDelegateMethods &amp; <a class="code" href="_c_p_table_view_8j.html#a17dd3c2f77d47e02db83a2643962e03f">CPTableViewDelegate_selectionShouldChangeInTableView_</a> &amp;&amp;
<a name="l02869"></a>02869         ![_delegate selectionShouldChangeInTableView:<span class="keyword">self</span>])
<a name="l02870"></a>02870         <span class="keywordflow">return</span>;
<a name="l02871"></a>02871 
<a name="l02872"></a>02872     var anEvent = [CPApp currentEvent];
<a name="l02873"></a>02873     <span class="keywordflow">if</span>([[<span class="keyword">self</span> selectedRowIndexes] count] &gt; 0)
<a name="l02874"></a>02874     {
<a name="l02875"></a>02875          var extend = NO;
<a name="l02876"></a>02876     
<a name="l02877"></a>02877          <span class="keywordflow">if</span>(([anEvent modifierFlags] &amp; <a class="code" href="_c_p_event_8j.html#a2343191b34b38dc1952bb44d83fa30d6">CPShiftKeyMask</a>) &amp;&amp; _allowsMultipleSelection)
<a name="l02878"></a>02878            extend = YES;
<a name="l02879"></a>02879     
<a name="l02880"></a>02880           var i = [[<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#a2bb55a58f2ae8d7636b0553982f3c9a7">selectedRowIndexes</a>] firstIndex];
<a name="l02881"></a>02881           <span class="keywordflow">if</span>(i &gt; 0)
<a name="l02882"></a>02882               i--; <span class="comment">//set index to the prev row before the first row selected</span>
<a name="l02883"></a>02883     }
<a name="l02884"></a>02884     <span class="keywordflow">else</span>
<a name="l02885"></a>02885     {
<a name="l02886"></a>02886       var extend = NO;
<a name="l02887"></a>02887       <span class="comment">//no rows are currently selected</span>
<a name="l02888"></a>02888         <span class="keywordflow">if</span>([<span class="keyword">self</span> numberOfRows] &gt; 0)
<a name="l02889"></a>02889             var i = [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#ab93d1883609b8aaca737188ee9667c17">numberOfRows</a>] - 1; <span class="comment">//select the first row</span>
<a name="l02890"></a>02890      }
<a name="l02891"></a>02891     
<a name="l02892"></a>02892     
<a name="l02893"></a>02893      <span class="keywordflow">if</span>(_implementedDelegateMethods &amp; <a class="code" href="_c_p_table_view_8j.html#aaea951ab19dc11a096a69b28cc216e38">CPTableViewDelegate_tableView_shouldSelectRow_</a>)
<a name="l02894"></a>02894      {
<a name="l02895"></a>02895     
<a name="l02896"></a>02896           <span class="keywordflow">while</span>((![_delegate tableView:<span class="keyword">self</span> shouldSelectRow:i]) &amp;&amp; i &gt; 0)
<a name="l02897"></a>02897           {
<a name="l02898"></a>02898               <span class="comment">//check to see if the row can be selected if it can&#39;t be then see if the prev row can be selected</span>
<a name="l02899"></a>02899               i--;
<a name="l02900"></a>02900           }
<a name="l02901"></a>02901     
<a name="l02902"></a>02902           <span class="comment">//if the index still can be selected after the loop then just return</span>
<a name="l02903"></a>02903            <span class="keywordflow">if</span>(![_delegate tableView:<span class="keyword">self</span> shouldSelectRow:i])
<a name="l02904"></a>02904                <span class="keywordflow">return</span>;
<a name="l02905"></a>02905      }
<a name="l02906"></a>02906     
<a name="l02907"></a>02907      [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#a9b6204a962c90a046897dce505fec408">selectRowIndexes</a>:[<a class="code" href="class_c_p_index_set.html">CPIndexSet</a> indexSetWithIndex:i] <a class="code" href="class_c_p_table_view.html#a9b6204a962c90a046897dce505fec408">byExtendingSelection</a>:extend];
<a name="l02908"></a>02908     
<a name="l02909"></a>02909      <span class="keywordflow">if</span>(i &gt;= 0)
<a name="l02910"></a>02910         [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#aac2521d3f258b8a58f3357756a5b830f">scrollRowToVisible</a>:i];
<a name="l02911"></a>02911 }
<a name="l02912"></a>02912 
<a name="l02913"></a><a class="code" href="class_c_p_table_view.html#a906633ed0f58018e1a7ce6729c8b1e9d">02913</a> - (void)deleteBackward:(<span class="keywordtype">id</span>)sender
<a name="l02914"></a>02914 {
<a name="l02915"></a>02915     <span class="keywordflow">if</span>([_delegate respondsToSelector: <span class="keyword">@selector</span>(tableViewDeleteKeyPressed:)])
<a name="l02916"></a>02916         [_delegate tableViewDeleteKeyPressed:self];
<a name="l02917"></a>02917 }
<a name="l02918"></a>02918 
<a name="l02919"></a>02919 <span class="keyword">@end</span>
<a name="l02920"></a>02920 
<a name="l02921"></a><a class="code" href="_c_p_table_view_8j.html#a3735b96051bc5ac351c70b3fe5d49126">02921</a> var <a class="code" href="_c_p_table_view_8j.html#a3735b96051bc5ac351c70b3fe5d49126">CPTableViewDataSourceKey</a>        = <span class="stringliteral">@&quot;CPTableViewDataSourceKey&quot;</span>,
<a name="l02922"></a><a class="code" href="_c_p_table_view_8j.html#a1d6265a4e180c8fc79fa0653f3a42b5d">02922</a>     <a class="code" href="_c_p_table_view_8j.html#a1d6265a4e180c8fc79fa0653f3a42b5d">CPTableViewDelegateKey</a>          = <span class="stringliteral">@&quot;CPTableViewDelegateKey&quot;</span>,
<a name="l02923"></a><a class="code" href="_c_p_table_view_8j.html#a249d34f03b936c7d41a2028ceb1f7e13">02923</a>     <a class="code" href="_c_p_table_view_8j.html#a249d34f03b936c7d41a2028ceb1f7e13">CPTableViewHeaderViewKey</a>        = <span class="stringliteral">@&quot;CPTableViewHeaderViewKey&quot;</span>,
<a name="l02924"></a><a class="code" href="_c_p_table_view_8j.html#a10daae21892ff9308af8721efe4a9e24">02924</a>     <a class="code" href="_c_p_table_view_8j.html#a10daae21892ff9308af8721efe4a9e24">CPTableViewTableColumnsKey</a>      = <span class="stringliteral">@&quot;CPTableViewTableColumnsKey&quot;</span>,
<a name="l02925"></a><a class="code" href="_c_p_table_view_8j.html#a0f4346d28a9ff7f382a9b4ceac22f0f2">02925</a>     <a class="code" href="_c_p_table_view_8j.html#a0f4346d28a9ff7f382a9b4ceac22f0f2">CPTableViewRowHeightKey</a>         = <span class="stringliteral">@&quot;CPTableViewRowHeightKey&quot;</span>,
<a name="l02926"></a><a class="code" href="_c_p_table_view_8j.html#a3459f0e162c9fdaa9d9251365df5aba0">02926</a>     <a class="code" href="_c_p_table_view_8j.html#a3459f0e162c9fdaa9d9251365df5aba0">CPTableViewIntercellSpacingKey</a>  = <span class="stringliteral">@&quot;CPTableViewIntercellSpacingKey&quot;</span>,
<a name="l02927"></a><a class="code" href="_c_p_table_view_8j.html#a94bdb3dd3b74f91fad23bc9ab097d067">02927</a>     <a class="code" href="_c_p_table_view_8j.html#a94bdb3dd3b74f91fad23bc9ab097d067">CPTableViewMultipleSelectionKey</a> = <span class="stringliteral">@&quot;CPTableViewMultipleSelectionKey&quot;</span>,
<a name="l02928"></a><a class="code" href="_c_p_table_view_8j.html#a129e907aaab3495bf0b923cc1be6f48e">02928</a>     <a class="code" href="_c_p_table_view_8j.html#a129e907aaab3495bf0b923cc1be6f48e">CPTableViewEmptySelectionKey</a>    = <span class="stringliteral">@&quot;CPTableViewEmptySelectionKey&quot;</span>;
<a name="l02929"></a>02929 
<a name="l02930"></a>02930 <span class="keyword">@implementation </span><a class="code" href="class_c_p_table_view.html">CPTableView</a> (CPCoding)
<a name="l02931"></a>02931 
<a name="l02932"></a><a class="code" href="class_c_p_table_view.html#a02877f5a02c4821d135993877ecbf6ff">02932</a> - (id)initWithCoder:(CPCoder)aCoder
<a name="l02933"></a>02933 {
<a name="l02934"></a>02934     <span class="keyword">self</span> = [<span class="keyword">super</span> initWithCoder:aCoder];
<a name="l02935"></a>02935 
<a name="l02936"></a>02936     <span class="keywordflow">if</span> (<span class="keyword">self</span>)
<a name="l02937"></a>02937     {
<a name="l02938"></a>02938         <span class="comment">//Configuring Behavior</span>
<a name="l02939"></a>02939         _allowsColumnReordering = YES;
<a name="l02940"></a>02940         _allowsColumnResizing = YES;
<a name="l02941"></a>02941         _allowsMultipleSelection = [aCoder decodeBoolForKey:CPTableViewMultipleSelectionKey];
<a name="l02942"></a>02942         _allowsEmptySelection = [aCoder decodeBoolForKey:CPTableViewEmptySelectionKey];
<a name="l02943"></a>02943         _allowsColumnSelection = NO;
<a name="l02944"></a>02944 
<a name="l02945"></a>02945         _tableViewFlags = 0;
<a name="l02946"></a>02946 
<a name="l02947"></a>02947         <span class="comment">//Setting Display Attributes</span>
<a name="l02948"></a>02948         _selectionHighlightMask = <a class="code" href="_c_p_table_view_8j.html#aca8acc7a64967150badd9c4b7c6eedf9">CPTableViewSelectionHighlightStyleRegular</a>;
<a name="l02949"></a>02949 
<a name="l02950"></a>02950         [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#a6265d6d38253d8e95a112e226cdefe4d">setUsesAlternatingRowBackgroundColors</a>:NO];
<a name="l02951"></a>02951         [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#aa50e7802368fe0b0be6756beaa70fd71">setAlternatingRowBackgroundColors</a>:[[<a class="code" href="class_c_p_color.html">CPColor</a> whiteColor], [<a class="code" href="class_c_p_color.html">CPColor</a> colorWithHexString:@&quot;e4e7ff&quot;]]];
<a name="l02952"></a>02952 
<a name="l02953"></a>02953         _tableColumns = [aCoder decodeObjectForKey:CPTableViewTableColumnsKey];
<a name="l02954"></a>02954         [_tableColumns makeObjectsPerformSelector:@selector(setTableView:) withObject:self];
<a name="l02955"></a>02955 
<a name="l02956"></a>02956         _tableColumnRanges = [];
<a name="l02957"></a>02957         _dirtyTableColumnRangeIndex = 0;
<a name="l02958"></a>02958         _numberOfHiddenColumns = 0;
<a name="l02959"></a>02959 
<a name="l02960"></a>02960         _objectValues = { };
<a name="l02961"></a>02961         _dataViewsForTableColumns = { };
<a name="l02962"></a>02962         _dataViews=  [];
<a name="l02963"></a>02963         _numberOfRows = 0;
<a name="l02964"></a>02964         _exposedRows = [<a class="code" href="class_c_p_index_set.html">CPIndexSet</a> indexSet];
<a name="l02965"></a>02965         _exposedColumns = [<a class="code" href="class_c_p_index_set.html">CPIndexSet</a> indexSet];
<a name="l02966"></a>02966         _cachedDataViews = { };
<a name="l02967"></a>02967         _rowHeight = [aCoder decodeFloatForKey:CPTableViewRowHeightKey];
<a name="l02968"></a>02968         _intercellSpacing = [aCoder decodeSizeForKey:CPTableViewIntercellSpacingKey];
<a name="l02969"></a>02969 
<a name="l02970"></a>02970         _selectionHightlightColor = [<a class="code" href="class_c_p_color.html">CPColor</a> <a class="code" href="class_c_p_color.html#a3c17f4544abd947afd5d30d7c240c378">selectionColor</a>];
<a name="l02971"></a>02971 
<a name="l02972"></a>02972         [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#a87d09099f126a8e7e741a192e05e10f7">setGridColor</a>:[<a class="code" href="class_c_p_color.html">CPColor</a> grayColor]];
<a name="l02973"></a>02973         [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#a10dc95485219186d423799fedac67efd">setGridStyleMask</a>:CPTableViewGridNone];
<a name="l02974"></a>02974 
<a name="l02975"></a>02975         _headerView = [[<a class="code" href="class_c_p_table_header_view.html">CPTableHeaderView</a> alloc] initWithFrame:CGRectMake(0, 0, [<span class="keyword">self</span> bounds].size.width, _rowHeight)];
<a name="l02976"></a>02976 
<a name="l02977"></a>02977         [_headerView setTableView:self];
<a name="l02978"></a>02978 
<a name="l02979"></a>02979         _cornerView = [[_CPCornerView alloc] initWithFrame:CGRectMake(0, 0, [<a class="code" href="class_c_p_scroller.html">CPScroller</a> <a class="code" href="class_c_p_scroller.html#aa561236fe659f6ccd8f06f7c6755476e">scrollerWidth</a>], CGRectGetHeight([_headerView frame]))];
<a name="l02980"></a>02980 
<a name="l02981"></a>02981         _selectedColumnIndexes = [<a class="code" href="class_c_p_index_set.html">CPIndexSet</a> indexSet];
<a name="l02982"></a>02982         _selectedRowIndexes = [<a class="code" href="class_c_p_index_set.html">CPIndexSet</a> indexSet];
<a name="l02983"></a>02983 
<a name="l02984"></a>02984         [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#a13b891524111eeb3c8873a789df3cb6a">setDataSource</a>:[aCoder decodeObjectForKey:CPTableViewDataSourceKey]];
<a name="l02985"></a>02985         [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#ad35bac24324e17ec66afbafce1a6e597">setDelegate</a>:[aCoder decodeObjectForKey:CPTableViewDelegateKey]];
<a name="l02986"></a>02986 
<a name="l02987"></a>02987         _tableDrawView = [[_CPTableDrawView alloc] initWithTableView:self];
<a name="l02988"></a>02988         [_tableDrawView setBackgroundColor:[<a class="code" href="class_c_p_color.html">CPColor</a> clearColor]];
<a name="l02989"></a>02989         [<span class="keyword">self</span> addSubview:_tableDrawView];
<a name="l02990"></a>02990 
<a name="l02991"></a>02991         [<span class="keyword">self</span> <a class="code" href="class_c_p_table_view.html#a7a71c5e32d14791d19693f9a87d88491">viewWillMoveToSuperview</a>:[<span class="keyword">self</span> superview]];
<a name="l02992"></a>02992     }
<a name="l02993"></a>02993 
<a name="l02994"></a>02994     <span class="keywordflow">return</span> <span class="keyword">self</span>;
<a name="l02995"></a>02995 }
<a name="l02996"></a>02996 
<a name="l02997"></a><a class="code" href="class_c_p_table_view.html#aec6f0cd6615c4643e90179f847ffbb2d">02997</a> - (void)encodeWithCoder:(CPCoder)aCoder
<a name="l02998"></a>02998 {
<a name="l02999"></a>02999     [<span class="keyword">super</span> encodeWithCoder:aCoder];
<a name="l03000"></a>03000 
<a name="l03001"></a>03001     [aCoder encodeObject:_dataSource forKey:CPTableViewDataSourceKey];
<a name="l03002"></a>03002     [aCoder encodeObject:_delegate forKey:CPTableViewDelegateKey];
<a name="l03003"></a>03003 
<a name="l03004"></a>03004     [aCoder encodeFloat:_rowHeight forKey:CPTableViewRowHeightKey];
<a name="l03005"></a>03005     [aCoder encodeSize:_intercellSpacing forKey:CPTableViewIntercellSpacingKey];
<a name="l03006"></a>03006 
<a name="l03007"></a>03007     [aCoder encodeBool:_allowsMultipleSelection forKey:CPTableViewMultipleSelectionKey];
<a name="l03008"></a>03008     [aCoder encodeBool:_allowsEmptySelection forKey:CPTableViewEmptySelectionKey];
<a name="l03009"></a>03009 
<a name="l03010"></a>03010     [aCoder encodeObject:_tableColumns forKey:CPTableViewTableColumnsKey];
<a name="l03011"></a>03011 }
<a name="l03012"></a>03012 
<a name="l03013"></a>03013 <span class="keyword">@end</span>
<a name="l03014"></a>03014 
<a name="l03015"></a><a class="code" href="class_c_p_color.html">03015</a> <span class="keyword">@implementation </span><a class="code" href="class_c_p_color.html">CPColor</a> (tableview)
<a name="l03016"></a>03016 
<a name="l03017"></a><a class="code" href="class_c_p_color.html#a3c17f4544abd947afd5d30d7c240c378">03017</a> + (<a class="code" href="class_c_p_color.html">CPColor</a>)<a class="code" href="class_c_p_color.html#a3c17f4544abd947afd5d30d7c240c378">selectionColor</a>
<a name="l03018"></a>03018 {
<a name="l03019"></a>03019     <span class="keywordflow">return</span> [<a class="code" href="class_c_p_color.html">CPColor</a> colorWithHexString:@&quot;5f83b9&quot;];
<a name="l03020"></a>03020 }
<a name="l03021"></a>03021 
<a name="l03022"></a><a class="code" href="class_c_p_color.html#a1226e56d2ace061bd057253bcb8a26f6">03022</a> + (<a class="code" href="class_c_p_color.html">CPColor</a>)<a class="code" href="class_c_p_color.html#a1226e56d2ace061bd057253bcb8a26f6">selectionColorSourceView</a>
<a name="l03023"></a>03023 {
<a name="l03024"></a>03024     <span class="keywordflow">return</span> [<a class="code" href="class_c_p_color.html">CPColor</a> colorWithPatternImage:[[<a class="code" href="class_c_p_image.html">CPImage</a> alloc] initByReferencingFile:@&quot;Resources/tableviewselection.png&quot; size:CGSizeMake(6,22)]];
<a name="l03025"></a>03025 }
<a name="l03026"></a>03026 
<a name="l03027"></a>03027 <span class="keyword">@end</span>
<a name="l03028"></a>03028 
<a name="l03029"></a><a class="code" href="class_c_p_index_set.html">03029</a> <span class="keyword">@implementation </span><a class="code" href="class_c_p_index_set.html">CPIndexSet</a> (tableview)
<a name="l03030"></a>03030 
<a name="l03031"></a><a class="code" href="class_c_p_index_set.html#a51a579d3aef0ebc249ccd0ed80643285">03031</a> - (void)removeMatches:otherSet
<a name="l03032"></a>03032 {
<a name="l03033"></a>03033     var firstindex = [<span class="keyword">self</span> firstIndex];
<a name="l03034"></a>03034     var index = MIN(firstindex,[otherSet firstIndex]);
<a name="l03035"></a>03035     var switchFlag = (index == firstindex);
<a name="l03036"></a>03036     <span class="keywordflow">while</span>(index != CPNotFound)
<a name="l03037"></a>03037     {
<a name="l03038"></a>03038         var indexSet = (switchFlag) ? otherSet : <span class="keyword">self</span>;
<a name="l03039"></a>03039         otherIndex = [indexSet indexGreaterThanOrEqualToIndex:index];
<a name="l03040"></a>03040         <span class="keywordflow">if</span> (otherIndex == index)
<a name="l03041"></a>03041         {
<a name="l03042"></a>03042             [<span class="keyword">self</span> removeIndex:index];
<a name="l03043"></a>03043             [otherSet removeIndex:index];
<a name="l03044"></a>03044         }
<a name="l03045"></a>03045         index = otherIndex;
<a name="l03046"></a>03046         switchFlag = !switchFlag;
<a name="l03047"></a>03047     }
<a name="l03048"></a>03048 }
<a name="l03049"></a>03049 
<a name="l03050"></a>03050 <span class="keyword">@end</span>
<a name="l03051"></a>03051 
<a name="l03052"></a>03052 <span class="keyword">@implementation </span>_dropOperationDrawingView : <a class="code" href="class_c_p_view.html">CPView</a>
<a name="l03053"></a>03053 {
<a name="l03054"></a>03054     <span class="keywordtype">unsigned</span>    dropOperation @<a class="code" href="_c_p_table_view_8j.html#af4bfdebe5c9a0ee9e5d2953ff864cd72">accessors</a>;
<a name="l03055"></a><a class="code" href="_c_p_table_view_8j.html#af4bfdebe5c9a0ee9e5d2953ff864cd72">03055</a>     <a class="code" href="class_c_p_table_view.html">CPTableView</a> tableView @<a class="code" href="_c_p_table_view_8j.html#af4bfdebe5c9a0ee9e5d2953ff864cd72">accessors</a>;
<a name="l03056"></a>03056     <span class="keywordtype">int</span>         currentRow @<a class="code" href="_c_p_table_view_8j.html#af4bfdebe5c9a0ee9e5d2953ff864cd72">accessors</a>;
<a name="l03057"></a>03057 }
<a name="l03058"></a>03058 
<a name="l03059"></a>03059 - (void)drawRect:(CGRect)aRect
<a name="l03060"></a>03060 {
<a name="l03061"></a>03061     <span class="keywordflow">if</span>(tableView._destinationDragStyle === <a class="code" href="_c_p_table_view_8j.html#a7d721e523dd8ab8740aff52cb54efa91">CPTableViewDraggingDestinationFeedbackStyleNone</a>)
<a name="l03062"></a>03062         <span class="keywordflow">return</span>;
<a name="l03063"></a>03063 
<a name="l03064"></a>03064     var context = [[<a class="code" href="class_c_p_graphics_context.html">CPGraphicsContext</a> <a class="code" href="class_c_p_graphics_context.html#a378dafc8fb951053dd6877fb45e87f61">currentContext</a>] <a class="code" href="class_c_p_graphics_context.html#a92895bd939c04da463d02425bec83f0b">graphicsPort</a>];
<a name="l03065"></a>03065 
<a name="l03066"></a>03066     <a class="code" href="group__coregraphics.html#gac13f17a8bed76d16b9e5252106d196e0">CGContextSetStrokeColor</a>(context, [<a class="code" href="class_c_p_color.html">CPColor</a> colorWithHexString:<span class="stringliteral">@&quot;4886ca&quot;</span>]);
<a name="l03067"></a>03067     <a class="code" href="group__coregraphics.html#ga96bba0be21dd53a15a84c8f23eb7cc70">CGContextSetLineWidth</a>(context, 3);
<a name="l03068"></a>03068 
<a name="l03069"></a>03069     <span class="keywordflow">if</span>(dropOperation === <a class="code" href="_c_p_table_view_8j.html#a279093eafa50075a94c202e0dd51861a">CPTableViewDropOn</a>)
<a name="l03070"></a>03070     {
<a name="l03071"></a>03071         <span class="comment">//if row is selected don&#39;t fill and stroke white</span>
<a name="l03072"></a>03072         var selectedRows = [tableView selectedRowIndexes];
<a name="l03073"></a>03073         var newRect = _CGRectMake(aRect.origin.x + 2, aRect.origin.y + 2, aRect.size.width - 4, aRect.size.height - 5);
<a name="l03074"></a>03074         <span class="keywordflow">if</span>([selectedRows containsIndex:currentRow])
<a name="l03075"></a>03075         {
<a name="l03076"></a>03076             <a class="code" href="group__coregraphics.html#ga96bba0be21dd53a15a84c8f23eb7cc70">CGContextSetLineWidth</a>(context, 2);
<a name="l03077"></a>03077             <a class="code" href="group__coregraphics.html#gac13f17a8bed76d16b9e5252106d196e0">CGContextSetStrokeColor</a>(context, [<a class="code" href="class_c_p_color.html">CPColor</a> whiteColor]);
<a name="l03078"></a>03078         }
<a name="l03079"></a>03079         <span class="keywordflow">else</span>
<a name="l03080"></a>03080         {
<a name="l03081"></a>03081             <a class="code" href="group__coregraphics.html#ga800a3e5b0c46359d28b091376630bb0e">CGContextSetFillColor</a>(context, [<a class="code" href="class_c_p_color.html">CPColor</a> colorWithRed:72/255 green:134/255 blue:202/255 alpha:0.25]);
<a name="l03082"></a>03082             <a class="code" href="group__coregraphics.html#ga76628754093e198ead6806bf8a934d35">CGContextFillRoundedRectangleInRect</a>(context, newRect, 8, YES, YES, YES, YES);
<a name="l03083"></a>03083         }
<a name="l03084"></a>03084         <a class="code" href="group__coregraphics.html#ga183a83821529224dc910a3ffd9f07f91">CGContextStrokeRoundedRectangleInRect</a>(context, newRect, 8, YES, YES, YES, YES);
<a name="l03085"></a>03085 
<a name="l03086"></a>03086     }
<a name="l03087"></a>03087 
<a name="l03088"></a>03088 
<a name="l03089"></a>03089     <span class="keywordflow">if</span>(dropOperation === <a class="code" href="_c_p_table_view_8j.html#a4c2d1434c8bc5b937eeb47b55f5c74d0">CPTableViewDropAbove</a>)
<a name="l03090"></a>03090     {
<a name="l03091"></a>03091 
<a name="l03092"></a>03092 
<a name="l03093"></a>03093         <span class="comment">//reposition the view up a tad</span>
<a name="l03094"></a>03094         [<span class="keyword">self</span> setFrameOrigin:CGPointMake(_frame.origin.x, _frame.origin.y - 8)];
<a name="l03095"></a>03095 
<a name="l03096"></a>03096         var selectedRows = [tableView selectedRowIndexes];
<a name="l03097"></a>03097 
<a name="l03098"></a>03098         <span class="keywordflow">if</span>([selectedRows containsIndex:currentRow - 1] || [selectedRows containsIndex:currentRow])
<a name="l03099"></a>03099         {
<a name="l03100"></a>03100             <a class="code" href="group__coregraphics.html#gac13f17a8bed76d16b9e5252106d196e0">CGContextSetStrokeColor</a>(context, [<a class="code" href="class_c_p_color.html">CPColor</a> whiteColor]);
<a name="l03101"></a>03101             <a class="code" href="group__coregraphics.html#ga96bba0be21dd53a15a84c8f23eb7cc70">CGContextSetLineWidth</a>(context, 4);
<a name="l03102"></a>03102             <span class="comment">//draw the circle thing</span>
<a name="l03103"></a>03103             <a class="code" href="group__coregraphics.html#gab6e04d0c787c9f065d87534fd4654cbf">CGContextStrokeEllipseInRect</a>(context, _CGRectMake(aRect.origin.x + 4, aRect.origin.y + 4, 8, 8));
<a name="l03104"></a>03104             <span class="comment">//then draw the line</span>
<a name="l03105"></a>03105             <a class="code" href="group__coregraphics.html#ga02cca9368e5aacc0bef423d724635376">CGContextBeginPath</a>(context);
<a name="l03106"></a>03106             <a class="code" href="group__coregraphics.html#ga44dc04bb1efb98ff834308c997d10dc5">CGContextMoveToPoint</a>(context, 10, aRect.origin.y + 8);
<a name="l03107"></a>03107             <a class="code" href="group__coregraphics.html#ga834b9d5848989453730d162f251a29c3">CGContextAddLineToPoint</a>(context, aRect.size.width - aRect.origin.y - 8, aRect.origin.y + 8);
<a name="l03108"></a>03108             <a class="code" href="group__coregraphics.html#gaaf20d10c7501084913e6fdee367f3efa">CGContextClosePath</a>(context);
<a name="l03109"></a>03109             <a class="code" href="group__coregraphics.html#ga03bda4b6dc1763d22d122d565e027012">CGContextStrokePath</a>(context);
<a name="l03110"></a>03110 
<a name="l03111"></a>03111             <a class="code" href="group__coregraphics.html#gac13f17a8bed76d16b9e5252106d196e0">CGContextSetStrokeColor</a>(context, [<a class="code" href="class_c_p_color.html">CPColor</a> colorWithHexString:<span class="stringliteral">@&quot;4886ca&quot;</span>]);
<a name="l03112"></a>03112             <a class="code" href="group__coregraphics.html#ga96bba0be21dd53a15a84c8f23eb7cc70">CGContextSetLineWidth</a>(context, 3);
<a name="l03113"></a>03113         }
<a name="l03114"></a>03114 
<a name="l03115"></a>03115         <span class="comment">//draw the circle thing</span>
<a name="l03116"></a>03116         <a class="code" href="group__coregraphics.html#gab6e04d0c787c9f065d87534fd4654cbf">CGContextStrokeEllipseInRect</a>(context, _CGRectMake(aRect.origin.x + 4, aRect.origin.y + 4, 8, 8));
<a name="l03117"></a>03117         <span class="comment">//then draw the line</span>
<a name="l03118"></a>03118         <a class="code" href="group__coregraphics.html#ga02cca9368e5aacc0bef423d724635376">CGContextBeginPath</a>(context);
<a name="l03119"></a>03119         <a class="code" href="group__coregraphics.html#ga44dc04bb1efb98ff834308c997d10dc5">CGContextMoveToPoint</a>(context, 10, aRect.origin.y + 8);
<a name="l03120"></a>03120         <a class="code" href="group__coregraphics.html#ga834b9d5848989453730d162f251a29c3">CGContextAddLineToPoint</a>(context, aRect.size.width - aRect.origin.y - 8, aRect.origin.y + 8);
<a name="l03121"></a>03121         <a class="code" href="group__coregraphics.html#gaaf20d10c7501084913e6fdee367f3efa">CGContextClosePath</a>(context);
<a name="l03122"></a>03122         <a class="code" href="group__coregraphics.html#ga03bda4b6dc1763d22d122d565e027012">CGContextStrokePath</a>(context);
<a name="l03123"></a>03123         <span class="comment">//CGContextStrokeLineSegments(context, [aRect.origin.x + 8,  aRect.origin.y + 8, 300 , aRect.origin.y + 8]);</span>
<a name="l03124"></a>03124     }
<a name="l03125"></a>03125 }
<a name="l03126"></a>03126 <span class="keyword">@end</span>
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.2 </small></address>
</body>
</html>
